\doxysection{Game\+Timer.\+cpp}
\label{_common_2_game_timer_8cpp_source}\index{Common/GameTimer.cpp@{Common/GameTimer.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{//***************************************************************************************}}
\DoxyCodeLine{00002 \textcolor{comment}{// GameTimer.cpp by Frank Luna (C) 2011 All Rights Reserved.}}
\DoxyCodeLine{00003 \textcolor{comment}{//***************************************************************************************}}
\DoxyCodeLine{00004 }
\DoxyCodeLine{00005 \textcolor{preprocessor}{\#include <windows.h>}}
\DoxyCodeLine{00006 \textcolor{preprocessor}{\#include "{}GameTimer.h"{}}}
\DoxyCodeLine{00007 }
\DoxyCodeLine{00008 GameTimer::GameTimer()}
\DoxyCodeLine{00009 : mSecondsPerCount(0.0), mDeltaTime(-\/1.0), mBaseTime(0), }
\DoxyCodeLine{00010   mPausedTime(0), mPrevTime(0), mCurrTime(0), mStopped(false)}
\DoxyCodeLine{00011 \{}
\DoxyCodeLine{00012     \_\_int64 countsPerSec;}
\DoxyCodeLine{00013     QueryPerformanceFrequency((LARGE\_INTEGER*)\&countsPerSec);}
\DoxyCodeLine{00014     mSecondsPerCount = 1.0 / (double)countsPerSec;}
\DoxyCodeLine{00015 \}}
\DoxyCodeLine{00016 }
\DoxyCodeLine{00017 \textcolor{comment}{// Returns the total time elapsed since Reset() was called, NOT counting any}}
\DoxyCodeLine{00018 \textcolor{comment}{// time when the clock is stopped.}}
\DoxyCodeLine{00019 \textcolor{keywordtype}{float} GameTimer::TotalTime()\textcolor{keyword}{const}}
\DoxyCodeLine{00020 \textcolor{keyword}{}\{}
\DoxyCodeLine{00021     \textcolor{comment}{// If we are stopped, do not count the time that has passed since we stopped.}}
\DoxyCodeLine{00022     \textcolor{comment}{// Moreover, if we previously already had a pause, the distance }}
\DoxyCodeLine{00023     \textcolor{comment}{// mStopTime -\/ mBaseTime includes paused time, which we do not want to count.}}
\DoxyCodeLine{00024     \textcolor{comment}{// To correct this, we can subtract the paused time from mStopTime:  }}
\DoxyCodeLine{00025     \textcolor{comment}{//}}
\DoxyCodeLine{00026     \textcolor{comment}{//                     |<-\/-\/paused time-\/-\/>|}}
\DoxyCodeLine{00027     \textcolor{comment}{// -\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/> time}}
\DoxyCodeLine{00028     \textcolor{comment}{//  mBaseTime       mStopTime        startTime     mStopTime    mCurrTime}}
\DoxyCodeLine{00029 }
\DoxyCodeLine{00030     \textcolor{keywordflow}{if}( mStopped )}
\DoxyCodeLine{00031     \{}
\DoxyCodeLine{00032         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{float})(((mStopTime -\/ mPausedTime)-\/mBaseTime)*mSecondsPerCount);}
\DoxyCodeLine{00033     \}}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035     \textcolor{comment}{// The distance mCurrTime -\/ mBaseTime includes paused time,}}
\DoxyCodeLine{00036     \textcolor{comment}{// which we do not want to count.  To correct this, we can subtract }}
\DoxyCodeLine{00037     \textcolor{comment}{// the paused time from mCurrTime:  }}
\DoxyCodeLine{00038     \textcolor{comment}{//}}
\DoxyCodeLine{00039     \textcolor{comment}{//  (mCurrTime -\/ mPausedTime) -\/ mBaseTime }}
\DoxyCodeLine{00040     \textcolor{comment}{//}}
\DoxyCodeLine{00041     \textcolor{comment}{//                     |<-\/-\/paused time-\/-\/>|}}
\DoxyCodeLine{00042     \textcolor{comment}{// -\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/> time}}
\DoxyCodeLine{00043     \textcolor{comment}{//  mBaseTime       mStopTime        startTime     mCurrTime}}
\DoxyCodeLine{00044     }
\DoxyCodeLine{00045     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00046     \{}
\DoxyCodeLine{00047         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{float})(((mCurrTime-\/mPausedTime)-\/mBaseTime)*mSecondsPerCount);}
\DoxyCodeLine{00048     \}}
\DoxyCodeLine{00049 \}}
\DoxyCodeLine{00050 }
\DoxyCodeLine{00051 \textcolor{keywordtype}{float} GameTimer::DeltaTime()\textcolor{keyword}{const}}
\DoxyCodeLine{00052 \textcolor{keyword}{}\{}
\DoxyCodeLine{00053     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{float})mDeltaTime;}
\DoxyCodeLine{00054 \}}
\DoxyCodeLine{00055 }
\DoxyCodeLine{00056 \textcolor{keywordtype}{void} GameTimer::Reset()}
\DoxyCodeLine{00057 \{}
\DoxyCodeLine{00058     \_\_int64 currTime;}
\DoxyCodeLine{00059     QueryPerformanceCounter((LARGE\_INTEGER*)\&currTime);}
\DoxyCodeLine{00060 }
\DoxyCodeLine{00061     mBaseTime = currTime;}
\DoxyCodeLine{00062     mPrevTime = currTime;}
\DoxyCodeLine{00063     mStopTime = 0;}
\DoxyCodeLine{00064     mStopped  = \textcolor{keyword}{false};}
\DoxyCodeLine{00065 \}}
\DoxyCodeLine{00066 }
\DoxyCodeLine{00067 \textcolor{keywordtype}{void} GameTimer::Start()}
\DoxyCodeLine{00068 \{}
\DoxyCodeLine{00069     \_\_int64 startTime;}
\DoxyCodeLine{00070     QueryPerformanceCounter((LARGE\_INTEGER*)\&startTime);}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073     \textcolor{comment}{// Accumulate the time elapsed between stop and start pairs.}}
\DoxyCodeLine{00074     \textcolor{comment}{//}}
\DoxyCodeLine{00075     \textcolor{comment}{//                     |<-\/-\/-\/-\/-\/-\/-\/d-\/-\/-\/-\/-\/-\/-\/>|}}
\DoxyCodeLine{00076     \textcolor{comment}{// -\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/> time}}
\DoxyCodeLine{00077     \textcolor{comment}{//  mBaseTime       mStopTime        startTime     }}
\DoxyCodeLine{00078 }
\DoxyCodeLine{00079     \textcolor{keywordflow}{if}( mStopped )}
\DoxyCodeLine{00080     \{}
\DoxyCodeLine{00081         mPausedTime += (startTime -\/ mStopTime); }
\DoxyCodeLine{00082 }
\DoxyCodeLine{00083         mPrevTime = startTime;}
\DoxyCodeLine{00084         mStopTime = 0;}
\DoxyCodeLine{00085         mStopped  = \textcolor{keyword}{false};}
\DoxyCodeLine{00086     \}}
\DoxyCodeLine{00087 \}}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089 \textcolor{keywordtype}{void} GameTimer::Stop()}
\DoxyCodeLine{00090 \{}
\DoxyCodeLine{00091     \textcolor{keywordflow}{if}( !mStopped )}
\DoxyCodeLine{00092     \{}
\DoxyCodeLine{00093         \_\_int64 currTime;}
\DoxyCodeLine{00094         QueryPerformanceCounter((LARGE\_INTEGER*)\&currTime);}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096         mStopTime = currTime;}
\DoxyCodeLine{00097         mStopped  = \textcolor{keyword}{true};}
\DoxyCodeLine{00098     \}}
\DoxyCodeLine{00099 \}}
\DoxyCodeLine{00100 }
\DoxyCodeLine{00101 \textcolor{keywordtype}{void} GameTimer::Tick()}
\DoxyCodeLine{00102 \{}
\DoxyCodeLine{00103     \textcolor{keywordflow}{if}( mStopped )}
\DoxyCodeLine{00104     \{}
\DoxyCodeLine{00105         mDeltaTime = 0.0;}
\DoxyCodeLine{00106         \textcolor{keywordflow}{return};}
\DoxyCodeLine{00107     \}}
\DoxyCodeLine{00108 }
\DoxyCodeLine{00109     \_\_int64 currTime;}
\DoxyCodeLine{00110     QueryPerformanceCounter((LARGE\_INTEGER*)\&currTime);}
\DoxyCodeLine{00111     mCurrTime = currTime;}
\DoxyCodeLine{00112 }
\DoxyCodeLine{00113     \textcolor{comment}{// Time difference between this frame and the previous.}}
\DoxyCodeLine{00114     mDeltaTime = (mCurrTime -\/ mPrevTime)*mSecondsPerCount;}
\DoxyCodeLine{00115 }
\DoxyCodeLine{00116     \textcolor{comment}{// Prepare for next frame.}}
\DoxyCodeLine{00117     mPrevTime = mCurrTime;}
\DoxyCodeLine{00118 }
\DoxyCodeLine{00119     \textcolor{comment}{// Force nonnegative.  The DXSDK's CDXUTTimer mentions that if the }}
\DoxyCodeLine{00120     \textcolor{comment}{// processor goes into a power save mode or we get shuffled to another}}
\DoxyCodeLine{00121     \textcolor{comment}{// processor, then mDeltaTime can be negative.}}
\DoxyCodeLine{00122     \textcolor{keywordflow}{if}(mDeltaTime < 0.0)}
\DoxyCodeLine{00123     \{}
\DoxyCodeLine{00124         mDeltaTime = 0.0;}
\DoxyCodeLine{00125     \}}
\DoxyCodeLine{00126 \}}
\DoxyCodeLine{00127 }
\DoxyCodeLine{00128 }
\DoxyCodeLine{00129 }
\DoxyCodeLine{00130 }
\DoxyCodeLine{00131 }
\DoxyCodeLine{00132 }

\end{DoxyCode}
