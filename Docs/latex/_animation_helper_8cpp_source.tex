\doxysection{Animation\+Helper.\+cpp}
\label{_animation_helper_8cpp_source}\index{Week14/QuatDemo/AnimationHelper.cpp@{Week14/QuatDemo/AnimationHelper.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{//***************************************************************************************}}
\DoxyCodeLine{00002 \textcolor{comment}{// AnimationHelper.cpp by Frank Luna (C) 2011 All Rights Reserved.}}
\DoxyCodeLine{00003 \textcolor{comment}{//***************************************************************************************}}
\DoxyCodeLine{00004 }
\DoxyCodeLine{00005 \textcolor{preprocessor}{\#include "{}AnimationHelper.h"{}}}
\DoxyCodeLine{00006 }
\DoxyCodeLine{00007 \textcolor{keyword}{using namespace }DirectX;}
\DoxyCodeLine{00008 }
\DoxyCodeLine{00009 Keyframe::Keyframe()}
\DoxyCodeLine{00010     : TimePos(0.0f),}
\DoxyCodeLine{00011     Translation(0.0f, 0.0f, 0.0f),}
\DoxyCodeLine{00012     Scale(1.0f, 1.0f, 1.0f),}
\DoxyCodeLine{00013     RotationQuat(0.0f, 0.0f, 0.0f, 1.0f)}
\DoxyCodeLine{00014 \{}
\DoxyCodeLine{00015 \}}
\DoxyCodeLine{00016 }
\DoxyCodeLine{00017 Keyframe::\string~Keyframe()}
\DoxyCodeLine{00018 \{}
\DoxyCodeLine{00019 \}}
\DoxyCodeLine{00020  }
\DoxyCodeLine{00021 \textcolor{keywordtype}{float} BoneAnimation::GetStartTime()\textcolor{keyword}{const}}
\DoxyCodeLine{00022 \textcolor{keyword}{}\{}
\DoxyCodeLine{00023     \textcolor{comment}{// Keyframes are sorted by time, so first keyframe gives start time.}}
\DoxyCodeLine{00024     \textcolor{keywordflow}{return} Keyframes.front().TimePos;}
\DoxyCodeLine{00025 \}}
\DoxyCodeLine{00026 }
\DoxyCodeLine{00027 \textcolor{keywordtype}{float} BoneAnimation::GetEndTime()\textcolor{keyword}{const}}
\DoxyCodeLine{00028 \textcolor{keyword}{}\{}
\DoxyCodeLine{00029     \textcolor{comment}{// Keyframes are sorted by time, so last keyframe gives end time.}}
\DoxyCodeLine{00030     \textcolor{keywordtype}{float} f = Keyframes.back().TimePos;}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032     \textcolor{keywordflow}{return} f;}
\DoxyCodeLine{00033 \}}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035 \textcolor{keywordtype}{void} BoneAnimation::Interpolate(\textcolor{keywordtype}{float} t, XMFLOAT4X4\& M)\textcolor{keyword}{const}}
\DoxyCodeLine{00036 \textcolor{keyword}{}\{}
\DoxyCodeLine{00037     \textcolor{keywordflow}{if}( t <= Keyframes.front().TimePos )}
\DoxyCodeLine{00038     \{}
\DoxyCodeLine{00039         XMVECTOR S = XMLoadFloat3(\&Keyframes.front().Scale);}
\DoxyCodeLine{00040         XMVECTOR P = XMLoadFloat3(\&Keyframes.front().Translation);}
\DoxyCodeLine{00041         XMVECTOR Q = XMLoadFloat4(\&Keyframes.front().RotationQuat);}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043         XMVECTOR zero = XMVectorSet(0.0f, 0.0f, 0.0f, 1.0f);}
\DoxyCodeLine{00044         XMStoreFloat4x4(\&M, XMMatrixAffineTransformation(S, zero, Q, P));}
\DoxyCodeLine{00045     \}}
\DoxyCodeLine{00046     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( t >= Keyframes.back().TimePos )}
\DoxyCodeLine{00047     \{}
\DoxyCodeLine{00048         XMVECTOR S = XMLoadFloat3(\&Keyframes.back().Scale);}
\DoxyCodeLine{00049         XMVECTOR P = XMLoadFloat3(\&Keyframes.back().Translation);}
\DoxyCodeLine{00050         XMVECTOR Q = XMLoadFloat4(\&Keyframes.back().RotationQuat);}
\DoxyCodeLine{00051 }
\DoxyCodeLine{00052         XMVECTOR zero = XMVectorSet(0.0f, 0.0f, 0.0f, 1.0f);}
\DoxyCodeLine{00053         XMStoreFloat4x4(\&M, XMMatrixAffineTransformation(S, zero, Q, P));}
\DoxyCodeLine{00054     \}}
\DoxyCodeLine{00055     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00056     \{}
\DoxyCodeLine{00057         \textcolor{keywordflow}{for}(UINT i = 0; i < Keyframes.size()-\/1; ++i)}
\DoxyCodeLine{00058         \{}
\DoxyCodeLine{00059             \textcolor{keywordflow}{if}( t >= Keyframes[i].TimePos \&\& t <= Keyframes[i+1].TimePos )}
\DoxyCodeLine{00060             \{}
\DoxyCodeLine{00061                 \textcolor{keywordtype}{float} lerpPercent = (t -\/ Keyframes[i].TimePos) / (Keyframes[i+1].TimePos -\/ Keyframes[i].TimePos);}
\DoxyCodeLine{00062 }
\DoxyCodeLine{00063                 XMVECTOR s0 = XMLoadFloat3(\&Keyframes[i].Scale);}
\DoxyCodeLine{00064                 XMVECTOR s1 = XMLoadFloat3(\&Keyframes[i+1].Scale);}
\DoxyCodeLine{00065 }
\DoxyCodeLine{00066                 XMVECTOR p0 = XMLoadFloat3(\&Keyframes[i].Translation);}
\DoxyCodeLine{00067                 XMVECTOR p1 = XMLoadFloat3(\&Keyframes[i+1].Translation);}
\DoxyCodeLine{00068 }
\DoxyCodeLine{00069                 XMVECTOR q0 = XMLoadFloat4(\&Keyframes[i].RotationQuat);}
\DoxyCodeLine{00070                 XMVECTOR q1 = XMLoadFloat4(\&Keyframes[i+1].RotationQuat);}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072                 XMVECTOR S = XMVectorLerp(s0, s1, lerpPercent);}
\DoxyCodeLine{00073                 XMVECTOR P = XMVectorLerp(p0, p1, lerpPercent);}
\DoxyCodeLine{00074                 XMVECTOR Q = XMQuaternionSlerp(q0, q1, lerpPercent);}
\DoxyCodeLine{00075 }
\DoxyCodeLine{00076                 XMVECTOR zero = XMVectorSet(0.0f, 0.0f, 0.0f, 1.0f);}
\DoxyCodeLine{00077                 XMStoreFloat4x4(\&M, XMMatrixAffineTransformation(S, zero, Q, P));}
\DoxyCodeLine{00078 }
\DoxyCodeLine{00079                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{00080             \}}
\DoxyCodeLine{00081         \}}
\DoxyCodeLine{00082     \}}
\DoxyCodeLine{00083 \}}

\end{DoxyCode}
