\doxysection{DXSample\+Helper.\+h}
\label{_week2-7-_hello_01_world_2_d_x_sample_helper_8h_source}\index{Week2/Week2-\/7-\/Hello World/DXSampleHelper.h@{Week2/Week2-\/7-\/Hello World/DXSampleHelper.h}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{00002 \textcolor{comment}{//}}
\DoxyCodeLine{00003 \textcolor{comment}{// Copyright (c) Microsoft. All rights reserved.}}
\DoxyCodeLine{00004 \textcolor{comment}{// This code is licensed under the MIT License (MIT).}}
\DoxyCodeLine{00005 \textcolor{comment}{// THIS CODE IS PROVIDED *AS IS* WITHOUT WARRANTY OF}}
\DoxyCodeLine{00006 \textcolor{comment}{// ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY}}
\DoxyCodeLine{00007 \textcolor{comment}{// IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR}}
\DoxyCodeLine{00008 \textcolor{comment}{// PURPOSE, MERCHANTABILITY, OR NON-\/INFRINGEMENT.}}
\DoxyCodeLine{00009 \textcolor{comment}{//}}
\DoxyCodeLine{00010 \textcolor{comment}{//*********************************************************}}
\DoxyCodeLine{00011 }
\DoxyCodeLine{00012 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{00013 \textcolor{preprocessor}{\#include <stdexcept>}}
\DoxyCodeLine{00014 }
\DoxyCodeLine{00015 \textcolor{comment}{// Note that while ComPtr is used to manage the lifetime of resources on the CPU,}}
\DoxyCodeLine{00016 \textcolor{comment}{// it has no understanding of the lifetime of resources on the GPU. Apps must account}}
\DoxyCodeLine{00017 \textcolor{comment}{// for the GPU lifetime of resources to avoid destroying objects that may still be}}
\DoxyCodeLine{00018 \textcolor{comment}{// referenced by the GPU.}}
\DoxyCodeLine{00019 \textcolor{keyword}{using} Microsoft::WRL::ComPtr;}
\DoxyCodeLine{00020 }
\DoxyCodeLine{00021 \textcolor{keyword}{inline} std::string HrToString(HRESULT hr)}
\DoxyCodeLine{00022 \{}
\DoxyCodeLine{00023     \textcolor{keywordtype}{char} s\_str[64] = \{\};}
\DoxyCodeLine{00024     sprintf\_s(s\_str, \textcolor{stringliteral}{"{}HRESULT of 0x\%08X"{}}, \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}(hr));}
\DoxyCodeLine{00025     \textcolor{keywordflow}{return} std::string(s\_str);}
\DoxyCodeLine{00026 \}}
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028 \textcolor{keyword}{class }HrException : \textcolor{keyword}{public} std::runtime\_error}
\DoxyCodeLine{00029 \{}
\DoxyCodeLine{00030 \textcolor{keyword}{public}:}
\DoxyCodeLine{00031     HrException(HRESULT hr) : std::runtime\_error(HrToString(hr)), m\_hr(hr) \{\}}
\DoxyCodeLine{00032     HRESULT Error()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} m\_hr; \}}
\DoxyCodeLine{00033 \textcolor{keyword}{private}:}
\DoxyCodeLine{00034     \textcolor{keyword}{const} HRESULT m\_hr;}
\DoxyCodeLine{00035 \};}
\DoxyCodeLine{00036 }
\DoxyCodeLine{00037 \textcolor{preprocessor}{\#define SAFE\_RELEASE(p) if (p) (p)-\/>Release()}}
\DoxyCodeLine{00038 }
\DoxyCodeLine{00039 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} ThrowIfFailed(HRESULT hr)}
\DoxyCodeLine{00040 \{}
\DoxyCodeLine{00041     \textcolor{keywordflow}{if} (FAILED(hr))}
\DoxyCodeLine{00042     \{}
\DoxyCodeLine{00043         \textcolor{keywordflow}{throw} HrException(hr);}
\DoxyCodeLine{00044     \}}
\DoxyCodeLine{00045 \}}
\DoxyCodeLine{00046 }
\DoxyCodeLine{00047 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} GetAssetsPath(\_Out\_writes\_(pathSize) WCHAR* path, UINT pathSize)}
\DoxyCodeLine{00048 \{}
\DoxyCodeLine{00049     \textcolor{keywordflow}{if} (path == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00050     \{}
\DoxyCodeLine{00051         \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00052     \}}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054     DWORD size = GetModuleFileName(\textcolor{keyword}{nullptr}, path, pathSize);}
\DoxyCodeLine{00055     \textcolor{keywordflow}{if} (size == 0 || size == pathSize)}
\DoxyCodeLine{00056     \{}
\DoxyCodeLine{00057         \textcolor{comment}{// Method failed or path was truncated.}}
\DoxyCodeLine{00058         \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00059     \}}
\DoxyCodeLine{00060 }
\DoxyCodeLine{00061     WCHAR* lastSlash = wcsrchr(path, L\textcolor{charliteral}{'\(\backslash\)\(\backslash\)'});}
\DoxyCodeLine{00062     \textcolor{keywordflow}{if} (lastSlash)}
\DoxyCodeLine{00063     \{}
\DoxyCodeLine{00064         *(lastSlash + 1) = L\textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00065     \}}
\DoxyCodeLine{00066 \}}
\DoxyCodeLine{00067 }
\DoxyCodeLine{00068 \textcolor{keyword}{inline} HRESULT ReadDataFromFile(LPCWSTR filename, \textcolor{keywordtype}{byte}** data, UINT* size)}
\DoxyCodeLine{00069 \{}
\DoxyCodeLine{00070     \textcolor{keyword}{using namespace }Microsoft::WRL;}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072     CREATEFILE2\_EXTENDED\_PARAMETERS extendedParams = \{\};}
\DoxyCodeLine{00073     extendedParams.dwSize = \textcolor{keyword}{sizeof}(CREATEFILE2\_EXTENDED\_PARAMETERS);}
\DoxyCodeLine{00074     extendedParams.dwFileAttributes = FILE\_ATTRIBUTE\_NORMAL;}
\DoxyCodeLine{00075     extendedParams.dwFileFlags = FILE\_FLAG\_SEQUENTIAL\_SCAN;}
\DoxyCodeLine{00076     extendedParams.dwSecurityQosFlags = SECURITY\_ANONYMOUS;}
\DoxyCodeLine{00077     extendedParams.lpSecurityAttributes = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00078     extendedParams.hTemplateFile = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00079 }
\DoxyCodeLine{00080     Wrappers::FileHandle file(CreateFile2(filename, GENERIC\_READ, FILE\_SHARE\_READ, OPEN\_EXISTING, \&extendedParams));}
\DoxyCodeLine{00081     \textcolor{keywordflow}{if} (file.Get() == INVALID\_HANDLE\_VALUE)}
\DoxyCodeLine{00082     \{}
\DoxyCodeLine{00083         \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00084     \}}
\DoxyCodeLine{00085 }
\DoxyCodeLine{00086     FILE\_STANDARD\_INFO fileInfo = \{\};}
\DoxyCodeLine{00087     \textcolor{keywordflow}{if} (!GetFileInformationByHandleEx(file.Get(), FileStandardInfo, \&fileInfo, \textcolor{keyword}{sizeof}(fileInfo)))}
\DoxyCodeLine{00088     \{}
\DoxyCodeLine{00089         \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00090     \}}
\DoxyCodeLine{00091 }
\DoxyCodeLine{00092     \textcolor{keywordflow}{if} (fileInfo.EndOfFile.HighPart != 0)}
\DoxyCodeLine{00093     \{}
\DoxyCodeLine{00094         \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00095     \}}
\DoxyCodeLine{00096 }
\DoxyCodeLine{00097     *data = \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{byte}*\textcolor{keyword}{>}(malloc(fileInfo.EndOfFile.LowPart));}
\DoxyCodeLine{00098     *size = fileInfo.EndOfFile.LowPart;}
\DoxyCodeLine{00099 }
\DoxyCodeLine{00100     \textcolor{keywordflow}{if} (!ReadFile(file.Get(), *data, fileInfo.EndOfFile.LowPart, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}))}
\DoxyCodeLine{00101     \{}
\DoxyCodeLine{00102         \textcolor{keywordflow}{throw} std::exception();}
\DoxyCodeLine{00103     \}}
\DoxyCodeLine{00104 }
\DoxyCodeLine{00105     \textcolor{keywordflow}{return} S\_OK;}
\DoxyCodeLine{00106 \}}
\DoxyCodeLine{00107 }
\DoxyCodeLine{00108 \textcolor{comment}{// Assign a name to the object to aid with debugging.}}
\DoxyCodeLine{00109 \textcolor{preprocessor}{\#if defined(\_DEBUG) || defined(DBG)}}
\DoxyCodeLine{00110 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} SetName(ID3D12Object* pObject, LPCWSTR name)}
\DoxyCodeLine{00111 \{}
\DoxyCodeLine{00112     pObject-\/>SetName(name);}
\DoxyCodeLine{00113 \}}
\DoxyCodeLine{00114 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} SetNameIndexed(ID3D12Object* pObject, LPCWSTR name, UINT index)}
\DoxyCodeLine{00115 \{}
\DoxyCodeLine{00116     WCHAR fullName[50];}
\DoxyCodeLine{00117     \textcolor{keywordflow}{if} (swprintf\_s(fullName, L\textcolor{stringliteral}{"{}\%s[\%u]"{}}, name, index) > 0)}
\DoxyCodeLine{00118     \{}
\DoxyCodeLine{00119         pObject-\/>SetName(fullName);}
\DoxyCodeLine{00120     \}}
\DoxyCodeLine{00121 \}}
\DoxyCodeLine{00122 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00123 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} SetName(ID3D12Object*, LPCWSTR)}
\DoxyCodeLine{00124 \{}
\DoxyCodeLine{00125 \}}
\DoxyCodeLine{00126 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} SetNameIndexed(ID3D12Object*, LPCWSTR, UINT)}
\DoxyCodeLine{00127 \{}
\DoxyCodeLine{00128 \}}
\DoxyCodeLine{00129 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00130 }
\DoxyCodeLine{00131 \textcolor{comment}{// Naming helper for ComPtr<T>.}}
\DoxyCodeLine{00132 \textcolor{comment}{// Assigns the name of the variable as the name of the object.}}
\DoxyCodeLine{00133 \textcolor{comment}{// The indexed variant will include the index in the name of the object.}}
\DoxyCodeLine{00134 \textcolor{preprocessor}{\#define NAME\_D3D12\_OBJECT(x) SetName((x).Get(), L\#x)}}
\DoxyCodeLine{00135 \textcolor{preprocessor}{\#define NAME\_D3D12\_OBJECT\_INDEXED(x, n) SetNameIndexed((x)[n].Get(), L\#x, n)}}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137 \textcolor{keyword}{inline} UINT CalculateConstantBufferByteSize(UINT byteSize)}
\DoxyCodeLine{00138 \{}
\DoxyCodeLine{00139     \textcolor{comment}{// Constant buffer size is required to be aligned.}}
\DoxyCodeLine{00140     \textcolor{keywordflow}{return} (byteSize + (D3D12\_CONSTANT\_BUFFER\_DATA\_PLACEMENT\_ALIGNMENT -\/ 1)) \& \string~(D3D12\_CONSTANT\_BUFFER\_DATA\_PLACEMENT\_ALIGNMENT -\/ 1);}
\DoxyCodeLine{00141 \}}
\DoxyCodeLine{00142 }
\DoxyCodeLine{00143 \textcolor{preprocessor}{\#ifdef D3D\_COMPILE\_STANDARD\_FILE\_INCLUDE}}
\DoxyCodeLine{00144 \textcolor{keyword}{inline} Microsoft::WRL::ComPtr<ID3DBlob> CompileShader(}
\DoxyCodeLine{00145     \textcolor{keyword}{const} std::wstring\& filename,}
\DoxyCodeLine{00146     \textcolor{keyword}{const} D3D\_SHADER\_MACRO* defines,}
\DoxyCodeLine{00147     \textcolor{keyword}{const} std::string\& entrypoint,}
\DoxyCodeLine{00148     \textcolor{keyword}{const} std::string\& target)}
\DoxyCodeLine{00149 \{}
\DoxyCodeLine{00150     UINT compileFlags = 0;}
\DoxyCodeLine{00151 \textcolor{preprocessor}{\#if defined(\_DEBUG) || defined(DBG)}}
\DoxyCodeLine{00152     compileFlags = D3DCOMPILE\_DEBUG | D3DCOMPILE\_SKIP\_OPTIMIZATION;}
\DoxyCodeLine{00153 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00154 }
\DoxyCodeLine{00155     HRESULT hr;}
\DoxyCodeLine{00156 }
\DoxyCodeLine{00157     Microsoft::WRL::ComPtr<ID3DBlob> byteCode = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00158     Microsoft::WRL::ComPtr<ID3DBlob> errors;}
\DoxyCodeLine{00159     hr = D3DCompileFromFile(filename.c\_str(), defines, D3D\_COMPILE\_STANDARD\_FILE\_INCLUDE,}
\DoxyCodeLine{00160         entrypoint.c\_str(), target.c\_str(), compileFlags, 0, \&byteCode, \&errors);}
\DoxyCodeLine{00161 }
\DoxyCodeLine{00162     \textcolor{keywordflow}{if} (errors != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00163     \{}
\DoxyCodeLine{00164         OutputDebugStringA((\textcolor{keywordtype}{char}*)errors-\/>GetBufferPointer());}
\DoxyCodeLine{00165     \}}
\DoxyCodeLine{00166     ThrowIfFailed(hr);}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168     \textcolor{keywordflow}{return} byteCode;}
\DoxyCodeLine{00169 \}}
\DoxyCodeLine{00170 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00171 }
\DoxyCodeLine{00172 \textcolor{comment}{// Resets all elements in a ComPtr array.}}
\DoxyCodeLine{00173 \textcolor{keyword}{template}<\textcolor{keyword}{class} T>}
\DoxyCodeLine{00174 \textcolor{keywordtype}{void} ResetComPtrArray(T* comPtrArray)}
\DoxyCodeLine{00175 \{}
\DoxyCodeLine{00176     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&i : *comPtrArray)}
\DoxyCodeLine{00177     \{}
\DoxyCodeLine{00178         i.Reset();}
\DoxyCodeLine{00179     \}}
\DoxyCodeLine{00180 \}}
\DoxyCodeLine{00181 }
\DoxyCodeLine{00182 }
\DoxyCodeLine{00183 \textcolor{comment}{// Resets all elements in a unique\_ptr array.}}
\DoxyCodeLine{00184 \textcolor{keyword}{template}<\textcolor{keyword}{class} T>}
\DoxyCodeLine{00185 \textcolor{keywordtype}{void} ResetUniquePtrArray(T* uniquePtrArray)}
\DoxyCodeLine{00186 \{}
\DoxyCodeLine{00187     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&i : *uniquePtrArray)}
\DoxyCodeLine{00188     \{}
\DoxyCodeLine{00189         i.reset();}
\DoxyCodeLine{00190     \}}
\DoxyCodeLine{00191 \}}

\end{DoxyCode}
