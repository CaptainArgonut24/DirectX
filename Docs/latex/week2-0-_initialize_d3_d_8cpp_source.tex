\doxysection{week2-\/0-\/\+Initialize\+D3D.cpp}
\label{week2-0-_initialize_d3_d_8cpp_source}\index{Week2/Week2-\/2-\/InitializeDirect3D/week2-\/0-\/InitializeD3D.cpp@{Week2/Week2-\/2-\/InitializeDirect3D/week2-\/0-\/InitializeD3D.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 }
\DoxyCodeLine{00002 \textcolor{preprocessor}{\#include "{}../../Common/d3dApp.h"{}}}
\DoxyCodeLine{00003 \textcolor{preprocessor}{\#include <DirectXColors.h>}}
\DoxyCodeLine{00004 }
\DoxyCodeLine{00005 \textcolor{keyword}{using namespace }DirectX;}
\DoxyCodeLine{00006 }
\DoxyCodeLine{00007 \textcolor{keyword}{class }InitDirect3DApp : \textcolor{keyword}{public} D3DApp}
\DoxyCodeLine{00008 \{}
\DoxyCodeLine{00009 \textcolor{keyword}{public}:}
\DoxyCodeLine{00010     InitDirect3DApp(HINSTANCE hInstance);}
\DoxyCodeLine{00011     \string~InitDirect3DApp();}
\DoxyCodeLine{00012 }
\DoxyCodeLine{00013     \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} Initialize()\textcolor{keyword}{override};}
\DoxyCodeLine{00014 }
\DoxyCodeLine{00015 \textcolor{keyword}{private}:}
\DoxyCodeLine{00016     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnResize()\textcolor{keyword}{override};}
\DoxyCodeLine{00017     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Update(\textcolor{keyword}{const} GameTimer\& gt)\textcolor{keyword}{override};}
\DoxyCodeLine{00018     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Draw(\textcolor{keyword}{const} GameTimer\& gt)\textcolor{keyword}{override};}
\DoxyCodeLine{00019 }
\DoxyCodeLine{00020 \};}
\DoxyCodeLine{00021 }
\DoxyCodeLine{00022 }
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024 \textcolor{preprocessor}{\#pragma region step1}}
\DoxyCodeLine{00025 \textcolor{comment}{//WinMain -\/-\/> every win32 application needs a WinMain() function, like console application needs main()}}
\DoxyCodeLine{00026 \textcolor{comment}{//HINSTANCE, PSTR.. are part of <Windows.h>}}
\DoxyCodeLine{00027 \textcolor{comment}{//Windows is about Windows (window class that you register and instance of the class) and Messages}}
\DoxyCodeLine{00028 \textcolor{comment}{//cmdLine receives the parameter that somebody passes}}
\DoxyCodeLine{00029 \textcolor{preprocessor}{\#pragma endregion}}
\DoxyCodeLine{00030 }
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032 \textcolor{keywordtype}{int} WINAPI WinMain(HINSTANCE hInstance, HINSTANCE prevInstance,}
\DoxyCodeLine{00033     PSTR cmdLine, \textcolor{keywordtype}{int} showCmd)}
\DoxyCodeLine{00034 \{}
\DoxyCodeLine{00035     \textcolor{comment}{// Enable run-\/time memory check for debug builds.}}
\DoxyCodeLine{00036 \textcolor{preprocessor}{\#if defined(DEBUG) | defined(\_DEBUG)}}
\DoxyCodeLine{00037     \_CrtSetDbgFlag(\_CRTDBG\_ALLOC\_MEM\_DF | \_CRTDBG\_LEAK\_CHECK\_DF);}
\DoxyCodeLine{00038 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00039 }
\DoxyCodeLine{00040     \textcolor{keywordflow}{try}}
\DoxyCodeLine{00041     \{}
\DoxyCodeLine{00042         InitDirect3DApp theApp(hInstance);}
\DoxyCodeLine{00043         \textcolor{keywordflow}{if} (!theApp.Initialize())}
\DoxyCodeLine{00044             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00046         \textcolor{keywordflow}{return} theApp.Run();}
\DoxyCodeLine{00047     \}}
\DoxyCodeLine{00048     \textcolor{keywordflow}{catch} (DxException\& e)}
\DoxyCodeLine{00049     \{}
\DoxyCodeLine{00050         MessageBox(\textcolor{keyword}{nullptr}, e.ToString().c\_str(), L\textcolor{stringliteral}{"{}HR Failed"{}}, MB\_OK);}
\DoxyCodeLine{00051         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00052     \}}
\DoxyCodeLine{00053 \}}
\DoxyCodeLine{00054 }
\DoxyCodeLine{00055 InitDirect3DApp::InitDirect3DApp(HINSTANCE hInstance)}
\DoxyCodeLine{00056     : D3DApp(hInstance)}
\DoxyCodeLine{00057 \{}
\DoxyCodeLine{00058 \}}
\DoxyCodeLine{00059 }
\DoxyCodeLine{00060 InitDirect3DApp::\string~InitDirect3DApp()}
\DoxyCodeLine{00061 \{}
\DoxyCodeLine{00062 \}}
\DoxyCodeLine{00063 }
\DoxyCodeLine{00064 \textcolor{keywordtype}{bool} InitDirect3DApp::Initialize()}
\DoxyCodeLine{00065 \{}
\DoxyCodeLine{00066     \textcolor{keywordflow}{if} (!D3DApp::Initialize())}
\DoxyCodeLine{00067         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00068 }
\DoxyCodeLine{00069     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00070 \}}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072 \textcolor{keywordtype}{void} InitDirect3DApp::OnResize()}
\DoxyCodeLine{00073 \{}
\DoxyCodeLine{00074     D3DApp::OnResize();}
\DoxyCodeLine{00075 \}}
\DoxyCodeLine{00076 }
\DoxyCodeLine{00077 \textcolor{keywordtype}{void} InitDirect3DApp::Update(\textcolor{keyword}{const} GameTimer\& gt)}
\DoxyCodeLine{00078 \{}
\DoxyCodeLine{00079 }
\DoxyCodeLine{00080 \}}
\DoxyCodeLine{00081 }
\DoxyCodeLine{00082 }
\DoxyCodeLine{00083 }
\DoxyCodeLine{00084 \textcolor{keywordtype}{void} InitDirect3DApp::Draw(\textcolor{keyword}{const} GameTimer\& gt)}
\DoxyCodeLine{00085 \{}
\DoxyCodeLine{00086     \textcolor{comment}{// Reuse the memory associated with command recording.}}
\DoxyCodeLine{00087     \textcolor{comment}{// We can only reset when the associated command lists have finished execution on the GPU.}}
\DoxyCodeLine{00088     ThrowIfFailed(mDirectCmdListAlloc-\/>Reset());}
\DoxyCodeLine{00089 }
\DoxyCodeLine{00090     \textcolor{comment}{// A command list can be reset after it has been added to the command queue via ExecuteCommandList.}}
\DoxyCodeLine{00091     \textcolor{comment}{// Reusing the command list reuses memory.}}
\DoxyCodeLine{00092     ThrowIfFailed(mCommandList-\/>Reset(mDirectCmdListAlloc.Get(), \textcolor{keyword}{nullptr}));}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094     \textcolor{comment}{// Indicate a state transition on the resource usage.}}
\DoxyCodeLine{00095     mCommandList-\/>ResourceBarrier(1, \&CD3DX12\_RESOURCE\_BARRIER::Transition(CurrentBackBuffer(),}
\DoxyCodeLine{00096         D3D12\_RESOURCE\_STATE\_PRESENT, D3D12\_RESOURCE\_STATE\_RENDER\_TARGET));}
\DoxyCodeLine{00097 }
\DoxyCodeLine{00098     \textcolor{comment}{// Set the viewport and scissor rect.  This needs to be reset whenever the command list is reset.}}
\DoxyCodeLine{00099     mCommandList-\/>RSSetViewports(1, \&mScreenViewport);}
\DoxyCodeLine{00100     mCommandList-\/>RSSetScissorRects(1, \&mScissorRect);}
\DoxyCodeLine{00101 }
\DoxyCodeLine{00102     \textcolor{comment}{// Clear the back buffer and depth buffer.}}
\DoxyCodeLine{00103     mCommandList-\/>ClearRenderTargetView(CurrentBackBufferView(), Colors::LightSteelBlue, 0, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00104     mCommandList-\/>ClearDepthStencilView(DepthStencilView(), D3D12\_CLEAR\_FLAG\_DEPTH | D3D12\_CLEAR\_FLAG\_STENCIL, 1.0f, 0, 0, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00105 }
\DoxyCodeLine{00106     \textcolor{comment}{// Specify the buffers we are going to render to.}}
\DoxyCodeLine{00107     mCommandList-\/>OMSetRenderTargets(1, \&CurrentBackBufferView(), \textcolor{keyword}{true}, \&DepthStencilView());}
\DoxyCodeLine{00108 }
\DoxyCodeLine{00109     \textcolor{comment}{// Indicate a state transition on the resource usage.}}
\DoxyCodeLine{00110     mCommandList-\/>ResourceBarrier(1, \&CD3DX12\_RESOURCE\_BARRIER::Transition(CurrentBackBuffer(),}
\DoxyCodeLine{00111         D3D12\_RESOURCE\_STATE\_RENDER\_TARGET, D3D12\_RESOURCE\_STATE\_PRESENT));}
\DoxyCodeLine{00112 }
\DoxyCodeLine{00113     \textcolor{comment}{// Done recording commands.}}
\DoxyCodeLine{00114     ThrowIfFailed(mCommandList-\/>Close());}
\DoxyCodeLine{00115 }
\DoxyCodeLine{00116     \textcolor{comment}{// Add the command list to the queue for execution.}}
\DoxyCodeLine{00117     ID3D12CommandList* cmdsLists[] = \{ mCommandList.Get() \};}
\DoxyCodeLine{00118     mCommandQueue-\/>ExecuteCommandLists(\_countof(cmdsLists), cmdsLists);}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120     \textcolor{comment}{// swap the back and front buffers}}
\DoxyCodeLine{00121     ThrowIfFailed(mSwapChain-\/>Present(0, 0));}
\DoxyCodeLine{00122     mCurrBackBuffer = (mCurrBackBuffer + 1) \% SwapChainBufferCount;}
\DoxyCodeLine{00123 }
\DoxyCodeLine{00124     \textcolor{comment}{// Wait until frame commands are complete.  This waiting is inefficient and is}}
\DoxyCodeLine{00125     \textcolor{comment}{// done for simplicity.  Later we will show how to organize our rendering code}}
\DoxyCodeLine{00126     \textcolor{comment}{// so we do not have to wait per frame.}}
\DoxyCodeLine{00127     FlushCommandQueue();}
\DoxyCodeLine{00128 \}}

\end{DoxyCode}
