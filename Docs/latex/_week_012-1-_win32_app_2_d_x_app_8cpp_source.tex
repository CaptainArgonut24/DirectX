\doxysection{DXApp.\+cpp}
\label{_week_012-1-_win32_app_2_d_x_app_8cpp_source}\index{Week2/Week 2-\/1-\/Win32App/DXApp.cpp@{Week2/Week 2-\/1-\/Win32App/DXApp.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{preprocessor}{\#include "{}DXApp.h"{}}}
\DoxyCodeLine{00002 }
\DoxyCodeLine{00003 }
\DoxyCodeLine{00004 \textcolor{keyword}{namespace }\{}
\DoxyCodeLine{00005     \textcolor{comment}{//used to forward messages to user defined proc function}}
\DoxyCodeLine{00006     DXApp* g\_App = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00007 \}}
\DoxyCodeLine{00008 }
\DoxyCodeLine{00009 LRESULT CALLBACK MainWndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)}
\DoxyCodeLine{00010 \{}
\DoxyCodeLine{00011     \textcolor{comment}{//step4:Window procedures are functions we implement which contain code that is to be executed in response to specific messages.}}
\DoxyCodeLine{00012     \textcolor{keywordflow}{if} (g\_App) g\_App-\/>MsgProc(hwnd, msg, wParam, lParam);}
\DoxyCodeLine{00013     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00014         \textcolor{comment}{//The messages a window does not handle should be forwarded to the default window}}
\DoxyCodeLine{00015         \textcolor{comment}{//procedure, which then handles the message.The Win32 API supplies the default window}}
\DoxyCodeLine{00016         \textcolor{comment}{//procedure, which is called DefWindowProc.}}
\DoxyCodeLine{00017         \textcolor{keywordflow}{return} DefWindowProc(hwnd, msg, wParam, lParam);}
\DoxyCodeLine{00018 \}}
\DoxyCodeLine{00019 }
\DoxyCodeLine{00020 DXApp::DXApp(HINSTANCE hInstance)}
\DoxyCodeLine{00021 \{}
\DoxyCodeLine{00022     m\_hAppInstance = hInstance;}
\DoxyCodeLine{00023     m\_hAppWnd = NULL; \textcolor{comment}{//we don't have a window yet}}
\DoxyCodeLine{00024     m\_ClientWidth = 800;}
\DoxyCodeLine{00025     m\_ClientHeight = 800;}
\DoxyCodeLine{00026     m\_AppTitle = \textcolor{stringliteral}{"{}DirectX12 Application"{}};}
\DoxyCodeLine{00027     m\_WndStyle = WS\_OVERLAPPEDWINDOW; \textcolor{comment}{//basic maximize, minimize, etc.. }}
\DoxyCodeLine{00028     g\_App = \textcolor{keyword}{this};}
\DoxyCodeLine{00029 \}}
\DoxyCodeLine{00030 }
\DoxyCodeLine{00031 DXApp::\string~DXApp()}
\DoxyCodeLine{00032 \{}
\DoxyCodeLine{00033 \}}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035 \textcolor{keywordtype}{int} DXApp::Run()}
\DoxyCodeLine{00036 \{}
\DoxyCodeLine{00037     \textcolor{comment}{//step3: A Windows application follows an event-\/driven programming model.}}
\DoxyCodeLine{00038     \textcolor{comment}{//An event can be generated in a number of ways:key presses, mouse clicks,}}
\DoxyCodeLine{00039     \textcolor{comment}{//and when a window is created, resized, moved, closed, minimized, maximized, or becomes visible.}}
\DoxyCodeLine{00040     \textcolor{comment}{//When an event occurs, Windows sends a message to the application the event}}
\DoxyCodeLine{00041     \textcolor{comment}{//occurred for, and adds the message to the application’s message queue}}
\DoxyCodeLine{00042     \textcolor{comment}{//The application constantly checks the message queue for messages in a message loop}}
\DoxyCodeLine{00043 }
\DoxyCodeLine{00044     \textcolor{comment}{//Main Message Loop}}
\DoxyCodeLine{00045     MSG msg = \{ 0 \};}
\DoxyCodeLine{00046     \textcolor{keywordflow}{while} (WM\_QUIT != msg.message)}
\DoxyCodeLine{00047     \{}
\DoxyCodeLine{00048         \textcolor{comment}{//when the application receives a message, it dispatches the message to the window procedure of the particular window the message is for}}
\DoxyCodeLine{00049         \textcolor{keywordflow}{if} (PeekMessage(\&msg, NULL, NULL, NULL, PM\_REMOVE)) \textcolor{comment}{//peek and remove from the stack}}
\DoxyCodeLine{00050         \{}
\DoxyCodeLine{00051             TranslateMessage(\&msg);  \textcolor{comment}{//Translates virtual-\/key messages (alt + ctrl + escape..) into character messages. WM\_KEYDOWN and WM\_KEYUP combinations produce a WM\_CHAR}}
\DoxyCodeLine{00052             DispatchMessage(\&msg);   \textcolor{comment}{//Dispatches a message to a window procedure (MainWndProc).}}
\DoxyCodeLine{00053         \}}
\DoxyCodeLine{00054         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00055         \{}
\DoxyCodeLine{00056             \textcolor{comment}{//In off-\/time we update and render}}
\DoxyCodeLine{00057             Update(0.0);}
\DoxyCodeLine{00058             Render(0.0);}
\DoxyCodeLine{00059         \}}
\DoxyCodeLine{00060     \}}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062     \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(msg.wParam);}
\DoxyCodeLine{00063 \}}
\DoxyCodeLine{00064 }
\DoxyCodeLine{00065 \textcolor{keywordtype}{bool} DXApp::Init()}
\DoxyCodeLine{00066 \{}
\DoxyCodeLine{00067     \textcolor{keywordflow}{if} (!InitWindow())}
\DoxyCodeLine{00068         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00069     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00070 \}}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072 \textcolor{keywordtype}{bool} DXApp::InitWindow()}
\DoxyCodeLine{00073 \{}
\DoxyCodeLine{00074     \textcolor{comment}{//WNDCLASSEX -\/ Bear in mind that the only difference between CreateWindow and CreateWindowEx is the addition of extended styles to the latter. You can use either type of window class structure with them.}}
\DoxyCodeLine{00075     WNDCLASSEX wcex;}
\DoxyCodeLine{00076     ZeroMemory(\&wcex, \textcolor{keyword}{sizeof}(WNDCLASSEX)); \textcolor{comment}{//Fills a block of memory with zeros.}}
\DoxyCodeLine{00077     wcex.style = CS\_HREDRAW | CS\_VREDRAW;}
\DoxyCodeLine{00078     wcex.lpfnWndProc = MainWndProc;}
\DoxyCodeLine{00079     wcex.cbClsExtra = 0;}
\DoxyCodeLine{00080     wcex.cbWndExtra = 0;}
\DoxyCodeLine{00081     wcex.cbSize = \textcolor{keyword}{sizeof}(WNDCLASSEX);}
\DoxyCodeLine{00082     wcex.hInstance = m\_hAppInstance;}
\DoxyCodeLine{00083     wcex.hIcon = LoadIcon(0, IDI\_APPLICATION);}
\DoxyCodeLine{00084     wcex.hCursor = LoadCursor(0, IDC\_ARROW);}
\DoxyCodeLine{00085     wcex.hbrBackground = (HBRUSH)GetStockObject(NULL\_BRUSH);}
\DoxyCodeLine{00086     wcex.lpszMenuName = 0;}
\DoxyCodeLine{00087     wcex.lpszClassName = L\textcolor{stringliteral}{"{}DXAPPWNDCLASS"{}};}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089     \textcolor{comment}{//register with Windows OS}}
\DoxyCodeLine{00090     \textcolor{keywordflow}{if} (!RegisterClassEx(\&wcex))}
\DoxyCodeLine{00091     \{}
\DoxyCodeLine{00092         OutputDebugString(L\textcolor{stringliteral}{"{}Failed to create Window Class\(\backslash\)n"{}});}
\DoxyCodeLine{00093         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00094     \}}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096     RECT r = \{ 0,0, m\_ClientWidth, m\_ClientHeight \};}
\DoxyCodeLine{00097     AdjustWindowRect(\&r, m\_WndStyle, FALSE);}
\DoxyCodeLine{00098     UINT width = r.right -\/ r.left;}
\DoxyCodeLine{00099     UINT height = r.bottom -\/ r.top;}
\DoxyCodeLine{00100     UINT x = GetSystemMetrics(SM\_CXSCREEN) / 2 -\/ width / 2;}
\DoxyCodeLine{00101     UINT y = GetSystemMetrics(SM\_CXSCREEN) / 2 -\/ height / 2;}
\DoxyCodeLine{00102     \textcolor{comment}{//step1 we use WIN32 API to create window -\/ when using 16-\/bit wide-\/characters (unicode), we must prefix a string literal with a capital L!}}
\DoxyCodeLine{00103     m\_hAppWnd = CreateWindow(L\textcolor{stringliteral}{"{}DXAPPWNDCLASS"{}}, L\textcolor{stringliteral}{"{}test"{}}, m\_WndStyle, x, y, width, height, NULL, NULL, m\_hAppInstance, NULL);}
\DoxyCodeLine{00104 }
\DoxyCodeLine{00105     \textcolor{keywordflow}{if} (!m\_hAppWnd) \{}
\DoxyCodeLine{00106         OutputDebugString(L\textcolor{stringliteral}{"{}Failed to create Window \(\backslash\)n"{}});}
\DoxyCodeLine{00107         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00108     \}}
\DoxyCodeLine{00109 }
\DoxyCodeLine{00110     \textcolor{comment}{//step2 to notify Windows to show a particular window. Note that Windows applications do not have direct access to hardware.}}
\DoxyCodeLine{00111     \textcolor{comment}{//For example, to display a window you must call the Win32 API function ShowWindow; you cannot write to video memory directly.}}
\DoxyCodeLine{00112     ShowWindow(m\_hAppWnd, SW\_SHOW);}
\DoxyCodeLine{00113 }
\DoxyCodeLine{00114     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00115 \}}
\DoxyCodeLine{00116 }
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118 \textcolor{comment}{//step5: Once upon a time, Windows was 16 -\/ bit.Each message could carry with it two pieces of data, called WPARAMand LPARAM.The first one was a 16 -\/ bit value(“word”), so it was called W.The second one was a 32 -\/ bit value(“long”), so it was called L.}}
\DoxyCodeLine{00119 \textcolor{comment}{//You used the W parameter to pass things like handles and integers.You used the L parameter to pass pointers.}}
\DoxyCodeLine{00120 \textcolor{comment}{//When Windows was converted to 32 -\/ bit, the WPARAM parameter grew to a 32 -\/ bit value as well.So even though the “W” stands for “word”, it isn’t a word any more. (And in 64 -\/ bit Windows, both parameters are 64 -\/ bit values!)}}
\DoxyCodeLine{00121 }
\DoxyCodeLine{00122 \textcolor{comment}{//typedef LONG\_PTR LRESULT}}
\DoxyCodeLine{00123 LRESULT DXApp::MsgProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)}
\DoxyCodeLine{00124 \{}
\DoxyCodeLine{00125     \textcolor{comment}{//step6: For instance, we may want to destroy a window when the Escape key is pressed.}}
\DoxyCodeLine{00126     \textcolor{keywordflow}{switch} (msg)}
\DoxyCodeLine{00127     \{}
\DoxyCodeLine{00128     \textcolor{keywordflow}{case} WM\_KEYDOWN:}
\DoxyCodeLine{00129         \textcolor{keywordflow}{if} (wParam == VK\_ESCAPE)}
\DoxyCodeLine{00130             DestroyWindow(m\_hAppWnd);}
\DoxyCodeLine{00131         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00132     \textcolor{keywordflow}{case} WM\_DESTROY:}
\DoxyCodeLine{00133         PostQuitMessage(0);  \textcolor{comment}{//Indicates to the system that a thread has made a request to terminate}}
\DoxyCodeLine{00134         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00135 }
\DoxyCodeLine{00136     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00137         \textcolor{keywordflow}{return} DefWindowProc(hwnd, msg, wParam, lParam); \textcolor{comment}{//wParam, lParam..mouse position..ket down...}}
\DoxyCodeLine{00138     \}}
\DoxyCodeLine{00139 }
\DoxyCodeLine{00140 \}}

\end{DoxyCode}
