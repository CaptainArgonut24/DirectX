\doxysection{Camera.\+cpp}
\label{_camera_8cpp_source}\index{Common/Camera.cpp@{Common/Camera.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{//***************************************************************************************}}
\DoxyCodeLine{00002 \textcolor{comment}{// Camera.h by Frank Luna (C) 2011 All Rights Reserved.}}
\DoxyCodeLine{00003 \textcolor{comment}{//***************************************************************************************}}
\DoxyCodeLine{00004 }
\DoxyCodeLine{00005 \textcolor{preprocessor}{\#include "{}Camera.h"{}}}
\DoxyCodeLine{00006 }
\DoxyCodeLine{00007 \textcolor{keyword}{using namespace }DirectX;}
\DoxyCodeLine{00008 }
\DoxyCodeLine{00009 Camera::Camera()}
\DoxyCodeLine{00010 \{}
\DoxyCodeLine{00011     SetLens(0.25f*MathHelper::Pi, 1.0f, 1.0f, 1000.0f);}
\DoxyCodeLine{00012 \}}
\DoxyCodeLine{00013 }
\DoxyCodeLine{00014 Camera::\string~Camera()}
\DoxyCodeLine{00015 \{}
\DoxyCodeLine{00016 \}}
\DoxyCodeLine{00017 }
\DoxyCodeLine{00018 XMVECTOR Camera::GetPosition()\textcolor{keyword}{const}}
\DoxyCodeLine{00019 \textcolor{keyword}{}\{}
\DoxyCodeLine{00020     \textcolor{keywordflow}{return} XMLoadFloat3(\&mPosition);}
\DoxyCodeLine{00021 \}}
\DoxyCodeLine{00022 }
\DoxyCodeLine{00023 XMFLOAT3 Camera::GetPosition3f()\textcolor{keyword}{const}}
\DoxyCodeLine{00024 \textcolor{keyword}{}\{}
\DoxyCodeLine{00025     \textcolor{keywordflow}{return} mPosition;}
\DoxyCodeLine{00026 \}}
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028 \textcolor{keywordtype}{void} Camera::SetPosition(\textcolor{keywordtype}{float} x, \textcolor{keywordtype}{float} y, \textcolor{keywordtype}{float} z)}
\DoxyCodeLine{00029 \{}
\DoxyCodeLine{00030     mPosition = XMFLOAT3(x, y, z);}
\DoxyCodeLine{00031     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00032 \}}
\DoxyCodeLine{00033 }
\DoxyCodeLine{00034 \textcolor{keywordtype}{void} Camera::SetPosition(\textcolor{keyword}{const} XMFLOAT3\& v)}
\DoxyCodeLine{00035 \{}
\DoxyCodeLine{00036     mPosition = v;}
\DoxyCodeLine{00037     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00038 \}}
\DoxyCodeLine{00039 }
\DoxyCodeLine{00040 XMVECTOR Camera::GetRight()\textcolor{keyword}{const}}
\DoxyCodeLine{00041 \textcolor{keyword}{}\{}
\DoxyCodeLine{00042     \textcolor{keywordflow}{return} XMLoadFloat3(\&mRight);}
\DoxyCodeLine{00043 \}}
\DoxyCodeLine{00044 }
\DoxyCodeLine{00045 XMFLOAT3 Camera::GetRight3f()\textcolor{keyword}{const}}
\DoxyCodeLine{00046 \textcolor{keyword}{}\{}
\DoxyCodeLine{00047     \textcolor{keywordflow}{return} mRight;}
\DoxyCodeLine{00048 \}}
\DoxyCodeLine{00049 }
\DoxyCodeLine{00050 XMVECTOR Camera::GetUp()\textcolor{keyword}{const}}
\DoxyCodeLine{00051 \textcolor{keyword}{}\{}
\DoxyCodeLine{00052     \textcolor{keywordflow}{return} XMLoadFloat3(\&mUp);}
\DoxyCodeLine{00053 \}}
\DoxyCodeLine{00054 }
\DoxyCodeLine{00055 XMFLOAT3 Camera::GetUp3f()\textcolor{keyword}{const}}
\DoxyCodeLine{00056 \textcolor{keyword}{}\{}
\DoxyCodeLine{00057     \textcolor{keywordflow}{return} mUp;}
\DoxyCodeLine{00058 \}}
\DoxyCodeLine{00059 }
\DoxyCodeLine{00060 XMVECTOR Camera::GetLook()\textcolor{keyword}{const}}
\DoxyCodeLine{00061 \textcolor{keyword}{}\{}
\DoxyCodeLine{00062     \textcolor{keywordflow}{return} XMLoadFloat3(\&mLook);}
\DoxyCodeLine{00063 \}}
\DoxyCodeLine{00064 }
\DoxyCodeLine{00065 XMFLOAT3 Camera::GetLook3f()\textcolor{keyword}{const}}
\DoxyCodeLine{00066 \textcolor{keyword}{}\{}
\DoxyCodeLine{00067     \textcolor{keywordflow}{return} mLook;}
\DoxyCodeLine{00068 \}}
\DoxyCodeLine{00069 }
\DoxyCodeLine{00070 \textcolor{keywordtype}{float} Camera::GetNearZ()\textcolor{keyword}{const}}
\DoxyCodeLine{00071 \textcolor{keyword}{}\{}
\DoxyCodeLine{00072     \textcolor{keywordflow}{return} mNearZ;}
\DoxyCodeLine{00073 \}}
\DoxyCodeLine{00074 }
\DoxyCodeLine{00075 \textcolor{keywordtype}{float} Camera::GetFarZ()\textcolor{keyword}{const}}
\DoxyCodeLine{00076 \textcolor{keyword}{}\{}
\DoxyCodeLine{00077     \textcolor{keywordflow}{return} mFarZ;}
\DoxyCodeLine{00078 \}}
\DoxyCodeLine{00079 }
\DoxyCodeLine{00080 \textcolor{keywordtype}{float} Camera::GetAspect()\textcolor{keyword}{const}}
\DoxyCodeLine{00081 \textcolor{keyword}{}\{}
\DoxyCodeLine{00082     \textcolor{keywordflow}{return} mAspect;}
\DoxyCodeLine{00083 \}}
\DoxyCodeLine{00084 }
\DoxyCodeLine{00085 \textcolor{keywordtype}{float} Camera::GetFovY()\textcolor{keyword}{const}}
\DoxyCodeLine{00086 \textcolor{keyword}{}\{}
\DoxyCodeLine{00087     \textcolor{keywordflow}{return} mFovY;}
\DoxyCodeLine{00088 \}}
\DoxyCodeLine{00089 }
\DoxyCodeLine{00090 \textcolor{keywordtype}{float} Camera::GetFovX()\textcolor{keyword}{const}}
\DoxyCodeLine{00091 \textcolor{keyword}{}\{}
\DoxyCodeLine{00092     \textcolor{keywordtype}{float} halfWidth = 0.5f*GetNearWindowWidth();}
\DoxyCodeLine{00093     \textcolor{keywordflow}{return} 2.0f*atan(halfWidth / mNearZ);}
\DoxyCodeLine{00094 \}}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096 \textcolor{keywordtype}{float} Camera::GetNearWindowWidth()\textcolor{keyword}{const}}
\DoxyCodeLine{00097 \textcolor{keyword}{}\{}
\DoxyCodeLine{00098     \textcolor{keywordflow}{return} mAspect * mNearWindowHeight;}
\DoxyCodeLine{00099 \}}
\DoxyCodeLine{00100 }
\DoxyCodeLine{00101 \textcolor{keywordtype}{float} Camera::GetNearWindowHeight()\textcolor{keyword}{const}}
\DoxyCodeLine{00102 \textcolor{keyword}{}\{}
\DoxyCodeLine{00103     \textcolor{keywordflow}{return} mNearWindowHeight;}
\DoxyCodeLine{00104 \}}
\DoxyCodeLine{00105 }
\DoxyCodeLine{00106 \textcolor{keywordtype}{float} Camera::GetFarWindowWidth()\textcolor{keyword}{const}}
\DoxyCodeLine{00107 \textcolor{keyword}{}\{}
\DoxyCodeLine{00108     \textcolor{keywordflow}{return} mAspect * mFarWindowHeight;}
\DoxyCodeLine{00109 \}}
\DoxyCodeLine{00110 }
\DoxyCodeLine{00111 \textcolor{keywordtype}{float} Camera::GetFarWindowHeight()\textcolor{keyword}{const}}
\DoxyCodeLine{00112 \textcolor{keyword}{}\{}
\DoxyCodeLine{00113     \textcolor{keywordflow}{return} mFarWindowHeight;}
\DoxyCodeLine{00114 \}}
\DoxyCodeLine{00115 }
\DoxyCodeLine{00116 \textcolor{keywordtype}{void} Camera::SetLens(\textcolor{keywordtype}{float} fovY, \textcolor{keywordtype}{float} aspect, \textcolor{keywordtype}{float} zn, \textcolor{keywordtype}{float} zf)}
\DoxyCodeLine{00117 \{}
\DoxyCodeLine{00118     \textcolor{comment}{// cache properties}}
\DoxyCodeLine{00119     mFovY = fovY;}
\DoxyCodeLine{00120     mAspect = aspect;}
\DoxyCodeLine{00121     mNearZ = zn;}
\DoxyCodeLine{00122     mFarZ = zf;}
\DoxyCodeLine{00123 }
\DoxyCodeLine{00124     mNearWindowHeight = 2.0f * mNearZ * tanf( 0.5f*mFovY );}
\DoxyCodeLine{00125     mFarWindowHeight  = 2.0f * mFarZ * tanf( 0.5f*mFovY );}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127     XMMATRIX P = XMMatrixPerspectiveFovLH(mFovY, mAspect, mNearZ, mFarZ);}
\DoxyCodeLine{00128     XMStoreFloat4x4(\&mProj, P);}
\DoxyCodeLine{00129 \}}
\DoxyCodeLine{00130 }
\DoxyCodeLine{00131 \textcolor{keywordtype}{void} Camera::LookAt(FXMVECTOR pos, FXMVECTOR target, FXMVECTOR worldUp)}
\DoxyCodeLine{00132 \{}
\DoxyCodeLine{00133     XMVECTOR L = XMVector3Normalize(XMVectorSubtract(target, pos));}
\DoxyCodeLine{00134     XMVECTOR R = XMVector3Normalize(XMVector3Cross(worldUp, L));}
\DoxyCodeLine{00135     XMVECTOR U = XMVector3Cross(L, R);}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137     XMStoreFloat3(\&mPosition, pos);}
\DoxyCodeLine{00138     XMStoreFloat3(\&mLook, L);}
\DoxyCodeLine{00139     XMStoreFloat3(\&mRight, R);}
\DoxyCodeLine{00140     XMStoreFloat3(\&mUp, U);}
\DoxyCodeLine{00141 }
\DoxyCodeLine{00142     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00143 \}}
\DoxyCodeLine{00144 }
\DoxyCodeLine{00145 \textcolor{keywordtype}{void} Camera::LookAt(\textcolor{keyword}{const} XMFLOAT3\& pos, \textcolor{keyword}{const} XMFLOAT3\& target, \textcolor{keyword}{const} XMFLOAT3\& up)}
\DoxyCodeLine{00146 \{}
\DoxyCodeLine{00147     XMVECTOR P = XMLoadFloat3(\&pos);}
\DoxyCodeLine{00148     XMVECTOR T = XMLoadFloat3(\&target);}
\DoxyCodeLine{00149     XMVECTOR U = XMLoadFloat3(\&up);}
\DoxyCodeLine{00150 }
\DoxyCodeLine{00151     LookAt(P, T, U);}
\DoxyCodeLine{00152 }
\DoxyCodeLine{00153     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00154 \}}
\DoxyCodeLine{00155 }
\DoxyCodeLine{00156 XMMATRIX Camera::GetView()\textcolor{keyword}{const}}
\DoxyCodeLine{00157 \textcolor{keyword}{}\{}
\DoxyCodeLine{00158     assert(!mViewDirty);}
\DoxyCodeLine{00159     \textcolor{keywordflow}{return} XMLoadFloat4x4(\&mView);}
\DoxyCodeLine{00160 \}}
\DoxyCodeLine{00161 }
\DoxyCodeLine{00162 XMMATRIX Camera::GetProj()\textcolor{keyword}{const}}
\DoxyCodeLine{00163 \textcolor{keyword}{}\{}
\DoxyCodeLine{00164     \textcolor{keywordflow}{return} XMLoadFloat4x4(\&mProj);}
\DoxyCodeLine{00165 \}}
\DoxyCodeLine{00166 }
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168 XMFLOAT4X4 Camera::GetView4x4f()\textcolor{keyword}{const}}
\DoxyCodeLine{00169 \textcolor{keyword}{}\{}
\DoxyCodeLine{00170     assert(!mViewDirty);}
\DoxyCodeLine{00171     \textcolor{keywordflow}{return} mView;}
\DoxyCodeLine{00172 \}}
\DoxyCodeLine{00173 }
\DoxyCodeLine{00174 XMFLOAT4X4 Camera::GetProj4x4f()\textcolor{keyword}{const}}
\DoxyCodeLine{00175 \textcolor{keyword}{}\{}
\DoxyCodeLine{00176     \textcolor{keywordflow}{return} mProj;}
\DoxyCodeLine{00177 \}}
\DoxyCodeLine{00178 }
\DoxyCodeLine{00179 \textcolor{keywordtype}{void} Camera::Strafe(\textcolor{keywordtype}{float} d)}
\DoxyCodeLine{00180 \{}
\DoxyCodeLine{00181     \textcolor{comment}{// mPosition += d*mRight}}
\DoxyCodeLine{00182     XMVECTOR s = XMVectorReplicate(d);}
\DoxyCodeLine{00183     XMVECTOR r = XMLoadFloat3(\&mRight);}
\DoxyCodeLine{00184     XMVECTOR p = XMLoadFloat3(\&mPosition);}
\DoxyCodeLine{00185     XMStoreFloat3(\&mPosition, XMVectorMultiplyAdd(s, r, p));}
\DoxyCodeLine{00186 }
\DoxyCodeLine{00187     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00188 \}}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190 \textcolor{keywordtype}{void} Camera::Walk(\textcolor{keywordtype}{float} d)}
\DoxyCodeLine{00191 \{}
\DoxyCodeLine{00192     \textcolor{comment}{// mPosition += d*mLook}}
\DoxyCodeLine{00193     XMVECTOR s = XMVectorReplicate(d);}
\DoxyCodeLine{00194     XMVECTOR l = XMLoadFloat3(\&mLook);}
\DoxyCodeLine{00195     XMVECTOR p = XMLoadFloat3(\&mPosition);}
\DoxyCodeLine{00196     XMStoreFloat3(\&mPosition, XMVectorMultiplyAdd(s, l, p));}
\DoxyCodeLine{00197 }
\DoxyCodeLine{00198     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00199 \}}
\DoxyCodeLine{00200 }
\DoxyCodeLine{00201 }
\DoxyCodeLine{00202 \textcolor{keywordtype}{void} Camera::Pedestal(\textcolor{keywordtype}{float} d)}
\DoxyCodeLine{00203 \{}
\DoxyCodeLine{00204     \textcolor{comment}{// mPosition += d*mUp}}
\DoxyCodeLine{00205     XMVECTOR s = XMVectorReplicate(d);}
\DoxyCodeLine{00206     XMVECTOR u = XMLoadFloat3(\&mUp);}
\DoxyCodeLine{00207     XMVECTOR p = XMLoadFloat3(\&mPosition);}
\DoxyCodeLine{00208     XMStoreFloat3(\&mPosition, XMVectorMultiplyAdd(s, u, p));}
\DoxyCodeLine{00209 }
\DoxyCodeLine{00210     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00211 \}}
\DoxyCodeLine{00212 }
\DoxyCodeLine{00213 \textcolor{keywordtype}{void} Camera::Pitch(\textcolor{keywordtype}{float} angle)}
\DoxyCodeLine{00214 \{}
\DoxyCodeLine{00215     \textcolor{comment}{// Rotate up and look vector about the right vector.}}
\DoxyCodeLine{00216 }
\DoxyCodeLine{00217     XMMATRIX R = XMMatrixRotationAxis(XMLoadFloat3(\&mRight), angle);}
\DoxyCodeLine{00218 }
\DoxyCodeLine{00219     XMStoreFloat3(\&mUp,   XMVector3TransformNormal(XMLoadFloat3(\&mUp), R));}
\DoxyCodeLine{00220     XMStoreFloat3(\&mLook, XMVector3TransformNormal(XMLoadFloat3(\&mLook), R));}
\DoxyCodeLine{00221 }
\DoxyCodeLine{00222     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00223 \}}
\DoxyCodeLine{00224 }
\DoxyCodeLine{00225 \textcolor{keywordtype}{void} Camera::RotateY(\textcolor{keywordtype}{float} angle)}
\DoxyCodeLine{00226 \{}
\DoxyCodeLine{00227     \textcolor{comment}{// Rotate the basis vectors about the world y-\/axis.}}
\DoxyCodeLine{00228 }
\DoxyCodeLine{00229     XMMATRIX R = XMMatrixRotationY(angle);}
\DoxyCodeLine{00230 }
\DoxyCodeLine{00231     XMStoreFloat3(\&mRight,   XMVector3TransformNormal(XMLoadFloat3(\&mRight), R));}
\DoxyCodeLine{00232     XMStoreFloat3(\&mUp, XMVector3TransformNormal(XMLoadFloat3(\&mUp), R));}
\DoxyCodeLine{00233     XMStoreFloat3(\&mLook, XMVector3TransformNormal(XMLoadFloat3(\&mLook), R));}
\DoxyCodeLine{00234 }
\DoxyCodeLine{00235     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00236 \}}
\DoxyCodeLine{00237 }
\DoxyCodeLine{00238 \textcolor{keywordtype}{void} Camera::Roll(\textcolor{keywordtype}{float} angle)}
\DoxyCodeLine{00239 \{}
\DoxyCodeLine{00240     \textcolor{comment}{// Rotate the basis vectors about the world y-\/axis.}}
\DoxyCodeLine{00241 }
\DoxyCodeLine{00242     XMMATRIX R = XMMatrixRotationZ(angle);}
\DoxyCodeLine{00243 }
\DoxyCodeLine{00244     XMStoreFloat3(\&mRight, XMVector3TransformNormal(XMLoadFloat3(\&mRight), R));}
\DoxyCodeLine{00245     XMStoreFloat3(\&mUp, XMVector3TransformNormal(XMLoadFloat3(\&mUp), R));}
\DoxyCodeLine{00246     XMStoreFloat3(\&mLook, XMVector3TransformNormal(XMLoadFloat3(\&mLook), R));}
\DoxyCodeLine{00247 }
\DoxyCodeLine{00248     mViewDirty = \textcolor{keyword}{true};}
\DoxyCodeLine{00249 \}}
\DoxyCodeLine{00250 }
\DoxyCodeLine{00251 \textcolor{keywordtype}{void} Camera::UpdateViewMatrix()}
\DoxyCodeLine{00252 \{}
\DoxyCodeLine{00253     \textcolor{keywordflow}{if}(mViewDirty)}
\DoxyCodeLine{00254     \{}
\DoxyCodeLine{00255         XMVECTOR R = XMLoadFloat3(\&mRight);}
\DoxyCodeLine{00256         XMVECTOR U = XMLoadFloat3(\&mUp);}
\DoxyCodeLine{00257         XMVECTOR L = XMLoadFloat3(\&mLook);}
\DoxyCodeLine{00258         XMVECTOR P = XMLoadFloat3(\&mPosition);}
\DoxyCodeLine{00259 }
\DoxyCodeLine{00260         \textcolor{comment}{// Keep camera's axes orthogonal to each other and of unit length.}}
\DoxyCodeLine{00261         L = XMVector3Normalize(L);}
\DoxyCodeLine{00262         U = XMVector3Normalize(XMVector3Cross(L, R));}
\DoxyCodeLine{00263 }
\DoxyCodeLine{00264         \textcolor{comment}{// U, L already ortho-\/normal, so no need to normalize cross product.}}
\DoxyCodeLine{00265         R = XMVector3Cross(U, L);}
\DoxyCodeLine{00266 }
\DoxyCodeLine{00267         \textcolor{comment}{// Fill in the view matrix entries.}}
\DoxyCodeLine{00268         \textcolor{keywordtype}{float} x = -\/XMVectorGetX(XMVector3Dot(P, R));}
\DoxyCodeLine{00269         \textcolor{keywordtype}{float} y = -\/XMVectorGetX(XMVector3Dot(P, U));}
\DoxyCodeLine{00270         \textcolor{keywordtype}{float} z = -\/XMVectorGetX(XMVector3Dot(P, L));}
\DoxyCodeLine{00271 }
\DoxyCodeLine{00272         XMStoreFloat3(\&mRight, R);}
\DoxyCodeLine{00273         XMStoreFloat3(\&mUp, U);}
\DoxyCodeLine{00274         XMStoreFloat3(\&mLook, L);}
\DoxyCodeLine{00275 }
\DoxyCodeLine{00276         mView(0, 0) = mRight.x;}
\DoxyCodeLine{00277         mView(1, 0) = mRight.y;}
\DoxyCodeLine{00278         mView(2, 0) = mRight.z;}
\DoxyCodeLine{00279         mView(3, 0) = x;}
\DoxyCodeLine{00280 }
\DoxyCodeLine{00281         mView(0, 1) = mUp.x;}
\DoxyCodeLine{00282         mView(1, 1) = mUp.y;}
\DoxyCodeLine{00283         mView(2, 1) = mUp.z;}
\DoxyCodeLine{00284         mView(3, 1) = y;}
\DoxyCodeLine{00285 }
\DoxyCodeLine{00286         mView(0, 2) = mLook.x;}
\DoxyCodeLine{00287         mView(1, 2) = mLook.y;}
\DoxyCodeLine{00288         mView(2, 2) = mLook.z;}
\DoxyCodeLine{00289         mView(3, 2) = z;}
\DoxyCodeLine{00290 }
\DoxyCodeLine{00291         mView(0, 3) = 0.0f;}
\DoxyCodeLine{00292         mView(1, 3) = 0.0f;}
\DoxyCodeLine{00293         mView(2, 3) = 0.0f;}
\DoxyCodeLine{00294         mView(3, 3) = 1.0f;}
\DoxyCodeLine{00295 }
\DoxyCodeLine{00296         mViewDirty = \textcolor{keyword}{false};}
\DoxyCodeLine{00297     \}}
\DoxyCodeLine{00298 \}}
\DoxyCodeLine{00299 }
\DoxyCodeLine{00300 }

\end{DoxyCode}
