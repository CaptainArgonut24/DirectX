\doxysection{DXApp.\+cpp}
\label{_week2-5-_direct_x11sample_2_d_x_app_8cpp_source}\index{Week2/Week2-\/5-\/DirectX11sample/DXApp.cpp@{Week2/Week2-\/5-\/DirectX11sample/DXApp.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{preprocessor}{\#include "{}DXApp.h"{}}}
\DoxyCodeLine{00002 }
\DoxyCodeLine{00003 }
\DoxyCodeLine{00004 \textcolor{keyword}{namespace }\{}
\DoxyCodeLine{00005     \textcolor{comment}{//used to forward messages to user defined proc function}}
\DoxyCodeLine{00006     DXApp* g\_App = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00007 \}}
\DoxyCodeLine{00008 }
\DoxyCodeLine{00009 LRESULT CALLBACK MainWndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)}
\DoxyCodeLine{00010 \{}
\DoxyCodeLine{00011     \textcolor{keywordflow}{if} (g\_App) g\_App-\/>MsgProc(hwnd, msg, wParam, lParam);}
\DoxyCodeLine{00012     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00013         \textcolor{keywordflow}{return} DefWindowProc(hwnd, msg, wParam, lParam);}
\DoxyCodeLine{00014 \}}
\DoxyCodeLine{00015 }
\DoxyCodeLine{00016 DXApp::DXApp(HINSTANCE hInstance)}
\DoxyCodeLine{00017 \{}
\DoxyCodeLine{00018     m\_hAppInstance = hInstance;}
\DoxyCodeLine{00019     m\_hAppWnd = NULL; \textcolor{comment}{//we don't have a window yet}}
\DoxyCodeLine{00020     m\_ClientWidth = 800;}
\DoxyCodeLine{00021     m\_ClientHeight = 800;}
\DoxyCodeLine{00022     m\_AppTitle = \textcolor{stringliteral}{"{}DirectX12 Application"{}};}
\DoxyCodeLine{00023     m\_WndStyle = WS\_OVERLAPPEDWINDOW; \textcolor{comment}{//basic maximize, minimize, etc.. }}
\DoxyCodeLine{00024     g\_App = \textcolor{keyword}{this}; \textcolor{comment}{//otherwise app doesn't stop when windows closes!}}
\DoxyCodeLine{00025     }
\DoxyCodeLine{00026     m\_pDevice = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00027     m\_pImmediateContext = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00028     m\_pRenderTargetView = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00029     m\_pSwapChain = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00030 \}}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032 DXApp::\string~DXApp()}
\DoxyCodeLine{00033 \{}
\DoxyCodeLine{00034     \textcolor{comment}{//Cleanup Direct3D}}
\DoxyCodeLine{00035 }
\DoxyCodeLine{00036     \textcolor{keywordflow}{if} (m\_pImmediateContext) m\_pImmediateContext-\/>ClearState();}
\DoxyCodeLine{00037     Memory::SafeRelease(m\_pRenderTargetView);}
\DoxyCodeLine{00038     Memory::SafeRelease(m\_pSwapChain);}
\DoxyCodeLine{00039     Memory::SafeRelease(m\_pImmediateContext);}
\DoxyCodeLine{00040     Memory::SafeRelease(m\_pDevice);}
\DoxyCodeLine{00041 \}}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043 \textcolor{keywordtype}{int} DXApp::Run()}
\DoxyCodeLine{00044 \{}
\DoxyCodeLine{00045     \textcolor{comment}{//Main Message Loop}}
\DoxyCodeLine{00046     MSG msg = \{ 0 \};}
\DoxyCodeLine{00047     \textcolor{keywordflow}{while} (WM\_QUIT != msg.message)}
\DoxyCodeLine{00048     \{}
\DoxyCodeLine{00049         \textcolor{keywordflow}{if} (PeekMessage(\&msg, NULL, NULL, NULL, PM\_REMOVE)) \textcolor{comment}{//peek and remove from the stack}}
\DoxyCodeLine{00050         \{}
\DoxyCodeLine{00051             TranslateMessage(\&msg);}
\DoxyCodeLine{00052             DispatchMessage(\&msg);}
\DoxyCodeLine{00053         \}}
\DoxyCodeLine{00054         \textcolor{keywordflow}{else} }
\DoxyCodeLine{00055         \{}
\DoxyCodeLine{00056             \textcolor{comment}{//In off-\/time we update and render}}
\DoxyCodeLine{00057             Update(0.0);}
\DoxyCodeLine{00058             Render(0.0);}
\DoxyCodeLine{00059         \}}
\DoxyCodeLine{00060     \}}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062     \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(msg.wParam);}
\DoxyCodeLine{00063 \}}
\DoxyCodeLine{00064 }
\DoxyCodeLine{00065 \textcolor{keywordtype}{bool} DXApp::Init()}
\DoxyCodeLine{00066 \{}
\DoxyCodeLine{00067     \textcolor{keywordflow}{if}(!InitWindow())}
\DoxyCodeLine{00068     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00069     \textcolor{keywordflow}{if} (!InitDirect3D())}
\DoxyCodeLine{00070         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00073 \}}
\DoxyCodeLine{00074 }
\DoxyCodeLine{00075 \textcolor{keywordtype}{bool} DXApp::InitWindow()}
\DoxyCodeLine{00076 \{}
\DoxyCodeLine{00077     \textcolor{comment}{//WNDCLASSEX -\/ Bear in mind that the only difference between CreateWindow and CreateWindowEx is the addition of extended styles to the latter. You can use either type of window class structure with them.}}
\DoxyCodeLine{00078     WNDCLASSEX wcex;}
\DoxyCodeLine{00079     ZeroMemory(\&wcex, \textcolor{keyword}{sizeof}(WNDCLASSEX)); \textcolor{comment}{//Fills a block of memory with zeros.}}
\DoxyCodeLine{00080     wcex.style = CS\_HREDRAW | CS\_VREDRAW;}
\DoxyCodeLine{00081     wcex.lpfnWndProc = MainWndProc;}
\DoxyCodeLine{00082     wcex.cbClsExtra = 0;}
\DoxyCodeLine{00083     wcex.cbWndExtra = 0;}
\DoxyCodeLine{00084     wcex.cbSize = \textcolor{keyword}{sizeof}(WNDCLASSEX);}
\DoxyCodeLine{00085     wcex.hInstance = m\_hAppInstance;}
\DoxyCodeLine{00086     wcex.hIcon = LoadIcon(0, IDI\_APPLICATION);}
\DoxyCodeLine{00087     wcex.hCursor = LoadCursor(0, IDC\_ARROW);}
\DoxyCodeLine{00088     wcex.hbrBackground = (HBRUSH)GetStockObject(NULL\_BRUSH);}
\DoxyCodeLine{00089     wcex.lpszMenuName = 0;}
\DoxyCodeLine{00090     wcex.lpszClassName = L\textcolor{stringliteral}{"{}DXAPPWNDCLASS"{}};}
\DoxyCodeLine{00091 }
\DoxyCodeLine{00092     \textcolor{comment}{//register with Windows OS}}
\DoxyCodeLine{00093     \textcolor{keywordflow}{if} (!RegisterClassEx(\&wcex))}
\DoxyCodeLine{00094     \{}
\DoxyCodeLine{00095         OutputDebugString(L\textcolor{stringliteral}{"{}Failed to create Window Class\(\backslash\)n"{}});}
\DoxyCodeLine{00096         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00097     \}}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099     RECT r = \{ 0,0, m\_ClientWidth, m\_ClientHeight \};}
\DoxyCodeLine{00100     AdjustWindowRect(\&r, m\_WndStyle, FALSE);}
\DoxyCodeLine{00101     UINT width = r.right -\/ r.left;}
\DoxyCodeLine{00102     UINT height = r.bottom -\/ r.top;}
\DoxyCodeLine{00103     UINT x = GetSystemMetrics(SM\_CXSCREEN) / 2 -\/ width / 2;}
\DoxyCodeLine{00104     UINT y = GetSystemMetrics(SM\_CXSCREEN) / 2 -\/ height / 2;}
\DoxyCodeLine{00105     m\_hAppWnd = CreateWindow(L\textcolor{stringliteral}{"{}DXAPPWNDCLASS"{}}, L\textcolor{stringliteral}{"{}test"{}}, m\_WndStyle, x, y, width, height, NULL, NULL, m\_hAppInstance, NULL);}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107     \textcolor{keywordflow}{if} (!m\_hAppWnd) \{}
\DoxyCodeLine{00108         OutputDebugString(L\textcolor{stringliteral}{"{}Failed to create Window \(\backslash\)n"{}});}
\DoxyCodeLine{00109         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00110     \}}
\DoxyCodeLine{00111 }
\DoxyCodeLine{00112     ShowWindow(m\_hAppWnd, SW\_SHOW);}
\DoxyCodeLine{00113 }
\DoxyCodeLine{00114     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00115 \}}
\DoxyCodeLine{00116 }
\DoxyCodeLine{00117 \textcolor{keywordtype}{bool} DXApp::InitDirect3D()}
\DoxyCodeLine{00118 \{}
\DoxyCodeLine{00119     UINT createDeviceFlags = 0;}
\DoxyCodeLine{00120 \textcolor{preprocessor}{\#ifdef \_DEBUG }}
\DoxyCodeLine{00121 createDeviceFlags |= D3D11\_CREATE\_DEVICE\_DEBUG;}
\DoxyCodeLine{00122 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//\_DEBUG }}
\DoxyCodeLine{00123 }
\DoxyCodeLine{00124 D3D\_DRIVER\_TYPE driverTypes[] =}
\DoxyCodeLine{00125 \{}
\DoxyCodeLine{00126     D3D\_DRIVER\_TYPE\_HARDWARE, \textcolor{comment}{//graphics card}}
\DoxyCodeLine{00127     D3D\_DRIVER\_TYPE\_WARP,     \textcolor{comment}{//if you don't have graphics card}}
\DoxyCodeLine{00128     D3D\_DRIVER\_TYPE\_REFERENCE }
\DoxyCodeLine{00129 \};}
\DoxyCodeLine{00130 }
\DoxyCodeLine{00131 UINT numDriverTypes = ARRAYSIZE(driverTypes);}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133 }
\DoxyCodeLine{00134 D3D\_FEATURE\_LEVEL featureLevels[] = }
\DoxyCodeLine{00135 \{}
\DoxyCodeLine{00136     D3D\_FEATURE\_LEVEL\_11\_0,}
\DoxyCodeLine{00137     D3D\_FEATURE\_LEVEL\_10\_1,}
\DoxyCodeLine{00138     D3D\_FEATURE\_LEVEL\_10\_0,}
\DoxyCodeLine{00139     D3D\_FEATURE\_LEVEL\_9\_3}
\DoxyCodeLine{00140 \};}
\DoxyCodeLine{00141 UINT numFeatureLevels = ARRAYSIZE(featureLevels);}
\DoxyCodeLine{00142 }
\DoxyCodeLine{00143 DXGI\_SWAP\_CHAIN\_DESC swapDesc;}
\DoxyCodeLine{00144 ZeroMemory(\&swapDesc, \textcolor{keyword}{sizeof}(DXGI\_SWAP\_CHAIN\_DESC));}
\DoxyCodeLine{00145 swapDesc.BufferCount = 1; \textcolor{comment}{//double buffer}}
\DoxyCodeLine{00146 swapDesc.BufferDesc.Width = m\_ClientWidth;}
\DoxyCodeLine{00147 swapDesc.BufferDesc.Height = m\_ClientHeight;}
\DoxyCodeLine{00148 swapDesc.BufferDesc.Format = DXGI\_FORMAT\_R8G8B8A8\_UNORM;}
\DoxyCodeLine{00149 swapDesc.BufferDesc.RefreshRate.Numerator = 60;}
\DoxyCodeLine{00150 swapDesc.BufferDesc.RefreshRate.Denominator = 1;}
\DoxyCodeLine{00151 swapDesc.BufferUsage = DXGI\_USAGE\_RENDER\_TARGET\_OUTPUT;}
\DoxyCodeLine{00152 swapDesc.OutputWindow = m\_hAppWnd;}
\DoxyCodeLine{00153 swapDesc.SwapEffect = DXGI\_SWAP\_EFFECT\_DISCARD;}
\DoxyCodeLine{00154 swapDesc.Windowed = \textcolor{keyword}{true};}
\DoxyCodeLine{00155 swapDesc.SampleDesc.Count = 1;}
\DoxyCodeLine{00156 swapDesc.SampleDesc.Quality = 0;}
\DoxyCodeLine{00157 swapDesc.Flags = DXGI\_SWAP\_CHAIN\_FLAG\_ALLOW\_MODE\_SWITCH; \textcolor{comment}{//alt\_enter full screen}}
\DoxyCodeLine{00158 }
\DoxyCodeLine{00159 HRESULT result;}
\DoxyCodeLine{00160 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0; i< numDriverTypes; i++)}
\DoxyCodeLine{00161 \{}
\DoxyCodeLine{00162     result = D3D11CreateDeviceAndSwapChain(NULL, driverTypes[i], NULL, createDeviceFlags,}
\DoxyCodeLine{00163     featureLevels, numFeatureLevels, D3D11\_SDK\_VERSION, \&swapDesc, \&m\_pSwapChain, \&m\_pDevice,}
\DoxyCodeLine{00164     \&m\_FeatureLevel, \&m\_pImmediateContext);}
\DoxyCodeLine{00165 }
\DoxyCodeLine{00166     \textcolor{keywordflow}{if} (SUCCEEDED(result)) \{}
\DoxyCodeLine{00167         m\_DriverType = driverTypes[i];}
\DoxyCodeLine{00168         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00169     \}}
\DoxyCodeLine{00170 \}}
\DoxyCodeLine{00171 }
\DoxyCodeLine{00172 \textcolor{keywordflow}{if} (FAILED(result)) \{}
\DoxyCodeLine{00173     OutputDebugString(L\textcolor{stringliteral}{"{}Failed To Create Device and Swap chain"{}});}
\DoxyCodeLine{00174     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00175 \}}
\DoxyCodeLine{00176 }
\DoxyCodeLine{00177 \textcolor{comment}{//CREATE RENDER TARGET VIEW}}
\DoxyCodeLine{00178 ID3D11Texture2D* m\_pBackBufferTex = 0;}
\DoxyCodeLine{00179 m\_pSwapChain-\/>GetBuffer(NULL, \_\_uuidof(ID3D11Texture2D), \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{void}**\textcolor{keyword}{>}(\&m\_pBackBufferTex));}
\DoxyCodeLine{00180 m\_pDevice-\/>CreateRenderTargetView(m\_pBackBufferTex, \textcolor{keyword}{nullptr}, \&m\_pRenderTargetView);}
\DoxyCodeLine{00181 }
\DoxyCodeLine{00182 \textcolor{comment}{//BIND RENDER TARGETVIEW}}
\DoxyCodeLine{00183 m\_pImmediateContext-\/>OMSetRenderTargets(1, \&m\_pRenderTargetView, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00184 }
\DoxyCodeLine{00185 \textcolor{comment}{//VIEWPORT CREATION}}
\DoxyCodeLine{00186 m\_Viewport.Width = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>} (m\_ClientWidth);}
\DoxyCodeLine{00187 m\_Viewport.Height = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>} (m\_ClientHeight);}
\DoxyCodeLine{00188 }
\DoxyCodeLine{00189 m\_Viewport.TopLeftX = 0;}
\DoxyCodeLine{00190 m\_Viewport.TopLeftY = 0;}
\DoxyCodeLine{00191 m\_Viewport.MinDepth = 0.0f;}
\DoxyCodeLine{00192 m\_Viewport.MaxDepth = 1.0f;}
\DoxyCodeLine{00193 }
\DoxyCodeLine{00194 \textcolor{comment}{//BIND Viewport}}
\DoxyCodeLine{00195 m\_pImmediateContext-\/>RSSetViewports(1, \&m\_Viewport);}
\DoxyCodeLine{00196 }
\DoxyCodeLine{00197 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00198 \}}
\DoxyCodeLine{00199 }
\DoxyCodeLine{00200 LRESULT DXApp::MsgProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)}
\DoxyCodeLine{00201 \{}
\DoxyCodeLine{00202     \textcolor{keywordflow}{switch} (msg)}
\DoxyCodeLine{00203     \{}
\DoxyCodeLine{00204     \textcolor{keywordflow}{case} WM\_DESTROY:}
\DoxyCodeLine{00205     PostQuitMessage(0);}
\DoxyCodeLine{00206     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00207 }
\DoxyCodeLine{00208     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00209         \textcolor{keywordflow}{return} DefWindowProc(hwnd, msg, wParam, lParam); \textcolor{comment}{//wParam, lParam..mouse position..ket down...}}
\DoxyCodeLine{00210     \}}
\DoxyCodeLine{00211     }
\DoxyCodeLine{00212 \}}

\end{DoxyCode}
