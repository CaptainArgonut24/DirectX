\doxysection{DDSTexture\+Loader.\+cpp}
\label{_d_d_s_texture_loader_8cpp_source}\index{Common/DDSTextureLoader.cpp@{Common/DDSTextureLoader.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002 \textcolor{comment}{// File: DDSTextureLoader.cpp}}
\DoxyCodeLine{00003 \textcolor{comment}{//}}
\DoxyCodeLine{00004 \textcolor{comment}{// Functions for loading a DDS texture and creating a Direct3D 11 runtime resource for it}}
\DoxyCodeLine{00005 \textcolor{comment}{//}}
\DoxyCodeLine{00006 \textcolor{comment}{// Note these functions are useful as a light-\/weight runtime loader for DDS files. For}}
\DoxyCodeLine{00007 \textcolor{comment}{// a full-\/featured DDS file reader, writer, and texture processing pipeline see}}
\DoxyCodeLine{00008 \textcolor{comment}{// the 'Texconv' sample and the 'DirectXTex' library.}}
\DoxyCodeLine{00009 \textcolor{comment}{//}}
\DoxyCodeLine{00010 \textcolor{comment}{// THIS CODE AND INFORMATION IS PROVIDED "{}AS IS"{} WITHOUT WARRANTY OF}}
\DoxyCodeLine{00011 \textcolor{comment}{// ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO}}
\DoxyCodeLine{00012 \textcolor{comment}{// THE IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A}}
\DoxyCodeLine{00013 \textcolor{comment}{// PARTICULAR PURPOSE.}}
\DoxyCodeLine{00014 \textcolor{comment}{//}}
\DoxyCodeLine{00015 \textcolor{comment}{// Copyright (c) Microsoft Corporation. All rights reserved.}}
\DoxyCodeLine{00016 \textcolor{comment}{//}}
\DoxyCodeLine{00017 \textcolor{comment}{// http://go.microsoft.com/fwlink/?LinkId=248926}}
\DoxyCodeLine{00018 \textcolor{comment}{// http://go.microsoft.com/fwlink/?LinkId=248929}}
\DoxyCodeLine{00019 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00020 }
\DoxyCodeLine{00021 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{00022 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{00023 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{00024 \textcolor{preprocessor}{\#include <wrl.h>}}
\DoxyCodeLine{00025 }
\DoxyCodeLine{00026 \textcolor{preprocessor}{\#include "{}DDSTextureLoader.h"{}} }
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028 \textcolor{keyword}{using namespace }Microsoft::WRL;}
\DoxyCodeLine{00029 }
\DoxyCodeLine{00030 \textcolor{preprocessor}{\#if !defined(NO\_D3D11\_DEBUG\_NAME) \&\& ( defined(\_DEBUG) || defined(PROFILE) )}}
\DoxyCodeLine{00031 \textcolor{preprocessor}{\#pragma comment(lib,"{}dxguid.lib"{}})}
\DoxyCodeLine{00032 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00033 }
\DoxyCodeLine{00034 \textcolor{keyword}{using namespace }DirectX;}
\DoxyCodeLine{00035 }
\DoxyCodeLine{00036 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00037 \textcolor{comment}{// Macros}}
\DoxyCodeLine{00038 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00039 \textcolor{preprocessor}{\#ifndef MAKEFOURCC}}
\DoxyCodeLine{00040 \textcolor{preprocessor}{    \#define MAKEFOURCC(ch0, ch1, ch2, ch3)                              \(\backslash\)}}
\DoxyCodeLine{00041 \textcolor{preprocessor}{                ((uint32\_t)(uint8\_t)(ch0) | ((uint32\_t)(uint8\_t)(ch1) << 8) |       \(\backslash\)}}
\DoxyCodeLine{00042 \textcolor{preprocessor}{                ((uint32\_t)(uint8\_t)(ch2) << 16) | ((uint32\_t)(uint8\_t)(ch3) << 24 ))}}
\DoxyCodeLine{00043 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* defined(MAKEFOURCC) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00044 }
\DoxyCodeLine{00045 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00046 \textcolor{comment}{// DDS file structure definitions}}
\DoxyCodeLine{00047 \textcolor{comment}{//}}
\DoxyCodeLine{00048 \textcolor{comment}{// See DDS.h in the 'Texconv' sample and the 'DirectXTex' library}}
\DoxyCodeLine{00049 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00050 \textcolor{preprocessor}{\#pragma pack(push,1)}}
\DoxyCodeLine{00051 }
\DoxyCodeLine{00052 \textcolor{keyword}{const} uint32\_t DDS\_MAGIC = 0x20534444; \textcolor{comment}{// "{}DDS "{}}}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054 \textcolor{keyword}{struct }DDS\_PIXELFORMAT}
\DoxyCodeLine{00055 \{}
\DoxyCodeLine{00056     uint32\_t    size;}
\DoxyCodeLine{00057     uint32\_t    flags;}
\DoxyCodeLine{00058     uint32\_t    fourCC;}
\DoxyCodeLine{00059     uint32\_t    RGBBitCount;}
\DoxyCodeLine{00060     uint32\_t    RBitMask;}
\DoxyCodeLine{00061     uint32\_t    GBitMask;}
\DoxyCodeLine{00062     uint32\_t    BBitMask;}
\DoxyCodeLine{00063     uint32\_t    ABitMask;}
\DoxyCodeLine{00064 \};}
\DoxyCodeLine{00065 }
\DoxyCodeLine{00066 \textcolor{preprocessor}{\#define DDS\_FOURCC      0x00000004  }\textcolor{comment}{// DDPF\_FOURCC}}
\DoxyCodeLine{00067 \textcolor{preprocessor}{\#define DDS\_RGB         0x00000040  }\textcolor{comment}{// DDPF\_RGB}}
\DoxyCodeLine{00068 \textcolor{preprocessor}{\#define DDS\_LUMINANCE   0x00020000  }\textcolor{comment}{// DDPF\_LUMINANCE}}
\DoxyCodeLine{00069 \textcolor{preprocessor}{\#define DDS\_ALPHA       0x00000002  }\textcolor{comment}{// DDPF\_ALPHA}}
\DoxyCodeLine{00070 }
\DoxyCodeLine{00071 \textcolor{preprocessor}{\#define DDS\_HEADER\_FLAGS\_VOLUME         0x00800000  }\textcolor{comment}{// DDSD\_DEPTH}}
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073 \textcolor{preprocessor}{\#define DDS\_HEIGHT 0x00000002 }\textcolor{comment}{// DDSD\_HEIGHT}}
\DoxyCodeLine{00074 \textcolor{preprocessor}{\#define DDS\_WIDTH  0x00000004 }\textcolor{comment}{// DDSD\_WIDTH}}
\DoxyCodeLine{00075 }
\DoxyCodeLine{00076 \textcolor{preprocessor}{\#define DDS\_CUBEMAP\_POSITIVEX 0x00000600 }\textcolor{comment}{// DDSCAPS2\_CUBEMAP | DDSCAPS2\_CUBEMAP\_POSITIVEX}}
\DoxyCodeLine{00077 \textcolor{preprocessor}{\#define DDS\_CUBEMAP\_NEGATIVEX 0x00000a00 }\textcolor{comment}{// DDSCAPS2\_CUBEMAP | DDSCAPS2\_CUBEMAP\_NEGATIVEX}}
\DoxyCodeLine{00078 \textcolor{preprocessor}{\#define DDS\_CUBEMAP\_POSITIVEY 0x00001200 }\textcolor{comment}{// DDSCAPS2\_CUBEMAP | DDSCAPS2\_CUBEMAP\_POSITIVEY}}
\DoxyCodeLine{00079 \textcolor{preprocessor}{\#define DDS\_CUBEMAP\_NEGATIVEY 0x00002200 }\textcolor{comment}{// DDSCAPS2\_CUBEMAP | DDSCAPS2\_CUBEMAP\_NEGATIVEY}}
\DoxyCodeLine{00080 \textcolor{preprocessor}{\#define DDS\_CUBEMAP\_POSITIVEZ 0x00004200 }\textcolor{comment}{// DDSCAPS2\_CUBEMAP | DDSCAPS2\_CUBEMAP\_POSITIVEZ}}
\DoxyCodeLine{00081 \textcolor{preprocessor}{\#define DDS\_CUBEMAP\_NEGATIVEZ 0x00008200 }\textcolor{comment}{// DDSCAPS2\_CUBEMAP | DDSCAPS2\_CUBEMAP\_NEGATIVEZ}}
\DoxyCodeLine{00082 }
\DoxyCodeLine{00083 \textcolor{preprocessor}{\#define DDS\_CUBEMAP\_ALLFACES ( DDS\_CUBEMAP\_POSITIVEX | DDS\_CUBEMAP\_NEGATIVEX |\(\backslash\)}}
\DoxyCodeLine{00084 \textcolor{preprocessor}{                               DDS\_CUBEMAP\_POSITIVEY | DDS\_CUBEMAP\_NEGATIVEY |\(\backslash\)}}
\DoxyCodeLine{00085 \textcolor{preprocessor}{                               DDS\_CUBEMAP\_POSITIVEZ | DDS\_CUBEMAP\_NEGATIVEZ )}}
\DoxyCodeLine{00086 }
\DoxyCodeLine{00087 \textcolor{preprocessor}{\#define DDS\_CUBEMAP 0x00000200 }\textcolor{comment}{// DDSCAPS2\_CUBEMAP}}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089 \textcolor{keyword}{enum} DDS\_MISC\_FLAGS2}
\DoxyCodeLine{00090 \{}
\DoxyCodeLine{00091     DDS\_MISC\_FLAGS2\_ALPHA\_MODE\_MASK = 0x7L,}
\DoxyCodeLine{00092 \};}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094 \textcolor{keyword}{struct }DDS\_HEADER}
\DoxyCodeLine{00095 \{}
\DoxyCodeLine{00096     uint32\_t        size;}
\DoxyCodeLine{00097     uint32\_t        flags;}
\DoxyCodeLine{00098     uint32\_t        height;}
\DoxyCodeLine{00099     uint32\_t        width;}
\DoxyCodeLine{00100     uint32\_t        pitchOrLinearSize;}
\DoxyCodeLine{00101     uint32\_t        depth; \textcolor{comment}{// only if DDS\_HEADER\_FLAGS\_VOLUME is set in flags}}
\DoxyCodeLine{00102     uint32\_t        mipMapCount;}
\DoxyCodeLine{00103     uint32\_t        reserved1[11];}
\DoxyCodeLine{00104     DDS\_PIXELFORMAT ddspf;}
\DoxyCodeLine{00105     uint32\_t        caps;}
\DoxyCodeLine{00106     uint32\_t        caps2;}
\DoxyCodeLine{00107     uint32\_t        caps3;}
\DoxyCodeLine{00108     uint32\_t        caps4;}
\DoxyCodeLine{00109     uint32\_t        reserved2;}
\DoxyCodeLine{00110 \};}
\DoxyCodeLine{00111 }
\DoxyCodeLine{00112 \textcolor{keyword}{struct }DDS\_HEADER\_DXT10}
\DoxyCodeLine{00113 \{}
\DoxyCodeLine{00114     DXGI\_FORMAT     dxgiFormat;}
\DoxyCodeLine{00115     uint32\_t        resourceDimension;}
\DoxyCodeLine{00116     uint32\_t        miscFlag; \textcolor{comment}{// see D3D11\_RESOURCE\_MISC\_FLAG}}
\DoxyCodeLine{00117     uint32\_t        arraySize;}
\DoxyCodeLine{00118     uint32\_t        miscFlags2;}
\DoxyCodeLine{00119 \};}
\DoxyCodeLine{00120 }
\DoxyCodeLine{00121 \textcolor{preprocessor}{\#pragma pack(pop)}}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00124 \textcolor{keyword}{namespace}}
\DoxyCodeLine{00125 \{}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127 \textcolor{keyword}{struct }handle\_closer \{ \textcolor{keywordtype}{void} operator()(HANDLE h) \{ \textcolor{keywordflow}{if} (h) CloseHandle(h); \} \};}
\DoxyCodeLine{00128 }
\DoxyCodeLine{00129 \textcolor{keyword}{typedef} \textcolor{keyword}{public} std::unique\_ptr<void, handle\_closer> ScopedHandle;}
\DoxyCodeLine{00130 }
\DoxyCodeLine{00131 \textcolor{keyword}{inline} HANDLE safe\_handle( HANDLE h ) \{ \textcolor{keywordflow}{return} (h == INVALID\_HANDLE\_VALUE) ? 0 : h; \}}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133 \textcolor{keyword}{template}<UINT TNameLength>}
\DoxyCodeLine{00134 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} SetDebugObjectName(\_In\_ ID3D11DeviceChild* resource, \_In\_ \textcolor{keyword}{const} \textcolor{keywordtype}{char} (\&name)[TNameLength])}
\DoxyCodeLine{00135 \{}
\DoxyCodeLine{00136 \textcolor{preprocessor}{\#if defined(\_DEBUG) || defined(PROFILE)}}
\DoxyCodeLine{00137     resource-\/>SetPrivateData(WKPDID\_D3DDebugObjectName, TNameLength -\/ 1, name);}
\DoxyCodeLine{00138 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00139     UNREFERENCED\_PARAMETER(resource);}
\DoxyCodeLine{00140     UNREFERENCED\_PARAMETER(name);}
\DoxyCodeLine{00141 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00142 \}}
\DoxyCodeLine{00143 }
\DoxyCodeLine{00144 \};}
\DoxyCodeLine{00145 }
\DoxyCodeLine{00146 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00147 \textcolor{keyword}{static} HRESULT LoadTextureDataFromFile( \_In\_z\_ \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t}* fileName,}
\DoxyCodeLine{00148                                         std::unique\_ptr<uint8\_t[]>\& ddsData,}
\DoxyCodeLine{00149                                         DDS\_HEADER** header,}
\DoxyCodeLine{00150                                         uint8\_t** bitData,}
\DoxyCodeLine{00151                                         \textcolor{keywordtype}{size\_t}* bitSize}
\DoxyCodeLine{00152                                       )}
\DoxyCodeLine{00153 \{}
\DoxyCodeLine{00154     \textcolor{keywordflow}{if} (!header || !bitData || !bitSize)}
\DoxyCodeLine{00155     \{}
\DoxyCodeLine{00156         \textcolor{keywordflow}{return} E\_POINTER;}
\DoxyCodeLine{00157     \}}
\DoxyCodeLine{00158 }
\DoxyCodeLine{00159     \textcolor{comment}{// open the file}}
\DoxyCodeLine{00160 \textcolor{preprocessor}{\#if (\_WIN32\_WINNT >= \_WIN32\_WINNT\_WIN8)}}
\DoxyCodeLine{00161     ScopedHandle hFile( safe\_handle( CreateFile2( fileName,}
\DoxyCodeLine{00162                                                   GENERIC\_READ,}
\DoxyCodeLine{00163                                                   FILE\_SHARE\_READ,}
\DoxyCodeLine{00164                                                   OPEN\_EXISTING,}
\DoxyCodeLine{00165                                                   \textcolor{keyword}{nullptr} ) ) );}
\DoxyCodeLine{00166 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00167     ScopedHandle hFile( safe\_handle( CreateFileW( fileName,}
\DoxyCodeLine{00168                                                   GENERIC\_READ,}
\DoxyCodeLine{00169                                                   FILE\_SHARE\_READ,}
\DoxyCodeLine{00170                                                   \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00171                                                   OPEN\_EXISTING,}
\DoxyCodeLine{00172                                                   FILE\_ATTRIBUTE\_NORMAL,}
\DoxyCodeLine{00173                                                   \textcolor{keyword}{nullptr} ) ) );}
\DoxyCodeLine{00174 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00175 }
\DoxyCodeLine{00176     \textcolor{keywordflow}{if} ( !hFile )}
\DoxyCodeLine{00177     \{}
\DoxyCodeLine{00178         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( GetLastError() );}
\DoxyCodeLine{00179     \}}
\DoxyCodeLine{00180 }
\DoxyCodeLine{00181     \textcolor{comment}{// Get the file size}}
\DoxyCodeLine{00182     LARGE\_INTEGER FileSize = \{ 0 \};}
\DoxyCodeLine{00183 }
\DoxyCodeLine{00184 \textcolor{preprocessor}{\#if (\_WIN32\_WINNT >= \_WIN32\_WINNT\_VISTA)}}
\DoxyCodeLine{00185     FILE\_STANDARD\_INFO fileInfo;}
\DoxyCodeLine{00186     \textcolor{keywordflow}{if} ( !GetFileInformationByHandleEx( hFile.get(), FileStandardInfo, \&fileInfo, \textcolor{keyword}{sizeof}(fileInfo) ) )}
\DoxyCodeLine{00187     \{}
\DoxyCodeLine{00188         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( GetLastError() );}
\DoxyCodeLine{00189     \}}
\DoxyCodeLine{00190     FileSize = fileInfo.EndOfFile;}
\DoxyCodeLine{00191 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00192     GetFileSizeEx( hFile.get(), \&FileSize );}
\DoxyCodeLine{00193 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00194 }
\DoxyCodeLine{00195     \textcolor{comment}{// File is too big for 32-\/bit allocation, so reject read}}
\DoxyCodeLine{00196     \textcolor{keywordflow}{if} (FileSize.HighPart > 0)}
\DoxyCodeLine{00197     \{}
\DoxyCodeLine{00198         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{00199     \}}
\DoxyCodeLine{00200 }
\DoxyCodeLine{00201     \textcolor{comment}{// Need at least enough data to fill the header and magic number to be a valid DDS}}
\DoxyCodeLine{00202     \textcolor{keywordflow}{if} (FileSize.LowPart < ( \textcolor{keyword}{sizeof}(DDS\_HEADER) + \textcolor{keyword}{sizeof}(uint32\_t) ) )}
\DoxyCodeLine{00203     \{}
\DoxyCodeLine{00204         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{00205     \}}
\DoxyCodeLine{00206 }
\DoxyCodeLine{00207     \textcolor{comment}{// create enough space for the file data}}
\DoxyCodeLine{00208     ddsData.reset( \textcolor{keyword}{new} (std::nothrow) uint8\_t[ FileSize.LowPart ] );}
\DoxyCodeLine{00209     \textcolor{keywordflow}{if} (!ddsData)}
\DoxyCodeLine{00210     \{}
\DoxyCodeLine{00211         \textcolor{keywordflow}{return} E\_OUTOFMEMORY;}
\DoxyCodeLine{00212     \}}
\DoxyCodeLine{00213 }
\DoxyCodeLine{00214     \textcolor{comment}{// read the data in}}
\DoxyCodeLine{00215     DWORD BytesRead = 0;}
\DoxyCodeLine{00216     \textcolor{keywordflow}{if} (!ReadFile( hFile.get(),}
\DoxyCodeLine{00217                    ddsData.get(),}
\DoxyCodeLine{00218                    FileSize.LowPart,}
\DoxyCodeLine{00219                    \&BytesRead,}
\DoxyCodeLine{00220                    \textcolor{keyword}{nullptr}}
\DoxyCodeLine{00221                  ))}
\DoxyCodeLine{00222     \{}
\DoxyCodeLine{00223         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( GetLastError() );}
\DoxyCodeLine{00224     \}}
\DoxyCodeLine{00225 }
\DoxyCodeLine{00226     \textcolor{keywordflow}{if} (BytesRead < FileSize.LowPart)}
\DoxyCodeLine{00227     \{}
\DoxyCodeLine{00228         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{00229     \}}
\DoxyCodeLine{00230 }
\DoxyCodeLine{00231     \textcolor{comment}{// DDS files always start with the same magic number ("{}DDS "{})}}
\DoxyCodeLine{00232     uint32\_t dwMagicNumber = *( \textcolor{keyword}{const} uint32\_t* )( ddsData.get() );}
\DoxyCodeLine{00233     \textcolor{keywordflow}{if} (dwMagicNumber != DDS\_MAGIC)}
\DoxyCodeLine{00234     \{}
\DoxyCodeLine{00235         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{00236     \}}
\DoxyCodeLine{00237 }
\DoxyCodeLine{00238     \textcolor{keyword}{auto} hdr = \textcolor{keyword}{reinterpret\_cast<}DDS\_HEADER*\textcolor{keyword}{>}( ddsData.get() + \textcolor{keyword}{sizeof}( uint32\_t ) );}
\DoxyCodeLine{00239 }
\DoxyCodeLine{00240     \textcolor{comment}{// Verify header to validate DDS file}}
\DoxyCodeLine{00241     \textcolor{keywordflow}{if} (hdr-\/>size != \textcolor{keyword}{sizeof}(DDS\_HEADER) ||}
\DoxyCodeLine{00242         hdr-\/>ddspf.size != \textcolor{keyword}{sizeof}(DDS\_PIXELFORMAT))}
\DoxyCodeLine{00243     \{}
\DoxyCodeLine{00244         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{00245     \}}
\DoxyCodeLine{00246 }
\DoxyCodeLine{00247     \textcolor{comment}{// Check for DX10 extension}}
\DoxyCodeLine{00248     \textcolor{keywordtype}{bool} bDXT10Header = \textcolor{keyword}{false};}
\DoxyCodeLine{00249     \textcolor{keywordflow}{if} ((hdr-\/>ddspf.flags \& DDS\_FOURCC) \&\&}
\DoxyCodeLine{00250         (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'1'}, \textcolor{charliteral}{'0'} ) == hdr-\/>ddspf.fourCC))}
\DoxyCodeLine{00251     \{}
\DoxyCodeLine{00252         \textcolor{comment}{// Must be long enough for both headers and magic value}}
\DoxyCodeLine{00253         \textcolor{keywordflow}{if} (FileSize.LowPart < ( \textcolor{keyword}{sizeof}(DDS\_HEADER) + \textcolor{keyword}{sizeof}(uint32\_t) + \textcolor{keyword}{sizeof}(DDS\_HEADER\_DXT10) ) )}
\DoxyCodeLine{00254         \{}
\DoxyCodeLine{00255             \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{00256         \}}
\DoxyCodeLine{00257 }
\DoxyCodeLine{00258         bDXT10Header = \textcolor{keyword}{true};}
\DoxyCodeLine{00259     \}}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261     \textcolor{comment}{// setup the pointers in the process request}}
\DoxyCodeLine{00262     *header = hdr;}
\DoxyCodeLine{00263     ptrdiff\_t offset = \textcolor{keyword}{sizeof}( uint32\_t ) + \textcolor{keyword}{sizeof}( DDS\_HEADER )}
\DoxyCodeLine{00264                        + (bDXT10Header ? \textcolor{keyword}{sizeof}( DDS\_HEADER\_DXT10 ) : 0);}
\DoxyCodeLine{00265     *bitData = ddsData.get() + offset;}
\DoxyCodeLine{00266     *bitSize = FileSize.LowPart -\/ offset;}
\DoxyCodeLine{00267 }
\DoxyCodeLine{00268     \textcolor{keywordflow}{return} S\_OK;}
\DoxyCodeLine{00269 \}}
\DoxyCodeLine{00270 }
\DoxyCodeLine{00271 }
\DoxyCodeLine{00272 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00273 \textcolor{comment}{// Return the BPP for a particular format}}
\DoxyCodeLine{00274 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00275 \textcolor{keyword}{static} \textcolor{keywordtype}{size\_t} BitsPerPixel( \_In\_ DXGI\_FORMAT fmt )}
\DoxyCodeLine{00276 \{}
\DoxyCodeLine{00277     \textcolor{keywordflow}{switch}( fmt )}
\DoxyCodeLine{00278     \{}
\DoxyCodeLine{00279     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32A32\_TYPELESS:}
\DoxyCodeLine{00280     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32A32\_FLOAT:}
\DoxyCodeLine{00281     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32A32\_UINT:}
\DoxyCodeLine{00282     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32A32\_SINT:}
\DoxyCodeLine{00283         \textcolor{keywordflow}{return} 128;}
\DoxyCodeLine{00284 }
\DoxyCodeLine{00285     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32\_TYPELESS:}
\DoxyCodeLine{00286     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32\_FLOAT:}
\DoxyCodeLine{00287     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32\_UINT:}
\DoxyCodeLine{00288     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32B32\_SINT:}
\DoxyCodeLine{00289         \textcolor{keywordflow}{return} 96;}
\DoxyCodeLine{00290 }
\DoxyCodeLine{00291     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16B16A16\_TYPELESS:}
\DoxyCodeLine{00292     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16B16A16\_FLOAT:}
\DoxyCodeLine{00293     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16B16A16\_UNORM:}
\DoxyCodeLine{00294     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16B16A16\_UINT:}
\DoxyCodeLine{00295     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16B16A16\_SNORM:}
\DoxyCodeLine{00296     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16B16A16\_SINT:}
\DoxyCodeLine{00297     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32\_TYPELESS:}
\DoxyCodeLine{00298     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32\_FLOAT:}
\DoxyCodeLine{00299     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32\_UINT:}
\DoxyCodeLine{00300     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G32\_SINT:}
\DoxyCodeLine{00301     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32G8X24\_TYPELESS:}
\DoxyCodeLine{00302     \textcolor{keywordflow}{case} DXGI\_FORMAT\_D32\_FLOAT\_S8X24\_UINT:}
\DoxyCodeLine{00303     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32\_FLOAT\_X8X24\_TYPELESS:}
\DoxyCodeLine{00304     \textcolor{keywordflow}{case} DXGI\_FORMAT\_X32\_TYPELESS\_G8X24\_UINT:}
\DoxyCodeLine{00305     \textcolor{keywordflow}{case} DXGI\_FORMAT\_Y416:}
\DoxyCodeLine{00306     \textcolor{keywordflow}{case} DXGI\_FORMAT\_Y210:}
\DoxyCodeLine{00307     \textcolor{keywordflow}{case} DXGI\_FORMAT\_Y216:}
\DoxyCodeLine{00308         \textcolor{keywordflow}{return} 64;}
\DoxyCodeLine{00309 }
\DoxyCodeLine{00310     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R10G10B10A2\_TYPELESS:}
\DoxyCodeLine{00311     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R10G10B10A2\_UNORM:}
\DoxyCodeLine{00312     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R10G10B10A2\_UINT:}
\DoxyCodeLine{00313     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R11G11B10\_FLOAT:}
\DoxyCodeLine{00314     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8B8A8\_TYPELESS:}
\DoxyCodeLine{00315     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8B8A8\_UNORM:}
\DoxyCodeLine{00316     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8B8A8\_UNORM\_SRGB:}
\DoxyCodeLine{00317     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8B8A8\_UINT:}
\DoxyCodeLine{00318     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8B8A8\_SNORM:}
\DoxyCodeLine{00319     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8B8A8\_SINT:}
\DoxyCodeLine{00320     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16\_TYPELESS:}
\DoxyCodeLine{00321     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16\_FLOAT:}
\DoxyCodeLine{00322     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16\_UNORM:}
\DoxyCodeLine{00323     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16\_UINT:}
\DoxyCodeLine{00324     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16\_SNORM:}
\DoxyCodeLine{00325     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16G16\_SINT:}
\DoxyCodeLine{00326     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32\_TYPELESS:}
\DoxyCodeLine{00327     \textcolor{keywordflow}{case} DXGI\_FORMAT\_D32\_FLOAT:}
\DoxyCodeLine{00328     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32\_FLOAT:}
\DoxyCodeLine{00329     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32\_UINT:}
\DoxyCodeLine{00330     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R32\_SINT:}
\DoxyCodeLine{00331     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R24G8\_TYPELESS:}
\DoxyCodeLine{00332     \textcolor{keywordflow}{case} DXGI\_FORMAT\_D24\_UNORM\_S8\_UINT:}
\DoxyCodeLine{00333     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R24\_UNORM\_X8\_TYPELESS:}
\DoxyCodeLine{00334     \textcolor{keywordflow}{case} DXGI\_FORMAT\_X24\_TYPELESS\_G8\_UINT:}
\DoxyCodeLine{00335     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R9G9B9E5\_SHAREDEXP:}
\DoxyCodeLine{00336     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8\_B8G8\_UNORM:}
\DoxyCodeLine{00337     \textcolor{keywordflow}{case} DXGI\_FORMAT\_G8R8\_G8B8\_UNORM:}
\DoxyCodeLine{00338     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8A8\_UNORM:}
\DoxyCodeLine{00339     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8X8\_UNORM:}
\DoxyCodeLine{00340     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R10G10B10\_XR\_BIAS\_A2\_UNORM:}
\DoxyCodeLine{00341     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8A8\_TYPELESS:}
\DoxyCodeLine{00342     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8A8\_UNORM\_SRGB:}
\DoxyCodeLine{00343     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8X8\_TYPELESS:}
\DoxyCodeLine{00344     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8X8\_UNORM\_SRGB:}
\DoxyCodeLine{00345     \textcolor{keywordflow}{case} DXGI\_FORMAT\_AYUV:}
\DoxyCodeLine{00346     \textcolor{keywordflow}{case} DXGI\_FORMAT\_Y410:}
\DoxyCodeLine{00347     \textcolor{keywordflow}{case} DXGI\_FORMAT\_YUY2:}
\DoxyCodeLine{00348         \textcolor{keywordflow}{return} 32;}
\DoxyCodeLine{00349 }
\DoxyCodeLine{00350     \textcolor{keywordflow}{case} DXGI\_FORMAT\_P010:}
\DoxyCodeLine{00351     \textcolor{keywordflow}{case} DXGI\_FORMAT\_P016:}
\DoxyCodeLine{00352         \textcolor{keywordflow}{return} 24;}
\DoxyCodeLine{00353 }
\DoxyCodeLine{00354     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8\_TYPELESS:}
\DoxyCodeLine{00355     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8\_UNORM:}
\DoxyCodeLine{00356     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8\_UINT:}
\DoxyCodeLine{00357     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8\_SNORM:}
\DoxyCodeLine{00358     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8\_SINT:}
\DoxyCodeLine{00359     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16\_TYPELESS:}
\DoxyCodeLine{00360     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16\_FLOAT:}
\DoxyCodeLine{00361     \textcolor{keywordflow}{case} DXGI\_FORMAT\_D16\_UNORM:}
\DoxyCodeLine{00362     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16\_UNORM:}
\DoxyCodeLine{00363     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16\_UINT:}
\DoxyCodeLine{00364     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16\_SNORM:}
\DoxyCodeLine{00365     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R16\_SINT:}
\DoxyCodeLine{00366     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B5G6R5\_UNORM:}
\DoxyCodeLine{00367     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B5G5R5A1\_UNORM:}
\DoxyCodeLine{00368     \textcolor{keywordflow}{case} DXGI\_FORMAT\_A8P8:}
\DoxyCodeLine{00369     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B4G4R4A4\_UNORM:}
\DoxyCodeLine{00370         \textcolor{keywordflow}{return} 16;}
\DoxyCodeLine{00371 }
\DoxyCodeLine{00372     \textcolor{keywordflow}{case} DXGI\_FORMAT\_NV12:}
\DoxyCodeLine{00373     \textcolor{keywordflow}{case} DXGI\_FORMAT\_420\_OPAQUE:}
\DoxyCodeLine{00374     \textcolor{keywordflow}{case} DXGI\_FORMAT\_NV11:}
\DoxyCodeLine{00375         \textcolor{keywordflow}{return} 12;}
\DoxyCodeLine{00376 }
\DoxyCodeLine{00377     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8\_TYPELESS:}
\DoxyCodeLine{00378     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8\_UNORM:}
\DoxyCodeLine{00379     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8\_UINT:}
\DoxyCodeLine{00380     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8\_SNORM:}
\DoxyCodeLine{00381     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8\_SINT:}
\DoxyCodeLine{00382     \textcolor{keywordflow}{case} DXGI\_FORMAT\_A8\_UNORM:}
\DoxyCodeLine{00383     \textcolor{keywordflow}{case} DXGI\_FORMAT\_AI44:}
\DoxyCodeLine{00384     \textcolor{keywordflow}{case} DXGI\_FORMAT\_IA44:}
\DoxyCodeLine{00385     \textcolor{keywordflow}{case} DXGI\_FORMAT\_P8:}
\DoxyCodeLine{00386         \textcolor{keywordflow}{return} 8;}
\DoxyCodeLine{00387 }
\DoxyCodeLine{00388     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R1\_UNORM:}
\DoxyCodeLine{00389         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{00390 }
\DoxyCodeLine{00391     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC1\_TYPELESS:}
\DoxyCodeLine{00392     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC1\_UNORM:}
\DoxyCodeLine{00393     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC1\_UNORM\_SRGB:}
\DoxyCodeLine{00394     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC4\_TYPELESS:}
\DoxyCodeLine{00395     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC4\_UNORM:}
\DoxyCodeLine{00396     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC4\_SNORM:}
\DoxyCodeLine{00397         \textcolor{keywordflow}{return} 4;}
\DoxyCodeLine{00398 }
\DoxyCodeLine{00399     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC2\_TYPELESS:}
\DoxyCodeLine{00400     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC2\_UNORM:}
\DoxyCodeLine{00401     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC2\_UNORM\_SRGB:}
\DoxyCodeLine{00402     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC3\_TYPELESS:}
\DoxyCodeLine{00403     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC3\_UNORM:}
\DoxyCodeLine{00404     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC3\_UNORM\_SRGB:}
\DoxyCodeLine{00405     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC5\_TYPELESS:}
\DoxyCodeLine{00406     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC5\_UNORM:}
\DoxyCodeLine{00407     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC5\_SNORM:}
\DoxyCodeLine{00408     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC6H\_TYPELESS:}
\DoxyCodeLine{00409     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC6H\_UF16:}
\DoxyCodeLine{00410     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC6H\_SF16:}
\DoxyCodeLine{00411     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC7\_TYPELESS:}
\DoxyCodeLine{00412     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC7\_UNORM:}
\DoxyCodeLine{00413     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC7\_UNORM\_SRGB:}
\DoxyCodeLine{00414         \textcolor{keywordflow}{return} 8;}
\DoxyCodeLine{00415 }
\DoxyCodeLine{00416     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00417         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00418     \}}
\DoxyCodeLine{00419 \}}
\DoxyCodeLine{00420 }
\DoxyCodeLine{00421 }
\DoxyCodeLine{00422 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00423 \textcolor{comment}{// Get surface information for a particular format}}
\DoxyCodeLine{00424 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00425 \textcolor{keyword}{static} \textcolor{keywordtype}{void} GetSurfaceInfo( \_In\_ \textcolor{keywordtype}{size\_t} width,}
\DoxyCodeLine{00426                             \_In\_ \textcolor{keywordtype}{size\_t} height,}
\DoxyCodeLine{00427                             \_In\_ DXGI\_FORMAT fmt,}
\DoxyCodeLine{00428                             \_Out\_opt\_ \textcolor{keywordtype}{size\_t}* outNumBytes,}
\DoxyCodeLine{00429                             \_Out\_opt\_ \textcolor{keywordtype}{size\_t}* outRowBytes,}
\DoxyCodeLine{00430                             \_Out\_opt\_ \textcolor{keywordtype}{size\_t}* outNumRows )}
\DoxyCodeLine{00431 \{}
\DoxyCodeLine{00432     \textcolor{keywordtype}{size\_t} numBytes = 0;}
\DoxyCodeLine{00433     \textcolor{keywordtype}{size\_t} rowBytes = 0;}
\DoxyCodeLine{00434     \textcolor{keywordtype}{size\_t} numRows = 0;}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00436     \textcolor{keywordtype}{bool} bc = \textcolor{keyword}{false};}
\DoxyCodeLine{00437     \textcolor{keywordtype}{bool} packed = \textcolor{keyword}{false};}
\DoxyCodeLine{00438     \textcolor{keywordtype}{bool} planar = \textcolor{keyword}{false};}
\DoxyCodeLine{00439     \textcolor{keywordtype}{size\_t} bpe = 0;}
\DoxyCodeLine{00440     \textcolor{keywordflow}{switch} (fmt)}
\DoxyCodeLine{00441     \{}
\DoxyCodeLine{00442     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC1\_TYPELESS:}
\DoxyCodeLine{00443     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC1\_UNORM:}
\DoxyCodeLine{00444     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC1\_UNORM\_SRGB:}
\DoxyCodeLine{00445     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC4\_TYPELESS:}
\DoxyCodeLine{00446     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC4\_UNORM:}
\DoxyCodeLine{00447     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC4\_SNORM:}
\DoxyCodeLine{00448         bc=\textcolor{keyword}{true};}
\DoxyCodeLine{00449         bpe = 8;}
\DoxyCodeLine{00450         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00451 }
\DoxyCodeLine{00452     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC2\_TYPELESS:}
\DoxyCodeLine{00453     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC2\_UNORM:}
\DoxyCodeLine{00454     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC2\_UNORM\_SRGB:}
\DoxyCodeLine{00455     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC3\_TYPELESS:}
\DoxyCodeLine{00456     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC3\_UNORM:}
\DoxyCodeLine{00457     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC3\_UNORM\_SRGB:}
\DoxyCodeLine{00458     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC5\_TYPELESS:}
\DoxyCodeLine{00459     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC5\_UNORM:}
\DoxyCodeLine{00460     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC5\_SNORM:}
\DoxyCodeLine{00461     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC6H\_TYPELESS:}
\DoxyCodeLine{00462     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC6H\_UF16:}
\DoxyCodeLine{00463     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC6H\_SF16:}
\DoxyCodeLine{00464     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC7\_TYPELESS:}
\DoxyCodeLine{00465     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC7\_UNORM:}
\DoxyCodeLine{00466     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC7\_UNORM\_SRGB:}
\DoxyCodeLine{00467         bc = \textcolor{keyword}{true};}
\DoxyCodeLine{00468         bpe = 16;}
\DoxyCodeLine{00469         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00470 }
\DoxyCodeLine{00471     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8\_B8G8\_UNORM:}
\DoxyCodeLine{00472     \textcolor{keywordflow}{case} DXGI\_FORMAT\_G8R8\_G8B8\_UNORM:}
\DoxyCodeLine{00473     \textcolor{keywordflow}{case} DXGI\_FORMAT\_YUY2:}
\DoxyCodeLine{00474         packed = \textcolor{keyword}{true};}
\DoxyCodeLine{00475         bpe = 4;}
\DoxyCodeLine{00476         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00477 }
\DoxyCodeLine{00478     \textcolor{keywordflow}{case} DXGI\_FORMAT\_Y210:}
\DoxyCodeLine{00479     \textcolor{keywordflow}{case} DXGI\_FORMAT\_Y216:}
\DoxyCodeLine{00480         packed = \textcolor{keyword}{true};}
\DoxyCodeLine{00481         bpe = 8;}
\DoxyCodeLine{00482         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00483 }
\DoxyCodeLine{00484     \textcolor{keywordflow}{case} DXGI\_FORMAT\_NV12:}
\DoxyCodeLine{00485     \textcolor{keywordflow}{case} DXGI\_FORMAT\_420\_OPAQUE:}
\DoxyCodeLine{00486         planar = \textcolor{keyword}{true};}
\DoxyCodeLine{00487         bpe = 2;}
\DoxyCodeLine{00488         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00489 }
\DoxyCodeLine{00490     \textcolor{keywordflow}{case} DXGI\_FORMAT\_P010:}
\DoxyCodeLine{00491     \textcolor{keywordflow}{case} DXGI\_FORMAT\_P016:}
\DoxyCodeLine{00492         planar = \textcolor{keyword}{true};}
\DoxyCodeLine{00493         bpe = 4;}
\DoxyCodeLine{00494         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00495     \}}
\DoxyCodeLine{00496 }
\DoxyCodeLine{00497     \textcolor{keywordflow}{if} (bc)}
\DoxyCodeLine{00498     \{}
\DoxyCodeLine{00499         \textcolor{keywordtype}{size\_t} numBlocksWide = 0;}
\DoxyCodeLine{00500         \textcolor{keywordflow}{if} (width > 0)}
\DoxyCodeLine{00501         \{}
\DoxyCodeLine{00502             numBlocksWide = std::max<size\_t>( 1, (width + 3) / 4 );}
\DoxyCodeLine{00503         \}}
\DoxyCodeLine{00504         \textcolor{keywordtype}{size\_t} numBlocksHigh = 0;}
\DoxyCodeLine{00505         \textcolor{keywordflow}{if} (height > 0)}
\DoxyCodeLine{00506         \{}
\DoxyCodeLine{00507             numBlocksHigh = std::max<size\_t>( 1, (height + 3) / 4 );}
\DoxyCodeLine{00508         \}}
\DoxyCodeLine{00509         rowBytes = numBlocksWide * bpe;}
\DoxyCodeLine{00510         numRows = numBlocksHigh;}
\DoxyCodeLine{00511         numBytes = rowBytes * numBlocksHigh;}
\DoxyCodeLine{00512     \}}
\DoxyCodeLine{00513     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (packed)}
\DoxyCodeLine{00514     \{}
\DoxyCodeLine{00515         rowBytes = ( ( width + 1 ) >> 1 ) * bpe;}
\DoxyCodeLine{00516         numRows = height;}
\DoxyCodeLine{00517         numBytes = rowBytes * height;}
\DoxyCodeLine{00518     \}}
\DoxyCodeLine{00519     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( fmt == DXGI\_FORMAT\_NV11 )}
\DoxyCodeLine{00520     \{}
\DoxyCodeLine{00521         rowBytes = ( ( width + 3 ) >> 2 ) * 4;}
\DoxyCodeLine{00522         numRows = height * 2; \textcolor{comment}{// Direct3D makes this simplifying assumption, although it is larger than the 4:1:1 data}}
\DoxyCodeLine{00523         numBytes = rowBytes * numRows;}
\DoxyCodeLine{00524     \}}
\DoxyCodeLine{00525     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (planar)}
\DoxyCodeLine{00526     \{}
\DoxyCodeLine{00527         rowBytes = ( ( width + 1 ) >> 1 ) * bpe;}
\DoxyCodeLine{00528         numBytes = ( rowBytes * height ) + ( ( rowBytes * height + 1 ) >> 1 );}
\DoxyCodeLine{00529         numRows = height + ( ( height + 1 ) >> 1 );}
\DoxyCodeLine{00530     \}}
\DoxyCodeLine{00531     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00532     \{}
\DoxyCodeLine{00533         \textcolor{keywordtype}{size\_t} bpp = BitsPerPixel( fmt );}
\DoxyCodeLine{00534         rowBytes = ( width * bpp + 7 ) / 8; \textcolor{comment}{// round up to nearest byte}}
\DoxyCodeLine{00535         numRows = height;}
\DoxyCodeLine{00536         numBytes = rowBytes * height;}
\DoxyCodeLine{00537     \}}
\DoxyCodeLine{00538 }
\DoxyCodeLine{00539     \textcolor{keywordflow}{if} (outNumBytes)}
\DoxyCodeLine{00540     \{}
\DoxyCodeLine{00541         *outNumBytes = numBytes;}
\DoxyCodeLine{00542     \}}
\DoxyCodeLine{00543     \textcolor{keywordflow}{if} (outRowBytes)}
\DoxyCodeLine{00544     \{}
\DoxyCodeLine{00545         *outRowBytes = rowBytes;}
\DoxyCodeLine{00546     \}}
\DoxyCodeLine{00547     \textcolor{keywordflow}{if} (outNumRows)}
\DoxyCodeLine{00548     \{}
\DoxyCodeLine{00549         *outNumRows = numRows;}
\DoxyCodeLine{00550     \}}
\DoxyCodeLine{00551 \}}
\DoxyCodeLine{00552 }
\DoxyCodeLine{00553 }
\DoxyCodeLine{00554 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00555 \textcolor{preprocessor}{\#define ISBITMASK( r,g,b,a ) ( ddpf.RBitMask == r \&\& ddpf.GBitMask == g \&\& ddpf.BBitMask == b \&\& ddpf.ABitMask == a )}}
\DoxyCodeLine{00556 }
\DoxyCodeLine{00557 \textcolor{keyword}{static} DXGI\_FORMAT GetDXGIFormat( \textcolor{keyword}{const} DDS\_PIXELFORMAT\& ddpf )}
\DoxyCodeLine{00558 \{}
\DoxyCodeLine{00559     \textcolor{keywordflow}{if} (ddpf.flags \& DDS\_RGB)}
\DoxyCodeLine{00560     \{}
\DoxyCodeLine{00561         \textcolor{comment}{// Note that sRGB formats are written using the "{}DX10"{} extended header}}
\DoxyCodeLine{00562 }
\DoxyCodeLine{00563         \textcolor{keywordflow}{switch} (ddpf.RGBBitCount)}
\DoxyCodeLine{00564         \{}
\DoxyCodeLine{00565         \textcolor{keywordflow}{case} 32:}
\DoxyCodeLine{00566             \textcolor{keywordflow}{if} (ISBITMASK(0x000000ff,0x0000ff00,0x00ff0000,0xff000000))}
\DoxyCodeLine{00567             \{}
\DoxyCodeLine{00568                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_R8G8B8A8\_UNORM;}
\DoxyCodeLine{00569             \}}
\DoxyCodeLine{00570 }
\DoxyCodeLine{00571             \textcolor{keywordflow}{if} (ISBITMASK(0x00ff0000,0x0000ff00,0x000000ff,0xff000000))}
\DoxyCodeLine{00572             \{}
\DoxyCodeLine{00573                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_B8G8R8A8\_UNORM;}
\DoxyCodeLine{00574             \}}
\DoxyCodeLine{00575 }
\DoxyCodeLine{00576             \textcolor{keywordflow}{if} (ISBITMASK(0x00ff0000,0x0000ff00,0x000000ff,0x00000000))}
\DoxyCodeLine{00577             \{}
\DoxyCodeLine{00578                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_B8G8R8X8\_UNORM;}
\DoxyCodeLine{00579             \}}
\DoxyCodeLine{00580 }
\DoxyCodeLine{00581             \textcolor{comment}{// No DXGI format maps to ISBITMASK(0x000000ff,0x0000ff00,0x00ff0000,0x00000000) aka D3DFMT\_X8B8G8R8}}
\DoxyCodeLine{00582 }
\DoxyCodeLine{00583             \textcolor{comment}{// Note that many common DDS reader/writers (including D3DX) swap the}}
\DoxyCodeLine{00584             \textcolor{comment}{// the RED/BLUE masks for 10:10:10:2 formats. We assume}}
\DoxyCodeLine{00585             \textcolor{comment}{// below that the 'backwards' header mask is being used since it is most}}
\DoxyCodeLine{00586             \textcolor{comment}{// likely written by D3DX. The more robust solution is to use the 'DX10'}}
\DoxyCodeLine{00587             \textcolor{comment}{// header extension and specify the DXGI\_FORMAT\_R10G10B10A2\_UNORM format directly}}
\DoxyCodeLine{00588 }
\DoxyCodeLine{00589             \textcolor{comment}{// For 'correct' writers, this should be 0x000003ff,0x000ffc00,0x3ff00000 for RGB data}}
\DoxyCodeLine{00590             \textcolor{keywordflow}{if} (ISBITMASK(0x3ff00000,0x000ffc00,0x000003ff,0xc0000000))}
\DoxyCodeLine{00591             \{}
\DoxyCodeLine{00592                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_R10G10B10A2\_UNORM;}
\DoxyCodeLine{00593             \}}
\DoxyCodeLine{00594 }
\DoxyCodeLine{00595             \textcolor{comment}{// No DXGI format maps to ISBITMASK(0x000003ff,0x000ffc00,0x3ff00000,0xc0000000) aka D3DFMT\_A2R10G10B10}}
\DoxyCodeLine{00596 }
\DoxyCodeLine{00597             \textcolor{keywordflow}{if} (ISBITMASK(0x0000ffff,0xffff0000,0x00000000,0x00000000))}
\DoxyCodeLine{00598             \{}
\DoxyCodeLine{00599                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_R16G16\_UNORM;}
\DoxyCodeLine{00600             \}}
\DoxyCodeLine{00601 }
\DoxyCodeLine{00602             \textcolor{keywordflow}{if} (ISBITMASK(0xffffffff,0x00000000,0x00000000,0x00000000))}
\DoxyCodeLine{00603             \{}
\DoxyCodeLine{00604                 \textcolor{comment}{// Only 32-\/bit color channel format in D3D9 was R32F}}
\DoxyCodeLine{00605                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_R32\_FLOAT; \textcolor{comment}{// D3DX writes this out as a FourCC of 114}}
\DoxyCodeLine{00606             \}}
\DoxyCodeLine{00607             \textcolor{keywordflow}{break};}
\DoxyCodeLine{00608 }
\DoxyCodeLine{00609         \textcolor{keywordflow}{case} 24:}
\DoxyCodeLine{00610             \textcolor{comment}{// No 24bpp DXGI formats aka D3DFMT\_R8G8B8}}
\DoxyCodeLine{00611             \textcolor{keywordflow}{break};}
\DoxyCodeLine{00612 }
\DoxyCodeLine{00613         \textcolor{keywordflow}{case} 16:}
\DoxyCodeLine{00614             \textcolor{keywordflow}{if} (ISBITMASK(0x7c00,0x03e0,0x001f,0x8000))}
\DoxyCodeLine{00615             \{}
\DoxyCodeLine{00616                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_B5G5R5A1\_UNORM;}
\DoxyCodeLine{00617             \}}
\DoxyCodeLine{00618             \textcolor{keywordflow}{if} (ISBITMASK(0xf800,0x07e0,0x001f,0x0000))}
\DoxyCodeLine{00619             \{}
\DoxyCodeLine{00620                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_B5G6R5\_UNORM;}
\DoxyCodeLine{00621             \}}
\DoxyCodeLine{00622 }
\DoxyCodeLine{00623             \textcolor{comment}{// No DXGI format maps to ISBITMASK(0x7c00,0x03e0,0x001f,0x0000) aka D3DFMT\_X1R5G5B5}}
\DoxyCodeLine{00624 }
\DoxyCodeLine{00625             \textcolor{keywordflow}{if} (ISBITMASK(0x0f00,0x00f0,0x000f,0xf000))}
\DoxyCodeLine{00626             \{}
\DoxyCodeLine{00627                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_B4G4R4A4\_UNORM;}
\DoxyCodeLine{00628             \}}
\DoxyCodeLine{00629 }
\DoxyCodeLine{00630             \textcolor{comment}{// No DXGI format maps to ISBITMASK(0x0f00,0x00f0,0x000f,0x0000) aka D3DFMT\_X4R4G4B4}}
\DoxyCodeLine{00631 }
\DoxyCodeLine{00632             \textcolor{comment}{// No 3:3:2, 3:3:2:8, or paletted DXGI formats aka D3DFMT\_A8R3G3B2, D3DFMT\_R3G3B2, D3DFMT\_P8, D3DFMT\_A8P8, etc.}}
\DoxyCodeLine{00633             \textcolor{keywordflow}{break};}
\DoxyCodeLine{00634         \}}
\DoxyCodeLine{00635     \}}
\DoxyCodeLine{00636     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ddpf.flags \& DDS\_LUMINANCE)}
\DoxyCodeLine{00637     \{}
\DoxyCodeLine{00638         \textcolor{keywordflow}{if} (8 == ddpf.RGBBitCount)}
\DoxyCodeLine{00639         \{}
\DoxyCodeLine{00640             \textcolor{keywordflow}{if} (ISBITMASK(0x000000ff,0x00000000,0x00000000,0x00000000))}
\DoxyCodeLine{00641             \{}
\DoxyCodeLine{00642                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_R8\_UNORM; \textcolor{comment}{// D3DX10/11 writes this out as DX10 extension}}
\DoxyCodeLine{00643             \}}
\DoxyCodeLine{00644 }
\DoxyCodeLine{00645             \textcolor{comment}{// No DXGI format maps to ISBITMASK(0x0f,0x00,0x00,0xf0) aka D3DFMT\_A4L4}}
\DoxyCodeLine{00646         \}}
\DoxyCodeLine{00647 }
\DoxyCodeLine{00648         \textcolor{keywordflow}{if} (16 == ddpf.RGBBitCount)}
\DoxyCodeLine{00649         \{}
\DoxyCodeLine{00650             \textcolor{keywordflow}{if} (ISBITMASK(0x0000ffff,0x00000000,0x00000000,0x00000000))}
\DoxyCodeLine{00651             \{}
\DoxyCodeLine{00652                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_R16\_UNORM; \textcolor{comment}{// D3DX10/11 writes this out as DX10 extension}}
\DoxyCodeLine{00653             \}}
\DoxyCodeLine{00654             \textcolor{keywordflow}{if} (ISBITMASK(0x000000ff,0x00000000,0x00000000,0x0000ff00))}
\DoxyCodeLine{00655             \{}
\DoxyCodeLine{00656                 \textcolor{keywordflow}{return} DXGI\_FORMAT\_R8G8\_UNORM; \textcolor{comment}{// D3DX10/11 writes this out as DX10 extension}}
\DoxyCodeLine{00657             \}}
\DoxyCodeLine{00658         \}}
\DoxyCodeLine{00659     \}}
\DoxyCodeLine{00660     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ddpf.flags \& DDS\_ALPHA)}
\DoxyCodeLine{00661     \{}
\DoxyCodeLine{00662         \textcolor{keywordflow}{if} (8 == ddpf.RGBBitCount)}
\DoxyCodeLine{00663         \{}
\DoxyCodeLine{00664             \textcolor{keywordflow}{return} DXGI\_FORMAT\_A8\_UNORM;}
\DoxyCodeLine{00665         \}}
\DoxyCodeLine{00666     \}}
\DoxyCodeLine{00667     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ddpf.flags \& DDS\_FOURCC)}
\DoxyCodeLine{00668     \{}
\DoxyCodeLine{00669         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'1'} ) == ddpf.fourCC)}
\DoxyCodeLine{00670         \{}
\DoxyCodeLine{00671             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC1\_UNORM;}
\DoxyCodeLine{00672         \}}
\DoxyCodeLine{00673         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'3'} ) == ddpf.fourCC)}
\DoxyCodeLine{00674         \{}
\DoxyCodeLine{00675             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC2\_UNORM;}
\DoxyCodeLine{00676         \}}
\DoxyCodeLine{00677         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'5'} ) == ddpf.fourCC)}
\DoxyCodeLine{00678         \{}
\DoxyCodeLine{00679             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC3\_UNORM;}
\DoxyCodeLine{00680         \}}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682         \textcolor{comment}{// While pre-\/multiplied alpha isn't directly supported by the DXGI formats,}}
\DoxyCodeLine{00683         \textcolor{comment}{// they are basically the same as these BC formats so they can be mapped}}
\DoxyCodeLine{00684         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'2'} ) == ddpf.fourCC)}
\DoxyCodeLine{00685         \{}
\DoxyCodeLine{00686             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC2\_UNORM;}
\DoxyCodeLine{00687         \}}
\DoxyCodeLine{00688         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'4'} ) == ddpf.fourCC)}
\DoxyCodeLine{00689         \{}
\DoxyCodeLine{00690             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC3\_UNORM;}
\DoxyCodeLine{00691         \}}
\DoxyCodeLine{00692 }
\DoxyCodeLine{00693         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'A'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'I'}, \textcolor{charliteral}{'1'} ) == ddpf.fourCC)}
\DoxyCodeLine{00694         \{}
\DoxyCodeLine{00695             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC4\_UNORM;}
\DoxyCodeLine{00696         \}}
\DoxyCodeLine{00697         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'B'}, \textcolor{charliteral}{'C'}, \textcolor{charliteral}{'4'}, \textcolor{charliteral}{'U'} ) == ddpf.fourCC)}
\DoxyCodeLine{00698         \{}
\DoxyCodeLine{00699             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC4\_UNORM;}
\DoxyCodeLine{00700         \}}
\DoxyCodeLine{00701         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'B'}, \textcolor{charliteral}{'C'}, \textcolor{charliteral}{'4'}, \textcolor{charliteral}{'S'} ) == ddpf.fourCC)}
\DoxyCodeLine{00702         \{}
\DoxyCodeLine{00703             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC4\_SNORM;}
\DoxyCodeLine{00704         \}}
\DoxyCodeLine{00705 }
\DoxyCodeLine{00706         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'A'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'I'}, \textcolor{charliteral}{'2'} ) == ddpf.fourCC)}
\DoxyCodeLine{00707         \{}
\DoxyCodeLine{00708             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC5\_UNORM;}
\DoxyCodeLine{00709         \}}
\DoxyCodeLine{00710         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'B'}, \textcolor{charliteral}{'C'}, \textcolor{charliteral}{'5'}, \textcolor{charliteral}{'U'} ) == ddpf.fourCC)}
\DoxyCodeLine{00711         \{}
\DoxyCodeLine{00712             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC5\_UNORM;}
\DoxyCodeLine{00713         \}}
\DoxyCodeLine{00714         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'B'}, \textcolor{charliteral}{'C'}, \textcolor{charliteral}{'5'}, \textcolor{charliteral}{'S'} ) == ddpf.fourCC)}
\DoxyCodeLine{00715         \{}
\DoxyCodeLine{00716             \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC5\_SNORM;}
\DoxyCodeLine{00717         \}}
\DoxyCodeLine{00718 }
\DoxyCodeLine{00719         \textcolor{comment}{// BC6H and BC7 are written using the "{}DX10"{} extended header}}
\DoxyCodeLine{00720 }
\DoxyCodeLine{00721         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'R'}, \textcolor{charliteral}{'G'}, \textcolor{charliteral}{'B'}, \textcolor{charliteral}{'G'} ) == ddpf.fourCC)}
\DoxyCodeLine{00722         \{}
\DoxyCodeLine{00723             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R8G8\_B8G8\_UNORM;}
\DoxyCodeLine{00724         \}}
\DoxyCodeLine{00725         \textcolor{keywordflow}{if} (MAKEFOURCC( \textcolor{charliteral}{'G'}, \textcolor{charliteral}{'R'}, \textcolor{charliteral}{'G'}, \textcolor{charliteral}{'B'} ) == ddpf.fourCC)}
\DoxyCodeLine{00726         \{}
\DoxyCodeLine{00727             \textcolor{keywordflow}{return} DXGI\_FORMAT\_G8R8\_G8B8\_UNORM;}
\DoxyCodeLine{00728         \}}
\DoxyCodeLine{00729 }
\DoxyCodeLine{00730         \textcolor{keywordflow}{if} (MAKEFOURCC(\textcolor{charliteral}{'Y'},\textcolor{charliteral}{'U'},\textcolor{charliteral}{'Y'},\textcolor{charliteral}{'2'}) == ddpf.fourCC)}
\DoxyCodeLine{00731         \{}
\DoxyCodeLine{00732             \textcolor{keywordflow}{return} DXGI\_FORMAT\_YUY2;}
\DoxyCodeLine{00733         \}}
\DoxyCodeLine{00734 }
\DoxyCodeLine{00735         \textcolor{comment}{// Check for D3DFORMAT enums being set here}}
\DoxyCodeLine{00736         \textcolor{keywordflow}{switch}( ddpf.fourCC )}
\DoxyCodeLine{00737         \{}
\DoxyCodeLine{00738         \textcolor{keywordflow}{case} 36: \textcolor{comment}{// D3DFMT\_A16B16G16R16}}
\DoxyCodeLine{00739             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R16G16B16A16\_UNORM;}
\DoxyCodeLine{00740 }
\DoxyCodeLine{00741         \textcolor{keywordflow}{case} 110: \textcolor{comment}{// D3DFMT\_Q16W16V16U16}}
\DoxyCodeLine{00742             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R16G16B16A16\_SNORM;}
\DoxyCodeLine{00743 }
\DoxyCodeLine{00744         \textcolor{keywordflow}{case} 111: \textcolor{comment}{// D3DFMT\_R16F}}
\DoxyCodeLine{00745             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R16\_FLOAT;}
\DoxyCodeLine{00746 }
\DoxyCodeLine{00747         \textcolor{keywordflow}{case} 112: \textcolor{comment}{// D3DFMT\_G16R16F}}
\DoxyCodeLine{00748             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R16G16\_FLOAT;}
\DoxyCodeLine{00749 }
\DoxyCodeLine{00750         \textcolor{keywordflow}{case} 113: \textcolor{comment}{// D3DFMT\_A16B16G16R16F}}
\DoxyCodeLine{00751             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R16G16B16A16\_FLOAT;}
\DoxyCodeLine{00752 }
\DoxyCodeLine{00753         \textcolor{keywordflow}{case} 114: \textcolor{comment}{// D3DFMT\_R32F}}
\DoxyCodeLine{00754             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R32\_FLOAT;}
\DoxyCodeLine{00755 }
\DoxyCodeLine{00756         \textcolor{keywordflow}{case} 115: \textcolor{comment}{// D3DFMT\_G32R32F}}
\DoxyCodeLine{00757             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R32G32\_FLOAT;}
\DoxyCodeLine{00758 }
\DoxyCodeLine{00759         \textcolor{keywordflow}{case} 116: \textcolor{comment}{// D3DFMT\_A32B32G32R32F}}
\DoxyCodeLine{00760             \textcolor{keywordflow}{return} DXGI\_FORMAT\_R32G32B32A32\_FLOAT;}
\DoxyCodeLine{00761         \}}
\DoxyCodeLine{00762     \}}
\DoxyCodeLine{00763 }
\DoxyCodeLine{00764     \textcolor{keywordflow}{return} DXGI\_FORMAT\_UNKNOWN;}
\DoxyCodeLine{00765 \}}
\DoxyCodeLine{00766 }
\DoxyCodeLine{00767 }
\DoxyCodeLine{00768 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00769 \textcolor{keyword}{static} DXGI\_FORMAT MakeSRGB( \_In\_ DXGI\_FORMAT format )}
\DoxyCodeLine{00770 \{}
\DoxyCodeLine{00771     \textcolor{keywordflow}{switch}( format )}
\DoxyCodeLine{00772     \{}
\DoxyCodeLine{00773     \textcolor{keywordflow}{case} DXGI\_FORMAT\_R8G8B8A8\_UNORM:}
\DoxyCodeLine{00774         \textcolor{keywordflow}{return} DXGI\_FORMAT\_R8G8B8A8\_UNORM\_SRGB;}
\DoxyCodeLine{00775 }
\DoxyCodeLine{00776     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC1\_UNORM:}
\DoxyCodeLine{00777         \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC1\_UNORM\_SRGB;}
\DoxyCodeLine{00778 }
\DoxyCodeLine{00779     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC2\_UNORM:}
\DoxyCodeLine{00780         \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC2\_UNORM\_SRGB;}
\DoxyCodeLine{00781 }
\DoxyCodeLine{00782     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC3\_UNORM:}
\DoxyCodeLine{00783         \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC3\_UNORM\_SRGB;}
\DoxyCodeLine{00784 }
\DoxyCodeLine{00785     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8A8\_UNORM:}
\DoxyCodeLine{00786         \textcolor{keywordflow}{return} DXGI\_FORMAT\_B8G8R8A8\_UNORM\_SRGB;}
\DoxyCodeLine{00787 }
\DoxyCodeLine{00788     \textcolor{keywordflow}{case} DXGI\_FORMAT\_B8G8R8X8\_UNORM:}
\DoxyCodeLine{00789         \textcolor{keywordflow}{return} DXGI\_FORMAT\_B8G8R8X8\_UNORM\_SRGB;}
\DoxyCodeLine{00790 }
\DoxyCodeLine{00791     \textcolor{keywordflow}{case} DXGI\_FORMAT\_BC7\_UNORM:}
\DoxyCodeLine{00792         \textcolor{keywordflow}{return} DXGI\_FORMAT\_BC7\_UNORM\_SRGB;}
\DoxyCodeLine{00793 }
\DoxyCodeLine{00794     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00795         \textcolor{keywordflow}{return} format;}
\DoxyCodeLine{00796     \}}
\DoxyCodeLine{00797 \}}
\DoxyCodeLine{00798 }
\DoxyCodeLine{00799 }
\DoxyCodeLine{00800 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00801 \textcolor{keyword}{static} HRESULT FillInitData( \_In\_ \textcolor{keywordtype}{size\_t} width,}
\DoxyCodeLine{00802                              \_In\_ \textcolor{keywordtype}{size\_t} height,}
\DoxyCodeLine{00803                              \_In\_ \textcolor{keywordtype}{size\_t} depth,}
\DoxyCodeLine{00804                              \_In\_ \textcolor{keywordtype}{size\_t} mipCount,}
\DoxyCodeLine{00805                              \_In\_ \textcolor{keywordtype}{size\_t} arraySize,}
\DoxyCodeLine{00806                              \_In\_ DXGI\_FORMAT format,}
\DoxyCodeLine{00807                              \_In\_ \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{00808                              \_In\_ \textcolor{keywordtype}{size\_t} bitSize,}
\DoxyCodeLine{00809                              \_In\_reads\_bytes\_(bitSize) \textcolor{keyword}{const} uint8\_t* bitData,}
\DoxyCodeLine{00810                              \_Out\_ \textcolor{keywordtype}{size\_t}\& twidth,}
\DoxyCodeLine{00811                              \_Out\_ \textcolor{keywordtype}{size\_t}\& theight,}
\DoxyCodeLine{00812                              \_Out\_ \textcolor{keywordtype}{size\_t}\& tdepth,}
\DoxyCodeLine{00813                              \_Out\_ \textcolor{keywordtype}{size\_t}\& skipMip,}
\DoxyCodeLine{00814                              \_Out\_writes\_(mipCount*arraySize) D3D11\_SUBRESOURCE\_DATA* initData )}
\DoxyCodeLine{00815 \{}
\DoxyCodeLine{00816     \textcolor{keywordflow}{if} ( !bitData || !initData )}
\DoxyCodeLine{00817     \{}
\DoxyCodeLine{00818         \textcolor{keywordflow}{return} E\_POINTER;}
\DoxyCodeLine{00819     \}}
\DoxyCodeLine{00820 }
\DoxyCodeLine{00821     skipMip = 0;}
\DoxyCodeLine{00822     twidth = 0;}
\DoxyCodeLine{00823     theight = 0;}
\DoxyCodeLine{00824     tdepth = 0;}
\DoxyCodeLine{00825 }
\DoxyCodeLine{00826     \textcolor{keywordtype}{size\_t} NumBytes = 0;}
\DoxyCodeLine{00827     \textcolor{keywordtype}{size\_t} RowBytes = 0;}
\DoxyCodeLine{00828     \textcolor{keyword}{const} uint8\_t* pSrcBits = bitData;}
\DoxyCodeLine{00829     \textcolor{keyword}{const} uint8\_t* pEndBits = bitData + bitSize;}
\DoxyCodeLine{00830 }
\DoxyCodeLine{00831     \textcolor{keywordtype}{size\_t} index = 0;}
\DoxyCodeLine{00832     \textcolor{keywordflow}{for}( \textcolor{keywordtype}{size\_t} j = 0; j < arraySize; j++ )}
\DoxyCodeLine{00833     \{}
\DoxyCodeLine{00834         \textcolor{keywordtype}{size\_t} w = width;}
\DoxyCodeLine{00835         \textcolor{keywordtype}{size\_t} h = height;}
\DoxyCodeLine{00836         \textcolor{keywordtype}{size\_t} d = depth;}
\DoxyCodeLine{00837         \textcolor{keywordflow}{for}( \textcolor{keywordtype}{size\_t} i = 0; i < mipCount; i++ )}
\DoxyCodeLine{00838         \{}
\DoxyCodeLine{00839             GetSurfaceInfo( w,}
\DoxyCodeLine{00840                             h,}
\DoxyCodeLine{00841                             format,}
\DoxyCodeLine{00842                             \&NumBytes,}
\DoxyCodeLine{00843                             \&RowBytes,}
\DoxyCodeLine{00844                             \textcolor{keyword}{nullptr}}
\DoxyCodeLine{00845                           );}
\DoxyCodeLine{00846 }
\DoxyCodeLine{00847             \textcolor{keywordflow}{if} ( (mipCount <= 1) || !maxsize || (w <= maxsize \&\& h <= maxsize \&\& d <= maxsize) )}
\DoxyCodeLine{00848             \{}
\DoxyCodeLine{00849                 \textcolor{keywordflow}{if} ( !twidth )}
\DoxyCodeLine{00850                 \{}
\DoxyCodeLine{00851                     twidth = w;}
\DoxyCodeLine{00852                     theight = h;}
\DoxyCodeLine{00853                     tdepth = d;}
\DoxyCodeLine{00854                 \}}
\DoxyCodeLine{00855 }
\DoxyCodeLine{00856                 assert(index < mipCount * arraySize);}
\DoxyCodeLine{00857                 \_Analysis\_assume\_(index < mipCount * arraySize);}
\DoxyCodeLine{00858                 initData[index].pSysMem = ( \textcolor{keyword}{const} \textcolor{keywordtype}{void}* )pSrcBits;}
\DoxyCodeLine{00859                 initData[index].SysMemPitch = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( RowBytes );}
\DoxyCodeLine{00860                 initData[index].SysMemSlicePitch = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( NumBytes );}
\DoxyCodeLine{00861                 ++index;}
\DoxyCodeLine{00862             \}}
\DoxyCodeLine{00863             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( !j )}
\DoxyCodeLine{00864             \{}
\DoxyCodeLine{00865                 \textcolor{comment}{// Count number of skipped mipmaps (first item only)}}
\DoxyCodeLine{00866                 ++skipMip;}
\DoxyCodeLine{00867             \}}
\DoxyCodeLine{00868 }
\DoxyCodeLine{00869             \textcolor{keywordflow}{if} (pSrcBits + (NumBytes*d) > pEndBits)}
\DoxyCodeLine{00870             \{}
\DoxyCodeLine{00871                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_HANDLE\_EOF );}
\DoxyCodeLine{00872             \}}
\DoxyCodeLine{00873   }
\DoxyCodeLine{00874             pSrcBits += NumBytes * d;}
\DoxyCodeLine{00875 }
\DoxyCodeLine{00876             w = w >> 1;}
\DoxyCodeLine{00877             h = h >> 1;}
\DoxyCodeLine{00878             d = d >> 1;}
\DoxyCodeLine{00879             \textcolor{keywordflow}{if} (w == 0)}
\DoxyCodeLine{00880             \{}
\DoxyCodeLine{00881                 w = 1;}
\DoxyCodeLine{00882             \}}
\DoxyCodeLine{00883             \textcolor{keywordflow}{if} (h == 0)}
\DoxyCodeLine{00884             \{}
\DoxyCodeLine{00885                 h = 1;}
\DoxyCodeLine{00886             \}}
\DoxyCodeLine{00887             \textcolor{keywordflow}{if} (d == 0)}
\DoxyCodeLine{00888             \{}
\DoxyCodeLine{00889                 d = 1;}
\DoxyCodeLine{00890             \}}
\DoxyCodeLine{00891         \}}
\DoxyCodeLine{00892     \}}
\DoxyCodeLine{00893 }
\DoxyCodeLine{00894     \textcolor{keywordflow}{return} (index > 0) ? S\_OK : E\_FAIL;}
\DoxyCodeLine{00895 \}}
\DoxyCodeLine{00896 }
\DoxyCodeLine{00897 \textcolor{keyword}{static} HRESULT FillInitData12(\_In\_ \textcolor{keywordtype}{size\_t} width,}
\DoxyCodeLine{00898     \_In\_ \textcolor{keywordtype}{size\_t} height,}
\DoxyCodeLine{00899     \_In\_ \textcolor{keywordtype}{size\_t} depth,}
\DoxyCodeLine{00900     \_In\_ \textcolor{keywordtype}{size\_t} mipCount,}
\DoxyCodeLine{00901     \_In\_ \textcolor{keywordtype}{size\_t} arraySize,}
\DoxyCodeLine{00902     \_In\_ DXGI\_FORMAT format,}
\DoxyCodeLine{00903     \_In\_ \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{00904     \_In\_ \textcolor{keywordtype}{size\_t} bitSize,}
\DoxyCodeLine{00905     \_In\_reads\_bytes\_(bitSize) \textcolor{keyword}{const} uint8\_t* bitData,}
\DoxyCodeLine{00906     \_Out\_ \textcolor{keywordtype}{size\_t}\& twidth,}
\DoxyCodeLine{00907     \_Out\_ \textcolor{keywordtype}{size\_t}\& theight,}
\DoxyCodeLine{00908     \_Out\_ \textcolor{keywordtype}{size\_t}\& tdepth,}
\DoxyCodeLine{00909     \_Out\_ \textcolor{keywordtype}{size\_t}\& skipMip,}
\DoxyCodeLine{00910     \_Out\_writes\_(mipCount*arraySize) D3D12\_SUBRESOURCE\_DATA* initData}
\DoxyCodeLine{00911     )}
\DoxyCodeLine{00912 \{}
\DoxyCodeLine{00913     \textcolor{keywordflow}{if} (!bitData || !initData)}
\DoxyCodeLine{00914     \{}
\DoxyCodeLine{00915         \textcolor{keywordflow}{return} E\_POINTER;}
\DoxyCodeLine{00916     \}}
\DoxyCodeLine{00917 }
\DoxyCodeLine{00918     skipMip = 0;}
\DoxyCodeLine{00919     twidth = 0;}
\DoxyCodeLine{00920     theight = 0;}
\DoxyCodeLine{00921     tdepth = 0;}
\DoxyCodeLine{00922 }
\DoxyCodeLine{00923     \textcolor{keywordtype}{size\_t} NumBytes = 0;}
\DoxyCodeLine{00924     \textcolor{keywordtype}{size\_t} RowBytes = 0;}
\DoxyCodeLine{00925     \textcolor{keyword}{const} uint8\_t* pSrcBits = bitData;}
\DoxyCodeLine{00926     \textcolor{keyword}{const} uint8\_t* pEndBits = bitData + bitSize;}
\DoxyCodeLine{00927 }
\DoxyCodeLine{00928     \textcolor{keywordtype}{size\_t} index = 0;}
\DoxyCodeLine{00929     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < arraySize; j++)}
\DoxyCodeLine{00930     \{}
\DoxyCodeLine{00931         \textcolor{keywordtype}{size\_t} w = width;}
\DoxyCodeLine{00932         \textcolor{keywordtype}{size\_t} h = height;}
\DoxyCodeLine{00933         \textcolor{keywordtype}{size\_t} d = depth;}
\DoxyCodeLine{00934         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < mipCount; i++)}
\DoxyCodeLine{00935         \{}
\DoxyCodeLine{00936             GetSurfaceInfo(w,}
\DoxyCodeLine{00937                 h,}
\DoxyCodeLine{00938                 format,}
\DoxyCodeLine{00939                 \&NumBytes,}
\DoxyCodeLine{00940                 \&RowBytes,}
\DoxyCodeLine{00941                 \textcolor{keyword}{nullptr}}
\DoxyCodeLine{00942                 );}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944             \textcolor{keywordflow}{if} ((mipCount <= 1) || !maxsize || (w <= maxsize \&\& h <= maxsize \&\& d <= maxsize))}
\DoxyCodeLine{00945             \{}
\DoxyCodeLine{00946                 \textcolor{keywordflow}{if} (!twidth)}
\DoxyCodeLine{00947                 \{}
\DoxyCodeLine{00948                     twidth = w;}
\DoxyCodeLine{00949                     theight = h;}
\DoxyCodeLine{00950                     tdepth = d;}
\DoxyCodeLine{00951                 \}}
\DoxyCodeLine{00952 }
\DoxyCodeLine{00953                 assert(index < mipCount * arraySize);}
\DoxyCodeLine{00954                 \_Analysis\_assume\_(index < mipCount * arraySize);}
\DoxyCodeLine{00955                 initData[index].\textcolor{comment}{/*pSysMem*/}pData = (\textcolor{keyword}{const} \textcolor{keywordtype}{void}*)pSrcBits;}
\DoxyCodeLine{00956                 initData[index].\textcolor{comment}{/*SysMemPitch*/}RowPitch = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}(RowBytes);}
\DoxyCodeLine{00957                 initData[index].\textcolor{comment}{/*SysMemSlicePitch*/}SlicePitch = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}(NumBytes);}
\DoxyCodeLine{00958                 ++index;}
\DoxyCodeLine{00959             \}}
\DoxyCodeLine{00960             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!j)}
\DoxyCodeLine{00961             \{}
\DoxyCodeLine{00962                 \textcolor{comment}{// Count number of skipped mipmaps (first item only)}}
\DoxyCodeLine{00963                 ++skipMip;}
\DoxyCodeLine{00964             \}}
\DoxyCodeLine{00965 }
\DoxyCodeLine{00966             \textcolor{keywordflow}{if} (pSrcBits + (NumBytes*d) > pEndBits)}
\DoxyCodeLine{00967             \{}
\DoxyCodeLine{00968                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_HANDLE\_EOF);}
\DoxyCodeLine{00969             \}}
\DoxyCodeLine{00970 }
\DoxyCodeLine{00971             pSrcBits += NumBytes * d;}
\DoxyCodeLine{00972 }
\DoxyCodeLine{00973             w = w >> 1;}
\DoxyCodeLine{00974             h = h >> 1;}
\DoxyCodeLine{00975             d = d >> 1;}
\DoxyCodeLine{00976             \textcolor{keywordflow}{if} (w == 0)}
\DoxyCodeLine{00977             \{}
\DoxyCodeLine{00978                 w = 1;}
\DoxyCodeLine{00979             \}}
\DoxyCodeLine{00980             \textcolor{keywordflow}{if} (h == 0)}
\DoxyCodeLine{00981             \{}
\DoxyCodeLine{00982                 h = 1;}
\DoxyCodeLine{00983             \}}
\DoxyCodeLine{00984             \textcolor{keywordflow}{if} (d == 0)}
\DoxyCodeLine{00985             \{}
\DoxyCodeLine{00986                 d = 1;}
\DoxyCodeLine{00987             \}}
\DoxyCodeLine{00988         \}}
\DoxyCodeLine{00989     \}}
\DoxyCodeLine{00990 }
\DoxyCodeLine{00991     \textcolor{keywordflow}{return} (index > 0) ? S\_OK : E\_FAIL;}
\DoxyCodeLine{00992 \}}
\DoxyCodeLine{00993 }
\DoxyCodeLine{00994 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00995 \textcolor{keyword}{static} HRESULT CreateD3DResources( \_In\_ ID3D11Device* d3dDevice,}
\DoxyCodeLine{00996                                    \_In\_ uint32\_t resDim,}
\DoxyCodeLine{00997                                    \_In\_ \textcolor{keywordtype}{size\_t} width,}
\DoxyCodeLine{00998                                    \_In\_ \textcolor{keywordtype}{size\_t} height,}
\DoxyCodeLine{00999                                    \_In\_ \textcolor{keywordtype}{size\_t} depth,}
\DoxyCodeLine{01000                                    \_In\_ \textcolor{keywordtype}{size\_t} mipCount,}
\DoxyCodeLine{01001                                    \_In\_ \textcolor{keywordtype}{size\_t} arraySize,}
\DoxyCodeLine{01002                                    \_In\_ DXGI\_FORMAT format,}
\DoxyCodeLine{01003                                    \_In\_ D3D11\_USAGE usage,}
\DoxyCodeLine{01004                                    \_In\_ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bindFlags,}
\DoxyCodeLine{01005                                    \_In\_ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cpuAccessFlags,}
\DoxyCodeLine{01006                                    \_In\_ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} miscFlags,}
\DoxyCodeLine{01007                                    \_In\_ \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{01008                                    \_In\_ \textcolor{keywordtype}{bool} isCubeMap,}
\DoxyCodeLine{01009                                    \_In\_reads\_opt\_(mipCount*arraySize) D3D11\_SUBRESOURCE\_DATA* initData,}
\DoxyCodeLine{01010                                    \_Outptr\_opt\_ ID3D11Resource** texture,}
\DoxyCodeLine{01011                                    \_Outptr\_opt\_ ID3D11ShaderResourceView** textureView )}
\DoxyCodeLine{01012 \{}
\DoxyCodeLine{01013     \textcolor{keywordflow}{if} ( !d3dDevice )}
\DoxyCodeLine{01014         \textcolor{keywordflow}{return} E\_POINTER;}
\DoxyCodeLine{01015 }
\DoxyCodeLine{01016     HRESULT hr = E\_FAIL;}
\DoxyCodeLine{01017 }
\DoxyCodeLine{01018     \textcolor{keywordflow}{if} ( forceSRGB )}
\DoxyCodeLine{01019     \{}
\DoxyCodeLine{01020         format = MakeSRGB( format );}
\DoxyCodeLine{01021     \}}
\DoxyCodeLine{01022 }
\DoxyCodeLine{01023     \textcolor{keywordflow}{switch} ( resDim ) }
\DoxyCodeLine{01024     \{}
\DoxyCodeLine{01025         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE1D:}
\DoxyCodeLine{01026             \{}
\DoxyCodeLine{01027                 D3D11\_TEXTURE1D\_DESC desc;}
\DoxyCodeLine{01028                 desc.Width = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( width ); }
\DoxyCodeLine{01029                 desc.MipLevels = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( mipCount );}
\DoxyCodeLine{01030                 desc.ArraySize = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( arraySize );}
\DoxyCodeLine{01031                 desc.Format = format;}
\DoxyCodeLine{01032                 desc.Usage = usage;}
\DoxyCodeLine{01033                 desc.BindFlags = bindFlags;}
\DoxyCodeLine{01034                 desc.CPUAccessFlags = cpuAccessFlags;}
\DoxyCodeLine{01035                 desc.MiscFlags = miscFlags \& \string~D3D11\_RESOURCE\_MISC\_TEXTURECUBE;}
\DoxyCodeLine{01036 }
\DoxyCodeLine{01037                 ID3D11Texture1D* tex = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01038                 hr = d3dDevice-\/>CreateTexture1D( \&desc,}
\DoxyCodeLine{01039                                                  initData,}
\DoxyCodeLine{01040                                                  \&tex}
\DoxyCodeLine{01041                                                );}
\DoxyCodeLine{01042                 \textcolor{keywordflow}{if} (SUCCEEDED( hr ) \&\& tex != 0)}
\DoxyCodeLine{01043                 \{}
\DoxyCodeLine{01044                     \textcolor{keywordflow}{if} (textureView != 0)}
\DoxyCodeLine{01045                     \{}
\DoxyCodeLine{01046                         D3D11\_SHADER\_RESOURCE\_VIEW\_DESC SRVDesc;}
\DoxyCodeLine{01047                         memset( \&SRVDesc, 0, \textcolor{keyword}{sizeof}( SRVDesc ) );}
\DoxyCodeLine{01048                         SRVDesc.Format = format;}
\DoxyCodeLine{01049 }
\DoxyCodeLine{01050                         \textcolor{keywordflow}{if} (arraySize > 1)}
\DoxyCodeLine{01051                         \{}
\DoxyCodeLine{01052                             SRVDesc.ViewDimension = D3D11\_SRV\_DIMENSION\_TEXTURE1DARRAY;}
\DoxyCodeLine{01053                             SRVDesc.Texture1DArray.MipLevels = (!mipCount) ? -\/1 : desc.MipLevels;}
\DoxyCodeLine{01054                             SRVDesc.Texture1DArray.ArraySize = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( arraySize );}
\DoxyCodeLine{01055                         \}}
\DoxyCodeLine{01056                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01057                         \{}
\DoxyCodeLine{01058                             SRVDesc.ViewDimension = D3D11\_SRV\_DIMENSION\_TEXTURE1D;}
\DoxyCodeLine{01059                             SRVDesc.Texture1D.MipLevels = (!mipCount) ? -\/1 : desc.MipLevels;}
\DoxyCodeLine{01060                         \}}
\DoxyCodeLine{01061 }
\DoxyCodeLine{01062                         hr = d3dDevice-\/>CreateShaderResourceView( tex,}
\DoxyCodeLine{01063                                                                   \&SRVDesc,}
\DoxyCodeLine{01064                                                                   textureView}
\DoxyCodeLine{01065                                                                 );}
\DoxyCodeLine{01066                         \textcolor{keywordflow}{if} ( FAILED(hr) )}
\DoxyCodeLine{01067                         \{}
\DoxyCodeLine{01068                             tex-\/>Release();}
\DoxyCodeLine{01069                             \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01070                         \}}
\DoxyCodeLine{01071                     \}}
\DoxyCodeLine{01072 }
\DoxyCodeLine{01073                     \textcolor{keywordflow}{if} (texture != 0)}
\DoxyCodeLine{01074                     \{}
\DoxyCodeLine{01075                         *texture = tex;}
\DoxyCodeLine{01076                     \}}
\DoxyCodeLine{01077                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01078                     \{}
\DoxyCodeLine{01079                         SetDebugObjectName(tex, \textcolor{stringliteral}{"{}DDSTextureLoader"{}});}
\DoxyCodeLine{01080                         tex-\/>Release();}
\DoxyCodeLine{01081                     \}}
\DoxyCodeLine{01082                 \}}
\DoxyCodeLine{01083             \}}
\DoxyCodeLine{01084            \textcolor{keywordflow}{break};}
\DoxyCodeLine{01085 }
\DoxyCodeLine{01086         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE2D:}
\DoxyCodeLine{01087             \{}
\DoxyCodeLine{01088                 D3D11\_TEXTURE2D\_DESC desc;}
\DoxyCodeLine{01089                 desc.Width = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( width );}
\DoxyCodeLine{01090                 desc.Height = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( height );}
\DoxyCodeLine{01091                 desc.MipLevels = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( mipCount );}
\DoxyCodeLine{01092                 desc.ArraySize = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( arraySize );}
\DoxyCodeLine{01093                 desc.Format = format;}
\DoxyCodeLine{01094                 desc.SampleDesc.Count = 1;}
\DoxyCodeLine{01095                 desc.SampleDesc.Quality = 0;}
\DoxyCodeLine{01096                 desc.Usage = usage;}
\DoxyCodeLine{01097                 desc.BindFlags = bindFlags;}
\DoxyCodeLine{01098                 desc.CPUAccessFlags = cpuAccessFlags;}
\DoxyCodeLine{01099                 \textcolor{keywordflow}{if} ( isCubeMap )}
\DoxyCodeLine{01100                 \{}
\DoxyCodeLine{01101                     desc.MiscFlags = miscFlags | D3D11\_RESOURCE\_MISC\_TEXTURECUBE;}
\DoxyCodeLine{01102                 \}}
\DoxyCodeLine{01103                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{01104                 \{}
\DoxyCodeLine{01105                     desc.MiscFlags = miscFlags \& \string~D3D11\_RESOURCE\_MISC\_TEXTURECUBE;}
\DoxyCodeLine{01106                 \}}
\DoxyCodeLine{01107 }
\DoxyCodeLine{01108                 ID3D11Texture2D* tex = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01109                 hr = d3dDevice-\/>CreateTexture2D( \&desc,}
\DoxyCodeLine{01110                                                  initData,}
\DoxyCodeLine{01111                                                  \&tex}
\DoxyCodeLine{01112                                                );}
\DoxyCodeLine{01113                 \textcolor{keywordflow}{if} (SUCCEEDED( hr ) \&\& tex != 0)}
\DoxyCodeLine{01114                 \{}
\DoxyCodeLine{01115                     \textcolor{keywordflow}{if} (textureView != 0)}
\DoxyCodeLine{01116                     \{}
\DoxyCodeLine{01117                         D3D11\_SHADER\_RESOURCE\_VIEW\_DESC SRVDesc;}
\DoxyCodeLine{01118                         memset( \&SRVDesc, 0, \textcolor{keyword}{sizeof}( SRVDesc ) );}
\DoxyCodeLine{01119                         SRVDesc.Format = format;}
\DoxyCodeLine{01120 }
\DoxyCodeLine{01121                         \textcolor{keywordflow}{if} ( isCubeMap )}
\DoxyCodeLine{01122                         \{}
\DoxyCodeLine{01123                             \textcolor{keywordflow}{if} (arraySize > 6)}
\DoxyCodeLine{01124                             \{}
\DoxyCodeLine{01125                                 SRVDesc.ViewDimension = D3D11\_SRV\_DIMENSION\_TEXTURECUBEARRAY;}
\DoxyCodeLine{01126                                 SRVDesc.TextureCubeArray.MipLevels = (!mipCount) ? -\/1 : desc.MipLevels;}
\DoxyCodeLine{01127 }
\DoxyCodeLine{01128                                 \textcolor{comment}{// Earlier we set arraySize to (NumCubes * 6)}}
\DoxyCodeLine{01129                                 SRVDesc.TextureCubeArray.NumCubes = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( arraySize / 6 );}
\DoxyCodeLine{01130                             \}}
\DoxyCodeLine{01131                             \textcolor{keywordflow}{else}}
\DoxyCodeLine{01132                             \{}
\DoxyCodeLine{01133                                 SRVDesc.ViewDimension = D3D11\_SRV\_DIMENSION\_TEXTURECUBE;}
\DoxyCodeLine{01134                                 SRVDesc.TextureCube.MipLevels = (!mipCount) ? -\/1 : desc.MipLevels;}
\DoxyCodeLine{01135                             \}}
\DoxyCodeLine{01136                         \}}
\DoxyCodeLine{01137                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (arraySize > 1)}
\DoxyCodeLine{01138                         \{}
\DoxyCodeLine{01139                             SRVDesc.ViewDimension = D3D11\_SRV\_DIMENSION\_TEXTURE2DARRAY;}
\DoxyCodeLine{01140                             SRVDesc.Texture2DArray.MipLevels = (!mipCount) ? -\/1 : desc.MipLevels;}
\DoxyCodeLine{01141                             SRVDesc.Texture2DArray.ArraySize = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( arraySize );}
\DoxyCodeLine{01142                         \}}
\DoxyCodeLine{01143                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01144                         \{}
\DoxyCodeLine{01145                             SRVDesc.ViewDimension = D3D11\_SRV\_DIMENSION\_TEXTURE2D;}
\DoxyCodeLine{01146                             SRVDesc.Texture2D.MipLevels = (!mipCount) ? -\/1 : desc.MipLevels;}
\DoxyCodeLine{01147                         \}}
\DoxyCodeLine{01148 }
\DoxyCodeLine{01149                         hr = d3dDevice-\/>CreateShaderResourceView( tex,}
\DoxyCodeLine{01150                                                                   \&SRVDesc,}
\DoxyCodeLine{01151                                                                   textureView}
\DoxyCodeLine{01152                                                                 );}
\DoxyCodeLine{01153                         \textcolor{keywordflow}{if} ( FAILED(hr) )}
\DoxyCodeLine{01154                         \{}
\DoxyCodeLine{01155                             tex-\/>Release();}
\DoxyCodeLine{01156                             \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01157                         \}}
\DoxyCodeLine{01158                     \}}
\DoxyCodeLine{01159 }
\DoxyCodeLine{01160                     \textcolor{keywordflow}{if} (texture != 0)}
\DoxyCodeLine{01161                     \{}
\DoxyCodeLine{01162                         *texture = tex;}
\DoxyCodeLine{01163                     \}}
\DoxyCodeLine{01164                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01165                     \{}
\DoxyCodeLine{01166                         SetDebugObjectName(tex, \textcolor{stringliteral}{"{}DDSTextureLoader"{}});}
\DoxyCodeLine{01167                         tex-\/>Release();}
\DoxyCodeLine{01168                     \}}
\DoxyCodeLine{01169                 \}}
\DoxyCodeLine{01170             \}}
\DoxyCodeLine{01171             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01172 }
\DoxyCodeLine{01173         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D:}
\DoxyCodeLine{01174             \{}
\DoxyCodeLine{01175                 D3D11\_TEXTURE3D\_DESC desc;}
\DoxyCodeLine{01176                 desc.Width = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( width );}
\DoxyCodeLine{01177                 desc.Height = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( height );}
\DoxyCodeLine{01178                 desc.Depth = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( depth );}
\DoxyCodeLine{01179                 desc.MipLevels = \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( mipCount );}
\DoxyCodeLine{01180                 desc.Format = format;}
\DoxyCodeLine{01181                 desc.Usage = usage;}
\DoxyCodeLine{01182                 desc.BindFlags = bindFlags;}
\DoxyCodeLine{01183                 desc.CPUAccessFlags = cpuAccessFlags;}
\DoxyCodeLine{01184                 desc.MiscFlags = miscFlags \& \string~D3D11\_RESOURCE\_MISC\_TEXTURECUBE;}
\DoxyCodeLine{01185 }
\DoxyCodeLine{01186                 ID3D11Texture3D* tex = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01187                 hr = d3dDevice-\/>CreateTexture3D( \&desc,}
\DoxyCodeLine{01188                                                  initData,}
\DoxyCodeLine{01189                                                  \&tex}
\DoxyCodeLine{01190                                                );}
\DoxyCodeLine{01191                 \textcolor{keywordflow}{if} (SUCCEEDED( hr ) \&\& tex != 0)}
\DoxyCodeLine{01192                 \{}
\DoxyCodeLine{01193                     \textcolor{keywordflow}{if} (textureView != 0)}
\DoxyCodeLine{01194                     \{}
\DoxyCodeLine{01195                         D3D11\_SHADER\_RESOURCE\_VIEW\_DESC SRVDesc;}
\DoxyCodeLine{01196                         memset( \&SRVDesc, 0, \textcolor{keyword}{sizeof}( SRVDesc ) );}
\DoxyCodeLine{01197                         SRVDesc.Format = format;}
\DoxyCodeLine{01198 }
\DoxyCodeLine{01199                         SRVDesc.ViewDimension = D3D11\_SRV\_DIMENSION\_TEXTURE3D;}
\DoxyCodeLine{01200                         SRVDesc.Texture3D.MipLevels = (!mipCount) ? -\/1 : desc.MipLevels;}
\DoxyCodeLine{01201 }
\DoxyCodeLine{01202                         hr = d3dDevice-\/>CreateShaderResourceView( tex,}
\DoxyCodeLine{01203                                                                   \&SRVDesc,}
\DoxyCodeLine{01204                                                                   textureView}
\DoxyCodeLine{01205                                                                 );}
\DoxyCodeLine{01206                         \textcolor{keywordflow}{if} ( FAILED(hr) )}
\DoxyCodeLine{01207                         \{}
\DoxyCodeLine{01208                             tex-\/>Release();}
\DoxyCodeLine{01209                             \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01210                         \}}
\DoxyCodeLine{01211                     \}}
\DoxyCodeLine{01212 }
\DoxyCodeLine{01213                     \textcolor{keywordflow}{if} (texture != 0)}
\DoxyCodeLine{01214                     \{}
\DoxyCodeLine{01215                         *texture = tex;}
\DoxyCodeLine{01216                     \}}
\DoxyCodeLine{01217                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01218                     \{}
\DoxyCodeLine{01219                         SetDebugObjectName(tex, \textcolor{stringliteral}{"{}DDSTextureLoader"{}});}
\DoxyCodeLine{01220                         tex-\/>Release();}
\DoxyCodeLine{01221                     \}}
\DoxyCodeLine{01222                 \}}
\DoxyCodeLine{01223             \}}
\DoxyCodeLine{01224             \textcolor{keywordflow}{break}; }
\DoxyCodeLine{01225     \}}
\DoxyCodeLine{01226 }
\DoxyCodeLine{01227     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01228 \}}
\DoxyCodeLine{01229 }
\DoxyCodeLine{01230 \textcolor{keyword}{static} HRESULT CreateD3DResources12(}
\DoxyCodeLine{01231     ID3D12Device* device,}
\DoxyCodeLine{01232     ID3D12GraphicsCommandList* cmdList,}
\DoxyCodeLine{01233     \_In\_ uint32\_t resDim,}
\DoxyCodeLine{01234     \_In\_ \textcolor{keywordtype}{size\_t} width,}
\DoxyCodeLine{01235     \_In\_ \textcolor{keywordtype}{size\_t} height,}
\DoxyCodeLine{01236     \_In\_ \textcolor{keywordtype}{size\_t} depth,}
\DoxyCodeLine{01237     \_In\_ \textcolor{keywordtype}{size\_t} mipCount,}
\DoxyCodeLine{01238     \_In\_ \textcolor{keywordtype}{size\_t} arraySize,}
\DoxyCodeLine{01239     \_In\_ DXGI\_FORMAT format,}
\DoxyCodeLine{01240     \_In\_ \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{01241     \_In\_ \textcolor{keywordtype}{bool} isCubeMap,}
\DoxyCodeLine{01242     \_In\_reads\_opt\_(mipCount*arraySize) D3D12\_SUBRESOURCE\_DATA* initData,}
\DoxyCodeLine{01243     ComPtr<ID3D12Resource>\& texture,}
\DoxyCodeLine{01244     ComPtr<ID3D12Resource>\& textureUploadHeap}
\DoxyCodeLine{01245     )}
\DoxyCodeLine{01246 \{}
\DoxyCodeLine{01247     \textcolor{keywordflow}{if} (device == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{01248         \textcolor{keywordflow}{return} E\_POINTER;}
\DoxyCodeLine{01249 }
\DoxyCodeLine{01250     \textcolor{keywordflow}{if} (forceSRGB)}
\DoxyCodeLine{01251         format = MakeSRGB(format);}
\DoxyCodeLine{01252 }
\DoxyCodeLine{01253     HRESULT hr = E\_FAIL;}
\DoxyCodeLine{01254     \textcolor{keywordflow}{switch} (resDim)}
\DoxyCodeLine{01255     \{}
\DoxyCodeLine{01256     \textcolor{keywordflow}{case} D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D:}
\DoxyCodeLine{01257     \{}
\DoxyCodeLine{01258         D3D12\_RESOURCE\_DESC texDesc;}
\DoxyCodeLine{01259         ZeroMemory(\&texDesc, \textcolor{keyword}{sizeof}(D3D12\_RESOURCE\_DESC));}
\DoxyCodeLine{01260         texDesc.Dimension = D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D;}
\DoxyCodeLine{01261         texDesc.Alignment = 0;}
\DoxyCodeLine{01262         texDesc.Width = width;}
\DoxyCodeLine{01263         texDesc.Height = (uint32\_t)height;}
\DoxyCodeLine{01264         texDesc.DepthOrArraySize = (depth > 1) ? (uint16\_t)depth : (uint16\_t)arraySize;}
\DoxyCodeLine{01265         texDesc.MipLevels = (uint16\_t)mipCount;}
\DoxyCodeLine{01266         texDesc.Format = format;}
\DoxyCodeLine{01267         texDesc.SampleDesc.Count = 1;}
\DoxyCodeLine{01268         texDesc.SampleDesc.Quality = 0;}
\DoxyCodeLine{01269         texDesc.Layout = D3D12\_TEXTURE\_LAYOUT\_UNKNOWN;}
\DoxyCodeLine{01270         texDesc.Flags = D3D12\_RESOURCE\_FLAG\_NONE;}
\DoxyCodeLine{01271 }
\DoxyCodeLine{01272         hr = device-\/>CreateCommittedResource(}
\DoxyCodeLine{01273             \&CD3DX12\_HEAP\_PROPERTIES(D3D12\_HEAP\_TYPE\_DEFAULT),}
\DoxyCodeLine{01274             D3D12\_HEAP\_FLAG\_NONE,}
\DoxyCodeLine{01275             \&texDesc,}
\DoxyCodeLine{01276             D3D12\_RESOURCE\_STATE\_COMMON,}
\DoxyCodeLine{01277             \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01278             IID\_PPV\_ARGS(\&texture)}
\DoxyCodeLine{01279             );}
\DoxyCodeLine{01280 }
\DoxyCodeLine{01281         \textcolor{keywordflow}{if} (FAILED(hr))}
\DoxyCodeLine{01282         \{}
\DoxyCodeLine{01283             texture = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01284             \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01285         \}}
\DoxyCodeLine{01286         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01287         \{}
\DoxyCodeLine{01288             \textcolor{keyword}{const} UINT num2DSubresources = texDesc.DepthOrArraySize * texDesc.MipLevels;}
\DoxyCodeLine{01289             \textcolor{keyword}{const} UINT64 uploadBufferSize = GetRequiredIntermediateSize(texture.Get(), 0, num2DSubresources);}
\DoxyCodeLine{01290 }
\DoxyCodeLine{01291             hr = device-\/>CreateCommittedResource(}
\DoxyCodeLine{01292                 \&CD3DX12\_HEAP\_PROPERTIES(D3D12\_HEAP\_TYPE\_UPLOAD),}
\DoxyCodeLine{01293                 D3D12\_HEAP\_FLAG\_NONE,}
\DoxyCodeLine{01294                 \&CD3DX12\_RESOURCE\_DESC::Buffer(uploadBufferSize),}
\DoxyCodeLine{01295                 D3D12\_RESOURCE\_STATE\_GENERIC\_READ,}
\DoxyCodeLine{01296                 \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01297                 IID\_PPV\_ARGS(\&textureUploadHeap));}
\DoxyCodeLine{01298             \textcolor{keywordflow}{if} (FAILED(hr))}
\DoxyCodeLine{01299             \{}
\DoxyCodeLine{01300                 texture = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01301                 \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01302             \}}
\DoxyCodeLine{01303             \textcolor{keywordflow}{else}}
\DoxyCodeLine{01304             \{}
\DoxyCodeLine{01305                 cmdList-\/>ResourceBarrier(1, \&CD3DX12\_RESOURCE\_BARRIER::Transition(texture.Get(),}
\DoxyCodeLine{01306                     D3D12\_RESOURCE\_STATE\_COMMON, D3D12\_RESOURCE\_STATE\_COPY\_DEST));}
\DoxyCodeLine{01307 }
\DoxyCodeLine{01308                 \textcolor{comment}{// Use Heap-\/allocating UpdateSubresources implementation for variable number of subresources (which is the case for textures).}}
\DoxyCodeLine{01309                 UpdateSubresources(cmdList, texture.Get(), textureUploadHeap.Get(), 0, 0, num2DSubresources, initData);}
\DoxyCodeLine{01310 }
\DoxyCodeLine{01311                 cmdList-\/>ResourceBarrier(1, \&CD3DX12\_RESOURCE\_BARRIER::Transition(texture.Get(),}
\DoxyCodeLine{01312                     D3D12\_RESOURCE\_STATE\_COPY\_DEST, D3D12\_RESOURCE\_STATE\_PIXEL\_SHADER\_RESOURCE));}
\DoxyCodeLine{01313             \}}
\DoxyCodeLine{01314         \}}
\DoxyCodeLine{01315     \} \textcolor{keywordflow}{break};}
\DoxyCodeLine{01316     \}}
\DoxyCodeLine{01317 }
\DoxyCodeLine{01318     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01319 \}}
\DoxyCodeLine{01320 }
\DoxyCodeLine{01321 }
\DoxyCodeLine{01322 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01323 \textcolor{keyword}{static} HRESULT CreateTextureFromDDS( \_In\_ ID3D11Device* d3dDevice,}
\DoxyCodeLine{01324                                      \_In\_opt\_ ID3D11DeviceContext* d3dContext,}
\DoxyCodeLine{01325                                      \_In\_ \textcolor{keyword}{const} DDS\_HEADER* header,}
\DoxyCodeLine{01326                                      \_In\_reads\_bytes\_(bitSize) \textcolor{keyword}{const} uint8\_t* bitData,}
\DoxyCodeLine{01327                                      \_In\_ \textcolor{keywordtype}{size\_t} bitSize,}
\DoxyCodeLine{01328                                      \_In\_ \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{01329                                      \_In\_ D3D11\_USAGE usage,}
\DoxyCodeLine{01330                                      \_In\_ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bindFlags,}
\DoxyCodeLine{01331                                      \_In\_ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cpuAccessFlags,}
\DoxyCodeLine{01332                                      \_In\_ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} miscFlags,}
\DoxyCodeLine{01333                                      \_In\_ \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{01334                                      \_Outptr\_opt\_ ID3D11Resource** texture,}
\DoxyCodeLine{01335                                      \_Outptr\_opt\_ ID3D11ShaderResourceView** textureView )}
\DoxyCodeLine{01336 \{}
\DoxyCodeLine{01337     HRESULT hr = S\_OK;}
\DoxyCodeLine{01338 }
\DoxyCodeLine{01339     UINT width = header-\/>width;}
\DoxyCodeLine{01340     UINT height = header-\/>height;}
\DoxyCodeLine{01341     UINT depth = header-\/>depth;}
\DoxyCodeLine{01342 }
\DoxyCodeLine{01343     uint32\_t resDim = D3D11\_RESOURCE\_DIMENSION\_UNKNOWN;}
\DoxyCodeLine{01344     UINT arraySize = 1;}
\DoxyCodeLine{01345     DXGI\_FORMAT format = DXGI\_FORMAT\_UNKNOWN;}
\DoxyCodeLine{01346     \textcolor{keywordtype}{bool} isCubeMap = \textcolor{keyword}{false};}
\DoxyCodeLine{01347 }
\DoxyCodeLine{01348     \textcolor{keywordtype}{size\_t} mipCount = header-\/>mipMapCount;}
\DoxyCodeLine{01349     \textcolor{keywordflow}{if} (0 == mipCount)}
\DoxyCodeLine{01350     \{}
\DoxyCodeLine{01351         mipCount = 1;}
\DoxyCodeLine{01352     \}}
\DoxyCodeLine{01353 }
\DoxyCodeLine{01354     \textcolor{keywordflow}{if} ((header-\/>ddspf.flags \& DDS\_FOURCC) \&\&}
\DoxyCodeLine{01355         (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'1'}, \textcolor{charliteral}{'0'} ) == header-\/>ddspf.fourCC ))}
\DoxyCodeLine{01356     \{}
\DoxyCodeLine{01357         \textcolor{keyword}{auto} d3d10ext = \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }DDS\_HEADER\_DXT10*\textcolor{keyword}{>}( (\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)header + \textcolor{keyword}{sizeof}(DDS\_HEADER) );}
\DoxyCodeLine{01358 }
\DoxyCodeLine{01359         arraySize = d3d10ext-\/>arraySize;}
\DoxyCodeLine{01360         \textcolor{keywordflow}{if} (arraySize == 0)}
\DoxyCodeLine{01361         \{}
\DoxyCodeLine{01362            \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_INVALID\_DATA );}
\DoxyCodeLine{01363         \}}
\DoxyCodeLine{01364 }
\DoxyCodeLine{01365         \textcolor{keywordflow}{switch}( d3d10ext-\/>dxgiFormat )}
\DoxyCodeLine{01366         \{}
\DoxyCodeLine{01367         \textcolor{keywordflow}{case} DXGI\_FORMAT\_AI44:}
\DoxyCodeLine{01368         \textcolor{keywordflow}{case} DXGI\_FORMAT\_IA44:}
\DoxyCodeLine{01369         \textcolor{keywordflow}{case} DXGI\_FORMAT\_P8:}
\DoxyCodeLine{01370         \textcolor{keywordflow}{case} DXGI\_FORMAT\_A8P8:}
\DoxyCodeLine{01371             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01372 }
\DoxyCodeLine{01373         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01374             \textcolor{keywordflow}{if} ( BitsPerPixel( d3d10ext-\/>dxgiFormat ) == 0 )}
\DoxyCodeLine{01375             \{}
\DoxyCodeLine{01376                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01377             \}}
\DoxyCodeLine{01378         \}}
\DoxyCodeLine{01379            }
\DoxyCodeLine{01380         format = d3d10ext-\/>dxgiFormat;}
\DoxyCodeLine{01381 }
\DoxyCodeLine{01382         \textcolor{keywordflow}{switch} ( d3d10ext-\/>resourceDimension )}
\DoxyCodeLine{01383         \{}
\DoxyCodeLine{01384         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE1D:}
\DoxyCodeLine{01385             \textcolor{comment}{// D3DX writes 1D textures with a fixed Height of 1}}
\DoxyCodeLine{01386             \textcolor{keywordflow}{if} ((header-\/>flags \& DDS\_HEIGHT) \&\& height != 1)}
\DoxyCodeLine{01387             \{}
\DoxyCodeLine{01388                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_INVALID\_DATA );}
\DoxyCodeLine{01389             \}}
\DoxyCodeLine{01390             height = depth = 1;}
\DoxyCodeLine{01391             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01392 }
\DoxyCodeLine{01393         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE2D:}
\DoxyCodeLine{01394             \textcolor{keywordflow}{if} (d3d10ext-\/>miscFlag \& D3D11\_RESOURCE\_MISC\_TEXTURECUBE)}
\DoxyCodeLine{01395             \{}
\DoxyCodeLine{01396                 arraySize *= 6;}
\DoxyCodeLine{01397                 isCubeMap = \textcolor{keyword}{true};}
\DoxyCodeLine{01398             \}}
\DoxyCodeLine{01399             depth = 1;}
\DoxyCodeLine{01400             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01401 }
\DoxyCodeLine{01402         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D:}
\DoxyCodeLine{01403             \textcolor{keywordflow}{if} (!(header-\/>flags \& DDS\_HEADER\_FLAGS\_VOLUME))}
\DoxyCodeLine{01404             \{}
\DoxyCodeLine{01405                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_INVALID\_DATA );}
\DoxyCodeLine{01406             \}}
\DoxyCodeLine{01407 }
\DoxyCodeLine{01408             \textcolor{keywordflow}{if} (arraySize > 1)}
\DoxyCodeLine{01409             \{}
\DoxyCodeLine{01410                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01411             \}}
\DoxyCodeLine{01412             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01413 }
\DoxyCodeLine{01414         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01415             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01416         \}}
\DoxyCodeLine{01417 }
\DoxyCodeLine{01418         resDim = d3d10ext-\/>resourceDimension;}
\DoxyCodeLine{01419     \}}
\DoxyCodeLine{01420     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01421     \{}
\DoxyCodeLine{01422         format = GetDXGIFormat( header-\/>ddspf );}
\DoxyCodeLine{01423 }
\DoxyCodeLine{01424         \textcolor{keywordflow}{if} (format == DXGI\_FORMAT\_UNKNOWN)}
\DoxyCodeLine{01425         \{}
\DoxyCodeLine{01426            \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01427         \}}
\DoxyCodeLine{01428 }
\DoxyCodeLine{01429         \textcolor{keywordflow}{if} (header-\/>flags \& DDS\_HEADER\_FLAGS\_VOLUME)}
\DoxyCodeLine{01430         \{}
\DoxyCodeLine{01431             resDim = D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D;}
\DoxyCodeLine{01432         \}}
\DoxyCodeLine{01433         \textcolor{keywordflow}{else} }
\DoxyCodeLine{01434         \{}
\DoxyCodeLine{01435             \textcolor{keywordflow}{if} (header-\/>caps2 \& DDS\_CUBEMAP)}
\DoxyCodeLine{01436             \{}
\DoxyCodeLine{01437                 \textcolor{comment}{// We require all six faces to be defined}}
\DoxyCodeLine{01438                 \textcolor{keywordflow}{if} ((header-\/>caps2 \& DDS\_CUBEMAP\_ALLFACES ) != DDS\_CUBEMAP\_ALLFACES)}
\DoxyCodeLine{01439                 \{}
\DoxyCodeLine{01440                     \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01441                 \}}
\DoxyCodeLine{01442 }
\DoxyCodeLine{01443                 arraySize = 6;}
\DoxyCodeLine{01444                 isCubeMap = \textcolor{keyword}{true};}
\DoxyCodeLine{01445             \}}
\DoxyCodeLine{01446 }
\DoxyCodeLine{01447             depth = 1;}
\DoxyCodeLine{01448             resDim = D3D11\_RESOURCE\_DIMENSION\_TEXTURE2D;}
\DoxyCodeLine{01449 }
\DoxyCodeLine{01450             \textcolor{comment}{// Note there's no way for a legacy Direct3D 9 DDS to express a '1D' texture}}
\DoxyCodeLine{01451         \}}
\DoxyCodeLine{01452 }
\DoxyCodeLine{01453         assert( BitsPerPixel( format ) != 0 );}
\DoxyCodeLine{01454     \}}
\DoxyCodeLine{01455 }
\DoxyCodeLine{01456     \textcolor{comment}{// Bound sizes (for security purposes we don't trust DDS file metadata larger than the D3D 11.x hardware requirements)}}
\DoxyCodeLine{01457     \textcolor{keywordflow}{if} (mipCount > D3D11\_REQ\_MIP\_LEVELS)}
\DoxyCodeLine{01458     \{}
\DoxyCodeLine{01459         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01460     \}}
\DoxyCodeLine{01461 }
\DoxyCodeLine{01462     \textcolor{keywordflow}{switch} ( resDim )}
\DoxyCodeLine{01463     \{}
\DoxyCodeLine{01464     \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE1D:}
\DoxyCodeLine{01465         \textcolor{keywordflow}{if} ((arraySize > D3D11\_REQ\_TEXTURE1D\_ARRAY\_AXIS\_DIMENSION) ||}
\DoxyCodeLine{01466             (width > D3D11\_REQ\_TEXTURE1D\_U\_DIMENSION) )}
\DoxyCodeLine{01467         \{}
\DoxyCodeLine{01468             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01469         \}}
\DoxyCodeLine{01470         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01471 }
\DoxyCodeLine{01472     \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE2D:}
\DoxyCodeLine{01473         \textcolor{keywordflow}{if} ( isCubeMap )}
\DoxyCodeLine{01474         \{}
\DoxyCodeLine{01475             \textcolor{comment}{// This is the right bound because we set arraySize to (NumCubes*6) above}}
\DoxyCodeLine{01476             \textcolor{keywordflow}{if} ((arraySize > D3D11\_REQ\_TEXTURE2D\_ARRAY\_AXIS\_DIMENSION) ||}
\DoxyCodeLine{01477                 (width > D3D11\_REQ\_TEXTURECUBE\_DIMENSION) ||}
\DoxyCodeLine{01478                 (height > D3D11\_REQ\_TEXTURECUBE\_DIMENSION))}
\DoxyCodeLine{01479             \{}
\DoxyCodeLine{01480                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01481             \}}
\DoxyCodeLine{01482         \}}
\DoxyCodeLine{01483         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((arraySize > D3D11\_REQ\_TEXTURE2D\_ARRAY\_AXIS\_DIMENSION) ||}
\DoxyCodeLine{01484                     (width > D3D11\_REQ\_TEXTURE2D\_U\_OR\_V\_DIMENSION) ||}
\DoxyCodeLine{01485                     (height > D3D11\_REQ\_TEXTURE2D\_U\_OR\_V\_DIMENSION))}
\DoxyCodeLine{01486         \{}
\DoxyCodeLine{01487             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01488         \}}
\DoxyCodeLine{01489         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01490 }
\DoxyCodeLine{01491     \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D:}
\DoxyCodeLine{01492         \textcolor{keywordflow}{if} ((arraySize > 1) ||}
\DoxyCodeLine{01493             (width > D3D11\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION) ||}
\DoxyCodeLine{01494             (height > D3D11\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION) ||}
\DoxyCodeLine{01495             (depth > D3D11\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION) )}
\DoxyCodeLine{01496         \{}
\DoxyCodeLine{01497             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01498         \}}
\DoxyCodeLine{01499         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01500 }
\DoxyCodeLine{01501     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01502         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_NOT\_SUPPORTED );}
\DoxyCodeLine{01503     \}}
\DoxyCodeLine{01504 }
\DoxyCodeLine{01505     \textcolor{keywordtype}{bool} autogen = \textcolor{keyword}{false};}
\DoxyCodeLine{01506     \textcolor{keywordflow}{if} ( mipCount == 1 \&\& d3dContext != 0 \&\& textureView != 0 ) \textcolor{comment}{// Must have context and shader-\/view to auto generate mipmaps}}
\DoxyCodeLine{01507     \{}
\DoxyCodeLine{01508         \textcolor{comment}{// See if format is supported for auto-\/gen mipmaps (varies by feature level)}}
\DoxyCodeLine{01509         UINT fmtSupport = 0;}
\DoxyCodeLine{01510         hr = d3dDevice-\/>CheckFormatSupport( format, \&fmtSupport );}
\DoxyCodeLine{01511         \textcolor{keywordflow}{if} ( SUCCEEDED(hr) \&\& ( fmtSupport \& D3D11\_FORMAT\_SUPPORT\_MIP\_AUTOGEN ) )}
\DoxyCodeLine{01512         \{}
\DoxyCodeLine{01513             \textcolor{comment}{// 10level9 feature levels do not support auto-\/gen mipgen for volume textures}}
\DoxyCodeLine{01514             \textcolor{keywordflow}{if} ( ( resDim != D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D )}
\DoxyCodeLine{01515                  || ( d3dDevice-\/>GetFeatureLevel() >= D3D\_FEATURE\_LEVEL\_10\_0 ) )}
\DoxyCodeLine{01516             \{}
\DoxyCodeLine{01517                 autogen = \textcolor{keyword}{true};}
\DoxyCodeLine{01518             \}}
\DoxyCodeLine{01519         \}}
\DoxyCodeLine{01520     \}}
\DoxyCodeLine{01521 }
\DoxyCodeLine{01522     \textcolor{keywordflow}{if} ( autogen )}
\DoxyCodeLine{01523     \{}
\DoxyCodeLine{01524         \textcolor{comment}{// Create texture with auto-\/generated mipmaps}}
\DoxyCodeLine{01525         ID3D11Resource* tex = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01526         hr = CreateD3DResources( d3dDevice, resDim, width, height, depth, 0, arraySize,}
\DoxyCodeLine{01527                                  format, usage,}
\DoxyCodeLine{01528                                  bindFlags | D3D11\_BIND\_RENDER\_TARGET,}
\DoxyCodeLine{01529                                  cpuAccessFlags,}
\DoxyCodeLine{01530                                  miscFlags | D3D11\_RESOURCE\_MISC\_GENERATE\_MIPS, forceSRGB,}
\DoxyCodeLine{01531                                  isCubeMap, \textcolor{keyword}{nullptr}, \&tex, textureView );}
\DoxyCodeLine{01532         \textcolor{keywordflow}{if} ( SUCCEEDED(hr) )}
\DoxyCodeLine{01533         \{}
\DoxyCodeLine{01534             \textcolor{keywordtype}{size\_t} numBytes = 0;}
\DoxyCodeLine{01535             \textcolor{keywordtype}{size\_t} rowBytes = 0;}
\DoxyCodeLine{01536             GetSurfaceInfo( width, height, format, \&numBytes, \&rowBytes, \textcolor{keyword}{nullptr} );}
\DoxyCodeLine{01537 }
\DoxyCodeLine{01538             \textcolor{keywordflow}{if} ( numBytes > bitSize )}
\DoxyCodeLine{01539             \{}
\DoxyCodeLine{01540                 (*textureView)-\/>Release();}
\DoxyCodeLine{01541                 *textureView = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01542                 tex-\/>Release();}
\DoxyCodeLine{01543                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_HANDLE\_EOF );}
\DoxyCodeLine{01544             \}}
\DoxyCodeLine{01545 }
\DoxyCodeLine{01546             D3D11\_SHADER\_RESOURCE\_VIEW\_DESC desc;}
\DoxyCodeLine{01547             (*textureView)-\/>GetDesc( \&desc );}
\DoxyCodeLine{01548 }
\DoxyCodeLine{01549             UINT mipLevels = 1;}
\DoxyCodeLine{01550 }
\DoxyCodeLine{01551             \textcolor{keywordflow}{switch}( desc.ViewDimension )}
\DoxyCodeLine{01552             \{}
\DoxyCodeLine{01553             \textcolor{keywordflow}{case} D3D\_SRV\_DIMENSION\_TEXTURE1D:       mipLevels = desc.Texture1D.MipLevels; \textcolor{keywordflow}{break};}
\DoxyCodeLine{01554             \textcolor{keywordflow}{case} D3D\_SRV\_DIMENSION\_TEXTURE1DARRAY:  mipLevels = desc.Texture1DArray.MipLevels; \textcolor{keywordflow}{break};}
\DoxyCodeLine{01555             \textcolor{keywordflow}{case} D3D\_SRV\_DIMENSION\_TEXTURE2D:       mipLevels = desc.Texture2D.MipLevels; \textcolor{keywordflow}{break};}
\DoxyCodeLine{01556             \textcolor{keywordflow}{case} D3D\_SRV\_DIMENSION\_TEXTURE2DARRAY:  mipLevels = desc.Texture2DArray.MipLevels; \textcolor{keywordflow}{break};}
\DoxyCodeLine{01557             \textcolor{keywordflow}{case} D3D\_SRV\_DIMENSION\_TEXTURECUBE:     mipLevels = desc.TextureCube.MipLevels; \textcolor{keywordflow}{break};}
\DoxyCodeLine{01558             \textcolor{keywordflow}{case} D3D\_SRV\_DIMENSION\_TEXTURECUBEARRAY:mipLevels = desc.TextureCubeArray.MipLevels; \textcolor{keywordflow}{break};}
\DoxyCodeLine{01559             \textcolor{keywordflow}{case} D3D\_SRV\_DIMENSION\_TEXTURE3D:       mipLevels = desc.Texture3D.MipLevels; \textcolor{keywordflow}{break};}
\DoxyCodeLine{01560             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01561                 (*textureView)-\/>Release();}
\DoxyCodeLine{01562                 *textureView = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01563                 tex-\/>Release();}
\DoxyCodeLine{01564                 \textcolor{keywordflow}{return} E\_UNEXPECTED;}
\DoxyCodeLine{01565             \}}
\DoxyCodeLine{01566 }
\DoxyCodeLine{01567             \textcolor{keywordflow}{if} ( arraySize > 1 )}
\DoxyCodeLine{01568             \{}
\DoxyCodeLine{01569                 \textcolor{keyword}{const} uint8\_t* pSrcBits = bitData;}
\DoxyCodeLine{01570                 \textcolor{keyword}{const} uint8\_t* pEndBits = bitData + bitSize;}
\DoxyCodeLine{01571                 \textcolor{keywordflow}{for}( UINT item = 0; item < arraySize; ++item )}
\DoxyCodeLine{01572                 \{}
\DoxyCodeLine{01573                     \textcolor{keywordflow}{if} ( (pSrcBits + numBytes) > pEndBits )}
\DoxyCodeLine{01574                     \{}
\DoxyCodeLine{01575                         (*textureView)-\/>Release();}
\DoxyCodeLine{01576                         *textureView = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01577                         tex-\/>Release();}
\DoxyCodeLine{01578                         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32( ERROR\_HANDLE\_EOF );}
\DoxyCodeLine{01579                     \}}
\DoxyCodeLine{01580 }
\DoxyCodeLine{01581                     UINT res = D3D11CalcSubresource( 0, item, mipLevels );}
\DoxyCodeLine{01582                     d3dContext-\/>UpdateSubresource( tex, res, \textcolor{keyword}{nullptr}, pSrcBits, \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}(rowBytes), \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}(numBytes) );}
\DoxyCodeLine{01583                     pSrcBits += numBytes;}
\DoxyCodeLine{01584                 \}}
\DoxyCodeLine{01585             \}}
\DoxyCodeLine{01586             \textcolor{keywordflow}{else}}
\DoxyCodeLine{01587             \{}
\DoxyCodeLine{01588                 d3dContext-\/>UpdateSubresource( tex, 0, \textcolor{keyword}{nullptr}, bitData, \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}(rowBytes), \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}(numBytes) );}
\DoxyCodeLine{01589             \}}
\DoxyCodeLine{01590 }
\DoxyCodeLine{01591             d3dContext-\/>GenerateMips( *textureView );}
\DoxyCodeLine{01592 }
\DoxyCodeLine{01593             \textcolor{keywordflow}{if} ( texture )}
\DoxyCodeLine{01594             \{}
\DoxyCodeLine{01595                 *texture = tex;}
\DoxyCodeLine{01596             \}}
\DoxyCodeLine{01597             \textcolor{keywordflow}{else}}
\DoxyCodeLine{01598             \{}
\DoxyCodeLine{01599                 tex-\/>Release();}
\DoxyCodeLine{01600             \}}
\DoxyCodeLine{01601         \}}
\DoxyCodeLine{01602     \}}
\DoxyCodeLine{01603     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01604     \{}
\DoxyCodeLine{01605         \textcolor{comment}{// Create the texture}}
\DoxyCodeLine{01606         std::unique\_ptr<D3D11\_SUBRESOURCE\_DATA[]> initData( \textcolor{keyword}{new} (std::nothrow) D3D11\_SUBRESOURCE\_DATA[ mipCount * arraySize ] );}
\DoxyCodeLine{01607         \textcolor{keywordflow}{if} ( !initData )}
\DoxyCodeLine{01608         \{}
\DoxyCodeLine{01609             \textcolor{keywordflow}{return} E\_OUTOFMEMORY;}
\DoxyCodeLine{01610         \}}
\DoxyCodeLine{01611 }
\DoxyCodeLine{01612         \textcolor{keywordtype}{size\_t} skipMip = 0;}
\DoxyCodeLine{01613         \textcolor{keywordtype}{size\_t} twidth = 0;}
\DoxyCodeLine{01614         \textcolor{keywordtype}{size\_t} theight = 0;}
\DoxyCodeLine{01615         \textcolor{keywordtype}{size\_t} tdepth = 0;}
\DoxyCodeLine{01616         hr = FillInitData( width, height, depth, mipCount, arraySize, format, maxsize, bitSize, bitData,}
\DoxyCodeLine{01617                            twidth, theight, tdepth, skipMip, initData.get() );}
\DoxyCodeLine{01618 }
\DoxyCodeLine{01619         \textcolor{keywordflow}{if} ( SUCCEEDED(hr) )}
\DoxyCodeLine{01620         \{}
\DoxyCodeLine{01621             hr = CreateD3DResources( d3dDevice, resDim, twidth, theight, tdepth, mipCount -\/ skipMip, arraySize,}
\DoxyCodeLine{01622                                      format, usage, bindFlags, cpuAccessFlags, miscFlags, forceSRGB,}
\DoxyCodeLine{01623                                      isCubeMap, initData.get(), texture, textureView );}
\DoxyCodeLine{01624 }
\DoxyCodeLine{01625             \textcolor{keywordflow}{if} ( FAILED(hr) \&\& !maxsize \&\& (mipCount > 1) )}
\DoxyCodeLine{01626             \{}
\DoxyCodeLine{01627                 \textcolor{comment}{// Retry with a maxsize determined by feature level}}
\DoxyCodeLine{01628                 \textcolor{keywordflow}{switch}( d3dDevice-\/>GetFeatureLevel() )}
\DoxyCodeLine{01629                 \{}
\DoxyCodeLine{01630                 \textcolor{keywordflow}{case} D3D\_FEATURE\_LEVEL\_9\_1:}
\DoxyCodeLine{01631                 \textcolor{keywordflow}{case} D3D\_FEATURE\_LEVEL\_9\_2:}
\DoxyCodeLine{01632                     \textcolor{keywordflow}{if} ( isCubeMap )}
\DoxyCodeLine{01633                     \{}
\DoxyCodeLine{01634                         maxsize = 512 \textcolor{comment}{/*D3D\_FL9\_1\_REQ\_TEXTURECUBE\_DIMENSION*/};}
\DoxyCodeLine{01635                     \}}
\DoxyCodeLine{01636                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01637                     \{}
\DoxyCodeLine{01638                         maxsize = (resDim == D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D)}
\DoxyCodeLine{01639                                   ? 256 \textcolor{comment}{/*D3D\_FL9\_1\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION*/}}
\DoxyCodeLine{01640                                   : 2048 \textcolor{comment}{/*D3D\_FL9\_1\_REQ\_TEXTURE2D\_U\_OR\_V\_DIMENSION*/};}
\DoxyCodeLine{01641                     \}}
\DoxyCodeLine{01642                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01643 }
\DoxyCodeLine{01644                 \textcolor{keywordflow}{case} D3D\_FEATURE\_LEVEL\_9\_3:}
\DoxyCodeLine{01645                     maxsize = (resDim == D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D)}
\DoxyCodeLine{01646                               ? 256 \textcolor{comment}{/*D3D\_FL9\_1\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION*/}}
\DoxyCodeLine{01647                               : 4096 \textcolor{comment}{/*D3D\_FL9\_3\_REQ\_TEXTURE2D\_U\_OR\_V\_DIMENSION*/};}
\DoxyCodeLine{01648                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01649 }
\DoxyCodeLine{01650                 \textcolor{keywordflow}{default}: \textcolor{comment}{// D3D\_FEATURE\_LEVEL\_10\_0 \& D3D\_FEATURE\_LEVEL\_10\_1}}
\DoxyCodeLine{01651                     maxsize = (resDim == D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D)}
\DoxyCodeLine{01652                               ? 2048 \textcolor{comment}{/*D3D10\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION*/}}
\DoxyCodeLine{01653                               : 8192 \textcolor{comment}{/*D3D10\_REQ\_TEXTURE2D\_U\_OR\_V\_DIMENSION*/};}
\DoxyCodeLine{01654                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{01655                 \}}
\DoxyCodeLine{01656 }
\DoxyCodeLine{01657                 hr = FillInitData( width, height, depth, mipCount, arraySize, format, maxsize, bitSize, bitData,}
\DoxyCodeLine{01658                                    twidth, theight, tdepth, skipMip, initData.get() );}
\DoxyCodeLine{01659                 \textcolor{keywordflow}{if} ( SUCCEEDED(hr) )}
\DoxyCodeLine{01660                 \{}
\DoxyCodeLine{01661                     hr = CreateD3DResources( d3dDevice, resDim, twidth, theight, tdepth, mipCount -\/ skipMip, arraySize,}
\DoxyCodeLine{01662                                              format, usage, bindFlags, cpuAccessFlags, miscFlags, forceSRGB,}
\DoxyCodeLine{01663                                              isCubeMap, initData.get(), texture, textureView );}
\DoxyCodeLine{01664                 \}}
\DoxyCodeLine{01665             \}}
\DoxyCodeLine{01666         \}}
\DoxyCodeLine{01667     \}}
\DoxyCodeLine{01668 }
\DoxyCodeLine{01669     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01670 \}}
\DoxyCodeLine{01671 }
\DoxyCodeLine{01672 \textcolor{keyword}{static} HRESULT CreateTextureFromDDS12(}
\DoxyCodeLine{01673     \_In\_ ID3D12Device* device,}
\DoxyCodeLine{01674     \_In\_opt\_ ID3D12GraphicsCommandList* cmdList,}
\DoxyCodeLine{01675     \_In\_ \textcolor{keyword}{const} DDS\_HEADER* header,}
\DoxyCodeLine{01676     \_In\_reads\_bytes\_(bitSize) \textcolor{keyword}{const} uint8\_t* bitData,}
\DoxyCodeLine{01677     \_In\_ \textcolor{keywordtype}{size\_t} bitSize,}
\DoxyCodeLine{01678     \_In\_ \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{01679     \_In\_ \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{01680     ComPtr<ID3D12Resource>\& texture,}
\DoxyCodeLine{01681     ComPtr<ID3D12Resource>\& textureUploadHeap)}
\DoxyCodeLine{01682 \{}
\DoxyCodeLine{01683     HRESULT hr = S\_OK;}
\DoxyCodeLine{01684 }
\DoxyCodeLine{01685     UINT width = header-\/>width;}
\DoxyCodeLine{01686     UINT height = header-\/>height;}
\DoxyCodeLine{01687     UINT depth = header-\/>depth;}
\DoxyCodeLine{01688 }
\DoxyCodeLine{01689     uint32\_t resDim = D3D12\_RESOURCE\_DIMENSION\_UNKNOWN;}
\DoxyCodeLine{01690     UINT arraySize = 1;}
\DoxyCodeLine{01691     DXGI\_FORMAT format = DXGI\_FORMAT\_UNKNOWN;}
\DoxyCodeLine{01692     \textcolor{keywordtype}{bool} isCubeMap = \textcolor{keyword}{false};}
\DoxyCodeLine{01693 }
\DoxyCodeLine{01694     \textcolor{keywordtype}{size\_t} mipCount = header-\/>mipMapCount;}
\DoxyCodeLine{01695     \textcolor{keywordflow}{if} (0 == mipCount) mipCount = 1;}
\DoxyCodeLine{01696 }
\DoxyCodeLine{01697     \textcolor{keywordflow}{if} ((header-\/>ddspf.flags \& DDS\_FOURCC) \&\& (MAKEFOURCC(\textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'1'}, \textcolor{charliteral}{'0'}) == header-\/>ddspf.fourCC))}
\DoxyCodeLine{01698     \{}
\DoxyCodeLine{01699         \textcolor{keyword}{auto} d3d10ext = \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }DDS\_HEADER\_DXT10*\textcolor{keyword}{>}((\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)header + \textcolor{keyword}{sizeof}(DDS\_HEADER));}
\DoxyCodeLine{01700 }
\DoxyCodeLine{01701         arraySize = d3d10ext-\/>arraySize;}
\DoxyCodeLine{01702         \textcolor{keywordflow}{if} (arraySize == 0)}
\DoxyCodeLine{01703             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_INVALID\_DATA);}
\DoxyCodeLine{01704 }
\DoxyCodeLine{01705         \textcolor{keywordflow}{switch} (d3d10ext-\/>dxgiFormat)}
\DoxyCodeLine{01706         \{}
\DoxyCodeLine{01707         \textcolor{keywordflow}{case} DXGI\_FORMAT\_AI44:}
\DoxyCodeLine{01708         \textcolor{keywordflow}{case} DXGI\_FORMAT\_IA44:}
\DoxyCodeLine{01709         \textcolor{keywordflow}{case} DXGI\_FORMAT\_P8:}
\DoxyCodeLine{01710         \textcolor{keywordflow}{case} DXGI\_FORMAT\_A8P8:}
\DoxyCodeLine{01711             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01712 }
\DoxyCodeLine{01713         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01714             \textcolor{keywordflow}{if} (BitsPerPixel(d3d10ext-\/>dxgiFormat) == 0)}
\DoxyCodeLine{01715                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01716         \}}
\DoxyCodeLine{01717 }
\DoxyCodeLine{01718         format = d3d10ext-\/>dxgiFormat;}
\DoxyCodeLine{01719 }
\DoxyCodeLine{01720         \textcolor{keywordflow}{switch} (d3d10ext-\/>resourceDimension)}
\DoxyCodeLine{01721         \{}
\DoxyCodeLine{01722         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE1D:}
\DoxyCodeLine{01723             \textcolor{keywordflow}{if} ((header-\/>flags \& DDS\_HEIGHT) \&\& height != 1)}
\DoxyCodeLine{01724                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_INVALID\_DATA);}
\DoxyCodeLine{01725             height = depth = 1;}
\DoxyCodeLine{01726             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01727 }
\DoxyCodeLine{01728         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE2D:}
\DoxyCodeLine{01729             \textcolor{keywordflow}{if} (d3d10ext-\/>miscFlag \& D3D11\_RESOURCE\_MISC\_TEXTURECUBE)}
\DoxyCodeLine{01730             \{}
\DoxyCodeLine{01731                 arraySize *= 6;}
\DoxyCodeLine{01732                 isCubeMap = \textcolor{keyword}{true};}
\DoxyCodeLine{01733             \}}
\DoxyCodeLine{01734             depth = 1;}
\DoxyCodeLine{01735             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01736 }
\DoxyCodeLine{01737         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D:}
\DoxyCodeLine{01738             \textcolor{keywordflow}{if} (!(header-\/>flags \& DDS\_HEADER\_FLAGS\_VOLUME))}
\DoxyCodeLine{01739                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_INVALID\_DATA);}
\DoxyCodeLine{01740             \textcolor{keywordflow}{if} (arraySize > 1)}
\DoxyCodeLine{01741                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01742             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01743 }
\DoxyCodeLine{01744         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01745             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01746         \}}
\DoxyCodeLine{01747 }
\DoxyCodeLine{01748         \textcolor{keywordflow}{switch} (d3d10ext-\/>resourceDimension)}
\DoxyCodeLine{01749         \{}
\DoxyCodeLine{01750         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE1D:}
\DoxyCodeLine{01751             resDim = D3D12\_RESOURCE\_DIMENSION\_TEXTURE1D;}
\DoxyCodeLine{01752             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01753         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE2D:}
\DoxyCodeLine{01754             resDim = D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D;}
\DoxyCodeLine{01755             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01756         \textcolor{keywordflow}{case} D3D11\_RESOURCE\_DIMENSION\_TEXTURE3D:}
\DoxyCodeLine{01757             resDim = D3D12\_RESOURCE\_DIMENSION\_TEXTURE3D;}
\DoxyCodeLine{01758             \textcolor{keywordflow}{break};}
\DoxyCodeLine{01759         \}}
\DoxyCodeLine{01760     \}}
\DoxyCodeLine{01761     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01762     \{}
\DoxyCodeLine{01763         format = GetDXGIFormat(header-\/>ddspf);}
\DoxyCodeLine{01764 }
\DoxyCodeLine{01765         \textcolor{keywordflow}{if} (format == DXGI\_FORMAT\_UNKNOWN)}
\DoxyCodeLine{01766             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01767 }
\DoxyCodeLine{01768         \textcolor{keywordflow}{if} (header-\/>flags \& DDS\_HEADER\_FLAGS\_VOLUME)}
\DoxyCodeLine{01769         \{}
\DoxyCodeLine{01770             resDim = D3D12\_RESOURCE\_DIMENSION\_TEXTURE3D;}
\DoxyCodeLine{01771         \}}
\DoxyCodeLine{01772         \textcolor{keywordflow}{else}}
\DoxyCodeLine{01773         \{}
\DoxyCodeLine{01774             \textcolor{keywordflow}{if} (header-\/>caps2 \& DDS\_CUBEMAP)}
\DoxyCodeLine{01775             \{}
\DoxyCodeLine{01776                 \textcolor{keywordflow}{if} ((header-\/>caps2 \& DDS\_CUBEMAP\_ALLFACES) != DDS\_CUBEMAP\_ALLFACES)}
\DoxyCodeLine{01777                     \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01778                 arraySize = 6;}
\DoxyCodeLine{01779                 isCubeMap = \textcolor{keyword}{true};}
\DoxyCodeLine{01780             \}}
\DoxyCodeLine{01781 }
\DoxyCodeLine{01782             depth = 1;}
\DoxyCodeLine{01783             resDim = D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D;}
\DoxyCodeLine{01784         \}}
\DoxyCodeLine{01785 }
\DoxyCodeLine{01786         assert(BitsPerPixel(format) != 0);}
\DoxyCodeLine{01787     \}}
\DoxyCodeLine{01788 }
\DoxyCodeLine{01789     \textcolor{comment}{// Bound sizes (for security purposes we don't trust DDS file metadata larger than the D3D 11.x hardware requirements)}}
\DoxyCodeLine{01790     \textcolor{keywordflow}{if} (mipCount > D3D12\_REQ\_MIP\_LEVELS)}
\DoxyCodeLine{01791     \{}
\DoxyCodeLine{01792         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01793     \}}
\DoxyCodeLine{01794 }
\DoxyCodeLine{01795     \textcolor{keywordflow}{switch} (resDim)}
\DoxyCodeLine{01796     \{}
\DoxyCodeLine{01797     \textcolor{keywordflow}{case} D3D12\_RESOURCE\_DIMENSION\_TEXTURE1D:}
\DoxyCodeLine{01798         \textcolor{keywordflow}{if} ((arraySize > D3D12\_REQ\_TEXTURE1D\_ARRAY\_AXIS\_DIMENSION) ||}
\DoxyCodeLine{01799             (width > D3D12\_REQ\_TEXTURE1D\_U\_DIMENSION))}
\DoxyCodeLine{01800         \{}
\DoxyCodeLine{01801             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01802         \}}
\DoxyCodeLine{01803         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01804 }
\DoxyCodeLine{01805     \textcolor{keywordflow}{case} D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D:}
\DoxyCodeLine{01806         \textcolor{keywordflow}{if} (isCubeMap)}
\DoxyCodeLine{01807         \{}
\DoxyCodeLine{01808             \textcolor{comment}{// This is the right bound because we set arraySize to (NumCubes*6) above}}
\DoxyCodeLine{01809             \textcolor{keywordflow}{if} ((arraySize > D3D12\_REQ\_TEXTURE2D\_ARRAY\_AXIS\_DIMENSION) ||}
\DoxyCodeLine{01810                 (width > D3D12\_REQ\_TEXTURECUBE\_DIMENSION) ||}
\DoxyCodeLine{01811                 (height > D3D12\_REQ\_TEXTURECUBE\_DIMENSION))}
\DoxyCodeLine{01812             \{}
\DoxyCodeLine{01813                 \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01814             \}}
\DoxyCodeLine{01815         \}}
\DoxyCodeLine{01816         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((arraySize > D3D12\_REQ\_TEXTURE2D\_ARRAY\_AXIS\_DIMENSION) ||}
\DoxyCodeLine{01817             (width > D3D12\_REQ\_TEXTURE2D\_U\_OR\_V\_DIMENSION) ||}
\DoxyCodeLine{01818             (height > D3D12\_REQ\_TEXTURE2D\_U\_OR\_V\_DIMENSION))}
\DoxyCodeLine{01819         \{}
\DoxyCodeLine{01820             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01821         \}}
\DoxyCodeLine{01822         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01823 }
\DoxyCodeLine{01824     \textcolor{keywordflow}{case} D3D12\_RESOURCE\_DIMENSION\_TEXTURE3D:}
\DoxyCodeLine{01825         \textcolor{keywordflow}{if} ((arraySize > 1) ||}
\DoxyCodeLine{01826             (width > D3D12\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION) ||}
\DoxyCodeLine{01827             (height > D3D12\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION) ||}
\DoxyCodeLine{01828             (depth > D3D12\_REQ\_TEXTURE3D\_U\_V\_OR\_W\_DIMENSION))}
\DoxyCodeLine{01829         \{}
\DoxyCodeLine{01830             \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01831         \}}
\DoxyCodeLine{01832         \textcolor{keywordflow}{break};}
\DoxyCodeLine{01833 }
\DoxyCodeLine{01834     \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01835         \textcolor{keywordflow}{return} HRESULT\_FROM\_WIN32(ERROR\_NOT\_SUPPORTED);}
\DoxyCodeLine{01836     \}}
\DoxyCodeLine{01837 }
\DoxyCodeLine{01838     \textcolor{comment}{// Create the texture}}
\DoxyCodeLine{01839     std::unique\_ptr<D3D12\_SUBRESOURCE\_DATA[]> initData(}
\DoxyCodeLine{01840         \textcolor{keyword}{new} (std::nothrow) D3D12\_SUBRESOURCE\_DATA[mipCount * arraySize]}
\DoxyCodeLine{01841         );}
\DoxyCodeLine{01842 }
\DoxyCodeLine{01843     \textcolor{keywordflow}{if} (!initData)}
\DoxyCodeLine{01844     \{}
\DoxyCodeLine{01845         \textcolor{keywordflow}{return} E\_OUTOFMEMORY;}
\DoxyCodeLine{01846     \}}
\DoxyCodeLine{01847 }
\DoxyCodeLine{01848     \textcolor{keywordtype}{size\_t} skipMip = 0;}
\DoxyCodeLine{01849     \textcolor{keywordtype}{size\_t} twidth = 0;}
\DoxyCodeLine{01850     \textcolor{keywordtype}{size\_t} theight = 0;}
\DoxyCodeLine{01851     \textcolor{keywordtype}{size\_t} tdepth = 0;}
\DoxyCodeLine{01852 }
\DoxyCodeLine{01853     hr = FillInitData12(}
\DoxyCodeLine{01854         width, height, depth, mipCount, arraySize, format, maxsize, bitSize, bitData,}
\DoxyCodeLine{01855         twidth, theight, tdepth, skipMip, initData.get()}
\DoxyCodeLine{01856         );}
\DoxyCodeLine{01857 }
\DoxyCodeLine{01858     \textcolor{keywordflow}{if} (SUCCEEDED(hr))}
\DoxyCodeLine{01859     \{}
\DoxyCodeLine{01860         hr = CreateD3DResources12(}
\DoxyCodeLine{01861             device, cmdList,}
\DoxyCodeLine{01862             resDim, twidth, theight, tdepth,}
\DoxyCodeLine{01863             mipCount -\/ skipMip,}
\DoxyCodeLine{01864             arraySize,}
\DoxyCodeLine{01865             format,}
\DoxyCodeLine{01866             \textcolor{keyword}{false}, \textcolor{comment}{// forceSRGB}}
\DoxyCodeLine{01867             isCubeMap,}
\DoxyCodeLine{01868             initData.get(),}
\DoxyCodeLine{01869             texture, }
\DoxyCodeLine{01870             textureUploadHeap);}
\DoxyCodeLine{01871     \}}
\DoxyCodeLine{01872 }
\DoxyCodeLine{01873     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01874 \}}
\DoxyCodeLine{01875 }
\DoxyCodeLine{01876 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01877 \textcolor{keyword}{static} DDS\_ALPHA\_MODE GetAlphaMode( \_In\_ \textcolor{keyword}{const} DDS\_HEADER* header )}
\DoxyCodeLine{01878 \{}
\DoxyCodeLine{01879     \textcolor{keywordflow}{if} ( header-\/>ddspf.flags \& DDS\_FOURCC )}
\DoxyCodeLine{01880     \{}
\DoxyCodeLine{01881         \textcolor{keywordflow}{if} ( MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'1'}, \textcolor{charliteral}{'0'} ) == header-\/>ddspf.fourCC )}
\DoxyCodeLine{01882         \{}
\DoxyCodeLine{01883             \textcolor{keyword}{auto} d3d10ext = \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }DDS\_HEADER\_DXT10*\textcolor{keyword}{>}( (\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)header + \textcolor{keyword}{sizeof}(DDS\_HEADER) );}
\DoxyCodeLine{01884             \textcolor{keyword}{auto} mode = \textcolor{keyword}{static\_cast<}DDS\_ALPHA\_MODE\textcolor{keyword}{>}( d3d10ext-\/>miscFlags2 \& DDS\_MISC\_FLAGS2\_ALPHA\_MODE\_MASK );}
\DoxyCodeLine{01885             \textcolor{keywordflow}{switch}( mode )}
\DoxyCodeLine{01886             \{}
\DoxyCodeLine{01887             \textcolor{keywordflow}{case} DDS\_ALPHA\_MODE\_STRAIGHT:}
\DoxyCodeLine{01888             \textcolor{keywordflow}{case} DDS\_ALPHA\_MODE\_PREMULTIPLIED:}
\DoxyCodeLine{01889             \textcolor{keywordflow}{case} DDS\_ALPHA\_MODE\_OPAQUE:}
\DoxyCodeLine{01890             \textcolor{keywordflow}{case} DDS\_ALPHA\_MODE\_CUSTOM:}
\DoxyCodeLine{01891                 \textcolor{keywordflow}{return} mode;}
\DoxyCodeLine{01892             \}}
\DoxyCodeLine{01893         \}}
\DoxyCodeLine{01894         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( ( MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'2'} ) == header-\/>ddspf.fourCC )}
\DoxyCodeLine{01895                   || ( MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'T'}, \textcolor{charliteral}{'4'} ) == header-\/>ddspf.fourCC ) )}
\DoxyCodeLine{01896         \{}
\DoxyCodeLine{01897             \textcolor{keywordflow}{return} DDS\_ALPHA\_MODE\_PREMULTIPLIED;}
\DoxyCodeLine{01898         \}}
\DoxyCodeLine{01899     \}}
\DoxyCodeLine{01900 }
\DoxyCodeLine{01901     \textcolor{keywordflow}{return} DDS\_ALPHA\_MODE\_UNKNOWN;}
\DoxyCodeLine{01902 \}}
\DoxyCodeLine{01903 }
\DoxyCodeLine{01904 }
\DoxyCodeLine{01905 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01906 \_Use\_decl\_annotations\_}
\DoxyCodeLine{01907 HRESULT DirectX::CreateDDSTextureFromMemory( ID3D11Device* d3dDevice,}
\DoxyCodeLine{01908                                              \textcolor{keyword}{const} uint8\_t* ddsData,}
\DoxyCodeLine{01909                                              \textcolor{keywordtype}{size\_t} ddsDataSize,}
\DoxyCodeLine{01910                                              ID3D11Resource** texture,}
\DoxyCodeLine{01911                                              ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{01912                                              \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{01913                                              DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{01914 \{}
\DoxyCodeLine{01915     \textcolor{keywordflow}{return} CreateDDSTextureFromMemoryEx( d3dDevice, \textcolor{keyword}{nullptr}, ddsData, ddsDataSize, maxsize,}
\DoxyCodeLine{01916                                          D3D11\_USAGE\_DEFAULT, D3D11\_BIND\_SHADER\_RESOURCE, 0, 0, \textcolor{keyword}{false},}
\DoxyCodeLine{01917                                          texture, textureView, alphaMode );}
\DoxyCodeLine{01918 \}}
\DoxyCodeLine{01919 }
\DoxyCodeLine{01920 \_Use\_decl\_annotations\_}
\DoxyCodeLine{01921 HRESULT DirectX::CreateDDSTextureFromMemory12(}
\DoxyCodeLine{01922     ID3D12Device* device,}
\DoxyCodeLine{01923     \_In\_ ID3D12GraphicsCommandList* cmdList,}
\DoxyCodeLine{01924     \_In\_reads\_bytes\_(ddsDataSize) \textcolor{keyword}{const} uint8\_t* ddsData,}
\DoxyCodeLine{01925     \_In\_ \textcolor{keywordtype}{size\_t} ddsDataSize,}
\DoxyCodeLine{01926     ComPtr<ID3D12Resource>\& texture,}
\DoxyCodeLine{01927     ComPtr<ID3D12Resource>\& textureUploadHeap,}
\DoxyCodeLine{01928     \_In\_ \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{01929     \_Out\_opt\_ DDS\_ALPHA\_MODE* alphaMode}
\DoxyCodeLine{01930     )}
\DoxyCodeLine{01931 \{}
\DoxyCodeLine{01932     \textcolor{keywordflow}{if} (alphaMode)}
\DoxyCodeLine{01933         (*alphaMode) = DDS\_ALPHA\_MODE\_UNKNOWN;}
\DoxyCodeLine{01934 }
\DoxyCodeLine{01935     \textcolor{keywordflow}{if} (!device || !cmdList || !ddsData || !ddsDataSize)}
\DoxyCodeLine{01936     \{}
\DoxyCodeLine{01937         \textcolor{keywordflow}{return} E\_INVALIDARG;}
\DoxyCodeLine{01938     \}}
\DoxyCodeLine{01939 }
\DoxyCodeLine{01940     uint32\_t dwMagicNumber = *(\textcolor{keyword}{const} uint32\_t*)(ddsData);}
\DoxyCodeLine{01941     \textcolor{keywordflow}{if} (dwMagicNumber != DDS\_MAGIC)}
\DoxyCodeLine{01942     \{}
\DoxyCodeLine{01943         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{01944     \}}
\DoxyCodeLine{01945 }
\DoxyCodeLine{01946     \textcolor{keyword}{auto} header = \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }DDS\_HEADER*\textcolor{keyword}{>}(ddsData + \textcolor{keyword}{sizeof}(uint32\_t));}
\DoxyCodeLine{01947 }
\DoxyCodeLine{01948     \textcolor{comment}{// Verify header to validate DDS file}}
\DoxyCodeLine{01949     \textcolor{keywordflow}{if} (header-\/>size != \textcolor{keyword}{sizeof}(DDS\_HEADER) ||}
\DoxyCodeLine{01950         header-\/>ddspf.size != \textcolor{keyword}{sizeof}(DDS\_PIXELFORMAT))}
\DoxyCodeLine{01951     \{}
\DoxyCodeLine{01952         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{01953     \}}
\DoxyCodeLine{01954 }
\DoxyCodeLine{01955     \textcolor{comment}{// Check for DX10 extension}}
\DoxyCodeLine{01956     \textcolor{keywordtype}{bool} bDXT10Header = \textcolor{keyword}{false};}
\DoxyCodeLine{01957     \textcolor{keywordflow}{if} ((header-\/>ddspf.flags \& DDS\_FOURCC) \&\&}
\DoxyCodeLine{01958         (MAKEFOURCC(\textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'1'}, \textcolor{charliteral}{'0'}) == header-\/>ddspf.fourCC))}
\DoxyCodeLine{01959     \{}
\DoxyCodeLine{01960         \textcolor{comment}{// Must be long enough for both headers and magic value}}
\DoxyCodeLine{01961         \textcolor{keywordflow}{if} (ddsDataSize < (\textcolor{keyword}{sizeof}(DDS\_HEADER) + \textcolor{keyword}{sizeof}(uint32\_t) + \textcolor{keyword}{sizeof}(DDS\_HEADER\_DXT10)))}
\DoxyCodeLine{01962         \{}
\DoxyCodeLine{01963             \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{01964         \}}
\DoxyCodeLine{01965 }
\DoxyCodeLine{01966         bDXT10Header = \textcolor{keyword}{true};}
\DoxyCodeLine{01967     \}}
\DoxyCodeLine{01968 }
\DoxyCodeLine{01969     ptrdiff\_t offset = \textcolor{keyword}{sizeof}(uint32\_t)}
\DoxyCodeLine{01970         + \textcolor{keyword}{sizeof}(DDS\_HEADER)}
\DoxyCodeLine{01971         + (bDXT10Header ? \textcolor{keyword}{sizeof}(DDS\_HEADER\_DXT10) : 0);}
\DoxyCodeLine{01972 }
\DoxyCodeLine{01973     HRESULT hr = CreateTextureFromDDS12(}
\DoxyCodeLine{01974         device,}
\DoxyCodeLine{01975         cmdList,}
\DoxyCodeLine{01976         header,}
\DoxyCodeLine{01977         ddsData + offset,}
\DoxyCodeLine{01978         ddsDataSize -\/ offset,}
\DoxyCodeLine{01979         maxsize,}
\DoxyCodeLine{01980         \textcolor{keyword}{false},}
\DoxyCodeLine{01981         texture,}
\DoxyCodeLine{01982         textureUploadHeap}
\DoxyCodeLine{01983         );}
\DoxyCodeLine{01984 }
\DoxyCodeLine{01985     \textcolor{keywordflow}{if} (SUCCEEDED(hr))}
\DoxyCodeLine{01986     \{}
\DoxyCodeLine{01987         \textcolor{keywordflow}{if} (alphaMode)}
\DoxyCodeLine{01988             (*alphaMode) = GetAlphaMode(header);}
\DoxyCodeLine{01989     \}}
\DoxyCodeLine{01990 }
\DoxyCodeLine{01991     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{01992 \}}
\DoxyCodeLine{01993 }
\DoxyCodeLine{01994 \_Use\_decl\_annotations\_}
\DoxyCodeLine{01995 HRESULT DirectX::CreateDDSTextureFromMemory( ID3D11Device* d3dDevice,}
\DoxyCodeLine{01996                                              ID3D11DeviceContext* d3dContext,}
\DoxyCodeLine{01997                                              \textcolor{keyword}{const} uint8\_t* ddsData,}
\DoxyCodeLine{01998                                              \textcolor{keywordtype}{size\_t} ddsDataSize,}
\DoxyCodeLine{01999                                              ID3D11Resource** texture,}
\DoxyCodeLine{02000                                              ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{02001                                              \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02002                                              DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{02003 \{}
\DoxyCodeLine{02004     \textcolor{keywordflow}{return} CreateDDSTextureFromMemoryEx( d3dDevice, d3dContext, ddsData, ddsDataSize, maxsize,}
\DoxyCodeLine{02005                                          D3D11\_USAGE\_DEFAULT, D3D11\_BIND\_SHADER\_RESOURCE, 0, 0, \textcolor{keyword}{false},}
\DoxyCodeLine{02006                                          texture, textureView, alphaMode );}
\DoxyCodeLine{02007 \}}
\DoxyCodeLine{02008 }
\DoxyCodeLine{02009 \_Use\_decl\_annotations\_}
\DoxyCodeLine{02010 HRESULT DirectX::CreateDDSTextureFromMemoryEx( ID3D11Device* d3dDevice,}
\DoxyCodeLine{02011                                                \textcolor{keyword}{const} uint8\_t* ddsData,}
\DoxyCodeLine{02012                                                \textcolor{keywordtype}{size\_t} ddsDataSize,}
\DoxyCodeLine{02013                                                \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02014                                                D3D11\_USAGE usage,}
\DoxyCodeLine{02015                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bindFlags,}
\DoxyCodeLine{02016                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cpuAccessFlags,}
\DoxyCodeLine{02017                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} miscFlags,}
\DoxyCodeLine{02018                                                \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{02019                                                ID3D11Resource** texture,}
\DoxyCodeLine{02020                                                ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{02021                                                DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{02022 \{}
\DoxyCodeLine{02023     \textcolor{keywordflow}{return} CreateDDSTextureFromMemoryEx( d3dDevice, \textcolor{keyword}{nullptr}, ddsData, ddsDataSize, maxsize,}
\DoxyCodeLine{02024                                          usage, bindFlags, cpuAccessFlags, miscFlags, forceSRGB,}
\DoxyCodeLine{02025                                          texture, textureView, alphaMode );}
\DoxyCodeLine{02026 \}}
\DoxyCodeLine{02027 }
\DoxyCodeLine{02028 \_Use\_decl\_annotations\_}
\DoxyCodeLine{02029 HRESULT DirectX::CreateDDSTextureFromMemoryEx( ID3D11Device* d3dDevice,}
\DoxyCodeLine{02030                                                ID3D11DeviceContext* d3dContext,}
\DoxyCodeLine{02031                                                \textcolor{keyword}{const} uint8\_t* ddsData,}
\DoxyCodeLine{02032                                                \textcolor{keywordtype}{size\_t} ddsDataSize,}
\DoxyCodeLine{02033                                                \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02034                                                D3D11\_USAGE usage,}
\DoxyCodeLine{02035                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bindFlags,}
\DoxyCodeLine{02036                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cpuAccessFlags,}
\DoxyCodeLine{02037                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} miscFlags,}
\DoxyCodeLine{02038                                                \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{02039                                                ID3D11Resource** texture,}
\DoxyCodeLine{02040                                                ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{02041                                                DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{02042 \{}
\DoxyCodeLine{02043     \textcolor{keywordflow}{if} ( texture )}
\DoxyCodeLine{02044     \{}
\DoxyCodeLine{02045         *texture = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02046     \}}
\DoxyCodeLine{02047     \textcolor{keywordflow}{if} ( textureView )}
\DoxyCodeLine{02048     \{}
\DoxyCodeLine{02049         *textureView = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02050     \}}
\DoxyCodeLine{02051     \textcolor{keywordflow}{if} ( alphaMode )}
\DoxyCodeLine{02052     \{}
\DoxyCodeLine{02053         *alphaMode = DDS\_ALPHA\_MODE\_UNKNOWN;}
\DoxyCodeLine{02054     \}}
\DoxyCodeLine{02055 }
\DoxyCodeLine{02056     \textcolor{keywordflow}{if} (!d3dDevice || !ddsData || (!texture \&\& !textureView))}
\DoxyCodeLine{02057     \{}
\DoxyCodeLine{02058         \textcolor{keywordflow}{return} E\_INVALIDARG;}
\DoxyCodeLine{02059     \}}
\DoxyCodeLine{02060 }
\DoxyCodeLine{02061     \textcolor{comment}{// Validate DDS file in memory}}
\DoxyCodeLine{02062     \textcolor{keywordflow}{if} (ddsDataSize < (\textcolor{keyword}{sizeof}(uint32\_t) + \textcolor{keyword}{sizeof}(DDS\_HEADER)))}
\DoxyCodeLine{02063     \{}
\DoxyCodeLine{02064         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{02065     \}}
\DoxyCodeLine{02066 }
\DoxyCodeLine{02067     uint32\_t dwMagicNumber = *( \textcolor{keyword}{const} uint32\_t* )( ddsData );}
\DoxyCodeLine{02068     \textcolor{keywordflow}{if} (dwMagicNumber != DDS\_MAGIC)}
\DoxyCodeLine{02069     \{}
\DoxyCodeLine{02070         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{02071     \}}
\DoxyCodeLine{02072 }
\DoxyCodeLine{02073     \textcolor{keyword}{auto} header = \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }DDS\_HEADER*\textcolor{keyword}{>}( ddsData + \textcolor{keyword}{sizeof}( uint32\_t ) );}
\DoxyCodeLine{02074 }
\DoxyCodeLine{02075     \textcolor{comment}{// Verify header to validate DDS file}}
\DoxyCodeLine{02076     \textcolor{keywordflow}{if} (header-\/>size != \textcolor{keyword}{sizeof}(DDS\_HEADER) ||}
\DoxyCodeLine{02077         header-\/>ddspf.size != \textcolor{keyword}{sizeof}(DDS\_PIXELFORMAT))}
\DoxyCodeLine{02078     \{}
\DoxyCodeLine{02079         \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{02080     \}}
\DoxyCodeLine{02081 }
\DoxyCodeLine{02082     \textcolor{comment}{// Check for DX10 extension}}
\DoxyCodeLine{02083     \textcolor{keywordtype}{bool} bDXT10Header = \textcolor{keyword}{false};}
\DoxyCodeLine{02084     \textcolor{keywordflow}{if} ((header-\/>ddspf.flags \& DDS\_FOURCC) \&\&}
\DoxyCodeLine{02085         (MAKEFOURCC( \textcolor{charliteral}{'D'}, \textcolor{charliteral}{'X'}, \textcolor{charliteral}{'1'}, \textcolor{charliteral}{'0'} ) == header-\/>ddspf.fourCC) )}
\DoxyCodeLine{02086     \{}
\DoxyCodeLine{02087         \textcolor{comment}{// Must be long enough for both headers and magic value}}
\DoxyCodeLine{02088         \textcolor{keywordflow}{if} (ddsDataSize < (\textcolor{keyword}{sizeof}(DDS\_HEADER) + \textcolor{keyword}{sizeof}(uint32\_t) + \textcolor{keyword}{sizeof}(DDS\_HEADER\_DXT10)))}
\DoxyCodeLine{02089         \{}
\DoxyCodeLine{02090             \textcolor{keywordflow}{return} E\_FAIL;}
\DoxyCodeLine{02091         \}}
\DoxyCodeLine{02092 }
\DoxyCodeLine{02093         bDXT10Header = \textcolor{keyword}{true};}
\DoxyCodeLine{02094     \}}
\DoxyCodeLine{02095 }
\DoxyCodeLine{02096     ptrdiff\_t offset = \textcolor{keyword}{sizeof}( uint32\_t )}
\DoxyCodeLine{02097                        + \textcolor{keyword}{sizeof}( DDS\_HEADER )}
\DoxyCodeLine{02098                        + (bDXT10Header ? \textcolor{keyword}{sizeof}( DDS\_HEADER\_DXT10 ) : 0);}
\DoxyCodeLine{02099 }
\DoxyCodeLine{02100     HRESULT hr = CreateTextureFromDDS( d3dDevice, d3dContext, header,}
\DoxyCodeLine{02101                                        ddsData + offset, ddsDataSize -\/ offset, maxsize,}
\DoxyCodeLine{02102                                        usage, bindFlags, cpuAccessFlags, miscFlags, forceSRGB,}
\DoxyCodeLine{02103                                        texture, textureView );}
\DoxyCodeLine{02104     \textcolor{keywordflow}{if} ( SUCCEEDED(hr) )}
\DoxyCodeLine{02105     \{}
\DoxyCodeLine{02106         \textcolor{keywordflow}{if} (texture != 0 \&\& *texture != 0)}
\DoxyCodeLine{02107         \{}
\DoxyCodeLine{02108             SetDebugObjectName(*texture, \textcolor{stringliteral}{"{}DDSTextureLoader"{}});}
\DoxyCodeLine{02109         \}}
\DoxyCodeLine{02110 }
\DoxyCodeLine{02111         \textcolor{keywordflow}{if} (textureView != 0 \&\& *textureView != 0)}
\DoxyCodeLine{02112         \{}
\DoxyCodeLine{02113             SetDebugObjectName(*textureView, \textcolor{stringliteral}{"{}DDSTextureLoader"{}});}
\DoxyCodeLine{02114         \}}
\DoxyCodeLine{02115 }
\DoxyCodeLine{02116         \textcolor{keywordflow}{if} ( alphaMode )}
\DoxyCodeLine{02117             *alphaMode = GetAlphaMode( header );}
\DoxyCodeLine{02118     \}}
\DoxyCodeLine{02119 }
\DoxyCodeLine{02120     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{02121 \}}
\DoxyCodeLine{02122 }
\DoxyCodeLine{02123 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{02124 \_Use\_decl\_annotations\_}
\DoxyCodeLine{02125 HRESULT DirectX::CreateDDSTextureFromFile( ID3D11Device* d3dDevice,}
\DoxyCodeLine{02126                                            \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t}* fileName,}
\DoxyCodeLine{02127                                            ID3D11Resource** texture,}
\DoxyCodeLine{02128                                            ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{02129                                            \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02130                                            DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{02131 \{}
\DoxyCodeLine{02132     \textcolor{keywordflow}{return} CreateDDSTextureFromFileEx( d3dDevice, \textcolor{keyword}{nullptr}, fileName, maxsize,}
\DoxyCodeLine{02133                                        D3D11\_USAGE\_DEFAULT, D3D11\_BIND\_SHADER\_RESOURCE, 0, 0, \textcolor{keyword}{false},}
\DoxyCodeLine{02134                                        texture, textureView, alphaMode );}
\DoxyCodeLine{02135 \}}
\DoxyCodeLine{02136 }
\DoxyCodeLine{02137 HRESULT DirectX::CreateDDSTextureFromFile12(\_In\_ ID3D12Device* device,}
\DoxyCodeLine{02138     \_In\_ ID3D12GraphicsCommandList* cmdList,}
\DoxyCodeLine{02139     \_In\_z\_ \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t}* szFileName,}
\DoxyCodeLine{02140     \_Out\_ ComPtr<ID3D12Resource>\& texture,}
\DoxyCodeLine{02141     \_Out\_ ComPtr<ID3D12Resource>\& textureUploadHeap,}
\DoxyCodeLine{02142     \_In\_ \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02143     \_Out\_opt\_ DDS\_ALPHA\_MODE* alphaMode)}
\DoxyCodeLine{02144 \{}
\DoxyCodeLine{02145     \textcolor{keywordflow}{if} (texture)}
\DoxyCodeLine{02146     \{}
\DoxyCodeLine{02147         texture = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02148     \}}
\DoxyCodeLine{02149     \textcolor{keywordflow}{if} (textureUploadHeap)}
\DoxyCodeLine{02150     \{}
\DoxyCodeLine{02151         textureUploadHeap = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02152     \}}
\DoxyCodeLine{02153     \textcolor{keywordflow}{if} (alphaMode)}
\DoxyCodeLine{02154     \{}
\DoxyCodeLine{02155         *alphaMode = DDS\_ALPHA\_MODE\_UNKNOWN;}
\DoxyCodeLine{02156     \}}
\DoxyCodeLine{02157 }
\DoxyCodeLine{02158     \textcolor{keywordflow}{if} (!device || !szFileName)}
\DoxyCodeLine{02159     \{}
\DoxyCodeLine{02160         \textcolor{keywordflow}{return} E\_INVALIDARG;}
\DoxyCodeLine{02161     \}}
\DoxyCodeLine{02162 }
\DoxyCodeLine{02163     DDS\_HEADER* header = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02164     uint8\_t* bitData = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02165     \textcolor{keywordtype}{size\_t} bitSize = 0;}
\DoxyCodeLine{02166 }
\DoxyCodeLine{02167     std::unique\_ptr<uint8\_t[]> ddsData;}
\DoxyCodeLine{02168     HRESULT hr = LoadTextureDataFromFile(szFileName, ddsData, \&header, \&bitData, \&bitSize);}
\DoxyCodeLine{02169     \textcolor{keywordflow}{if} (FAILED(hr))}
\DoxyCodeLine{02170     \{}
\DoxyCodeLine{02171         \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{02172     \}}
\DoxyCodeLine{02173 }
\DoxyCodeLine{02174     hr = CreateTextureFromDDS12(device, cmdList, header,}
\DoxyCodeLine{02175         bitData, bitSize, maxsize, \textcolor{keyword}{false}, texture, textureUploadHeap);}
\DoxyCodeLine{02176 }
\DoxyCodeLine{02177     \textcolor{keywordflow}{if} (SUCCEEDED(hr))}
\DoxyCodeLine{02178     \{}
\DoxyCodeLine{02179 \textcolor{comment}{/*}}
\DoxyCodeLine{02180 \textcolor{comment}{\#if !defined(NO\_D3D11\_DEBUG\_NAME) \&\& ( defined(\_DEBUG) || defined(PROFILE) )}}
\DoxyCodeLine{02181 \textcolor{comment}{        if (texture != 0 || textureView != 0)}}
\DoxyCodeLine{02182 \textcolor{comment}{        \{}}
\DoxyCodeLine{02183 \textcolor{comment}{            CHAR strFileA[MAX\_PATH];}}
\DoxyCodeLine{02184 \textcolor{comment}{            int result = WideCharToMultiByte(CP\_ACP,}}
\DoxyCodeLine{02185 \textcolor{comment}{                WC\_NO\_BEST\_FIT\_CHARS,}}
\DoxyCodeLine{02186 \textcolor{comment}{                fileName,}}
\DoxyCodeLine{02187 \textcolor{comment}{                -\/1,}}
\DoxyCodeLine{02188 \textcolor{comment}{                strFileA,}}
\DoxyCodeLine{02189 \textcolor{comment}{                MAX\_PATH,}}
\DoxyCodeLine{02190 \textcolor{comment}{                nullptr,}}
\DoxyCodeLine{02191 \textcolor{comment}{                FALSE}}
\DoxyCodeLine{02192 \textcolor{comment}{                );}}
\DoxyCodeLine{02193 \textcolor{comment}{            if (result > 0)}}
\DoxyCodeLine{02194 \textcolor{comment}{            \{}}
\DoxyCodeLine{02195 \textcolor{comment}{                const CHAR* pstrName = strrchr(strFileA, '\(\backslash\)\(\backslash\)');}}
\DoxyCodeLine{02196 \textcolor{comment}{                if (!pstrName)}}
\DoxyCodeLine{02197 \textcolor{comment}{                \{}}
\DoxyCodeLine{02198 \textcolor{comment}{                    pstrName = strFileA;}}
\DoxyCodeLine{02199 \textcolor{comment}{                \}}}
\DoxyCodeLine{02200 \textcolor{comment}{                else}}
\DoxyCodeLine{02201 \textcolor{comment}{                \{}}
\DoxyCodeLine{02202 \textcolor{comment}{                    pstrName++;}}
\DoxyCodeLine{02203 \textcolor{comment}{                \}}}
\DoxyCodeLine{02204 \textcolor{comment}{}}
\DoxyCodeLine{02205 \textcolor{comment}{                if (texture != 0 \&\& *texture != 0)}}
\DoxyCodeLine{02206 \textcolor{comment}{                \{}}
\DoxyCodeLine{02207 \textcolor{comment}{                    (*texture)-\/>SetPrivateData(WKPDID\_D3DDebugObjectName,}}
\DoxyCodeLine{02208 \textcolor{comment}{                        static\_cast<UINT>(strnlen\_s(pstrName, MAX\_PATH)),}}
\DoxyCodeLine{02209 \textcolor{comment}{                        pstrName}}
\DoxyCodeLine{02210 \textcolor{comment}{                        );}}
\DoxyCodeLine{02211 \textcolor{comment}{                \}}}
\DoxyCodeLine{02212 \textcolor{comment}{}}
\DoxyCodeLine{02213 \textcolor{comment}{                if (textureView != 0 \&\& *textureView != 0)}}
\DoxyCodeLine{02214 \textcolor{comment}{                \{}}
\DoxyCodeLine{02215 \textcolor{comment}{                    (*textureView)-\/>SetPrivateData(WKPDID\_D3DDebugObjectName,}}
\DoxyCodeLine{02216 \textcolor{comment}{                        static\_cast<UINT>(strnlen\_s(pstrName, MAX\_PATH)),}}
\DoxyCodeLine{02217 \textcolor{comment}{                        pstrName}}
\DoxyCodeLine{02218 \textcolor{comment}{                        );}}
\DoxyCodeLine{02219 \textcolor{comment}{                \}}}
\DoxyCodeLine{02220 \textcolor{comment}{            \}}}
\DoxyCodeLine{02221 \textcolor{comment}{        \}}}
\DoxyCodeLine{02222 \textcolor{comment}{\#endif}}
\DoxyCodeLine{02223 \textcolor{comment}{*/}}
\DoxyCodeLine{02224         \textcolor{keywordflow}{if} (alphaMode)}
\DoxyCodeLine{02225             *alphaMode = GetAlphaMode(header);}
\DoxyCodeLine{02226     \}}
\DoxyCodeLine{02227 }
\DoxyCodeLine{02228     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{02229 \}}
\DoxyCodeLine{02230 }
\DoxyCodeLine{02231 \_Use\_decl\_annotations\_}
\DoxyCodeLine{02232 HRESULT DirectX::CreateDDSTextureFromFile( ID3D11Device* d3dDevice,}
\DoxyCodeLine{02233                                            ID3D11DeviceContext* d3dContext,}
\DoxyCodeLine{02234                                            \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t}* fileName,}
\DoxyCodeLine{02235                                            ID3D11Resource** texture,}
\DoxyCodeLine{02236                                            ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{02237                                            \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02238                                            DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{02239 \{}
\DoxyCodeLine{02240     \textcolor{keywordflow}{return} CreateDDSTextureFromFileEx( d3dDevice, d3dContext, fileName, maxsize,}
\DoxyCodeLine{02241                                        D3D11\_USAGE\_DEFAULT, D3D11\_BIND\_SHADER\_RESOURCE, 0, 0, \textcolor{keyword}{false},}
\DoxyCodeLine{02242                                        texture, textureView, alphaMode );}
\DoxyCodeLine{02243 \}}
\DoxyCodeLine{02244 }
\DoxyCodeLine{02245 \_Use\_decl\_annotations\_}
\DoxyCodeLine{02246 HRESULT DirectX::CreateDDSTextureFromFileEx( ID3D11Device* d3dDevice,}
\DoxyCodeLine{02247                                              \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t}* fileName,}
\DoxyCodeLine{02248                                              \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02249                                              D3D11\_USAGE usage,}
\DoxyCodeLine{02250                                              \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bindFlags,}
\DoxyCodeLine{02251                                              \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cpuAccessFlags,}
\DoxyCodeLine{02252                                              \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} miscFlags,}
\DoxyCodeLine{02253                                              \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{02254                                              ID3D11Resource** texture,}
\DoxyCodeLine{02255                                              ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{02256                                              DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{02257 \{}
\DoxyCodeLine{02258     \textcolor{keywordflow}{return} CreateDDSTextureFromFileEx( d3dDevice, \textcolor{keyword}{nullptr}, fileName, maxsize,}
\DoxyCodeLine{02259                                        usage, bindFlags, cpuAccessFlags, miscFlags, forceSRGB,}
\DoxyCodeLine{02260                                        texture, textureView, alphaMode );}
\DoxyCodeLine{02261 \}}
\DoxyCodeLine{02262 }
\DoxyCodeLine{02263 \_Use\_decl\_annotations\_}
\DoxyCodeLine{02264 HRESULT DirectX::CreateDDSTextureFromFileEx( ID3D11Device* d3dDevice,}
\DoxyCodeLine{02265                                              ID3D11DeviceContext* d3dContext,}
\DoxyCodeLine{02266                                              \textcolor{keyword}{const} \textcolor{keywordtype}{wchar\_t}* fileName,}
\DoxyCodeLine{02267                                              \textcolor{keywordtype}{size\_t} maxsize,}
\DoxyCodeLine{02268                                              D3D11\_USAGE usage,}
\DoxyCodeLine{02269                                              \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} bindFlags,}
\DoxyCodeLine{02270                                              \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} cpuAccessFlags,}
\DoxyCodeLine{02271                                              \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} miscFlags,}
\DoxyCodeLine{02272                                              \textcolor{keywordtype}{bool} forceSRGB,}
\DoxyCodeLine{02273                                              ID3D11Resource** texture,}
\DoxyCodeLine{02274                                              ID3D11ShaderResourceView** textureView,}
\DoxyCodeLine{02275                                              DDS\_ALPHA\_MODE* alphaMode )}
\DoxyCodeLine{02276 \{}
\DoxyCodeLine{02277     \textcolor{keywordflow}{if} ( texture )}
\DoxyCodeLine{02278     \{}
\DoxyCodeLine{02279         *texture = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02280     \}}
\DoxyCodeLine{02281     \textcolor{keywordflow}{if} ( textureView )}
\DoxyCodeLine{02282     \{}
\DoxyCodeLine{02283         *textureView = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02284     \}}
\DoxyCodeLine{02285     \textcolor{keywordflow}{if} ( alphaMode )}
\DoxyCodeLine{02286     \{}
\DoxyCodeLine{02287         *alphaMode = DDS\_ALPHA\_MODE\_UNKNOWN;}
\DoxyCodeLine{02288     \}}
\DoxyCodeLine{02289 }
\DoxyCodeLine{02290     \textcolor{keywordflow}{if} (!d3dDevice || !fileName || (!texture \&\& !textureView))}
\DoxyCodeLine{02291     \{}
\DoxyCodeLine{02292         \textcolor{keywordflow}{return} E\_INVALIDARG;}
\DoxyCodeLine{02293     \}}
\DoxyCodeLine{02294 }
\DoxyCodeLine{02295     DDS\_HEADER* header = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02296     uint8\_t* bitData = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02297     \textcolor{keywordtype}{size\_t} bitSize = 0;}
\DoxyCodeLine{02298 }
\DoxyCodeLine{02299     std::unique\_ptr<uint8\_t[]> ddsData;}
\DoxyCodeLine{02300     HRESULT hr = LoadTextureDataFromFile( fileName,}
\DoxyCodeLine{02301                                           ddsData,}
\DoxyCodeLine{02302                                           \&header,}
\DoxyCodeLine{02303                                           \&bitData,}
\DoxyCodeLine{02304                                           \&bitSize}
\DoxyCodeLine{02305                                         );}
\DoxyCodeLine{02306     \textcolor{keywordflow}{if} (FAILED(hr))}
\DoxyCodeLine{02307     \{}
\DoxyCodeLine{02308         \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{02309     \}}
\DoxyCodeLine{02310 }
\DoxyCodeLine{02311     hr = CreateTextureFromDDS( d3dDevice, d3dContext, header,}
\DoxyCodeLine{02312                                bitData, bitSize, maxsize,}
\DoxyCodeLine{02313                                usage, bindFlags, cpuAccessFlags, miscFlags, forceSRGB,}
\DoxyCodeLine{02314                                texture, textureView );}
\DoxyCodeLine{02315 }
\DoxyCodeLine{02316     \textcolor{keywordflow}{if} ( SUCCEEDED(hr) )}
\DoxyCodeLine{02317     \{}
\DoxyCodeLine{02318 \textcolor{preprocessor}{\#if !defined(NO\_D3D11\_DEBUG\_NAME) \&\& ( defined(\_DEBUG) || defined(PROFILE) )}}
\DoxyCodeLine{02319         \textcolor{keywordflow}{if} (texture != 0 || textureView != 0)}
\DoxyCodeLine{02320         \{}
\DoxyCodeLine{02321             CHAR strFileA[MAX\_PATH];}
\DoxyCodeLine{02322             \textcolor{keywordtype}{int} result = WideCharToMultiByte( CP\_ACP,}
\DoxyCodeLine{02323                                               WC\_NO\_BEST\_FIT\_CHARS,}
\DoxyCodeLine{02324                                               fileName,}
\DoxyCodeLine{02325                                               -\/1,}
\DoxyCodeLine{02326                                               strFileA,}
\DoxyCodeLine{02327                                               MAX\_PATH,}
\DoxyCodeLine{02328                                               \textcolor{keyword}{nullptr},}
\DoxyCodeLine{02329                                               FALSE}
\DoxyCodeLine{02330                                );}
\DoxyCodeLine{02331             \textcolor{keywordflow}{if} ( result > 0 )}
\DoxyCodeLine{02332             \{}
\DoxyCodeLine{02333                 \textcolor{keyword}{const} CHAR* pstrName = strrchr( strFileA, \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'} );}
\DoxyCodeLine{02334                 \textcolor{keywordflow}{if} (!pstrName)}
\DoxyCodeLine{02335                 \{}
\DoxyCodeLine{02336                     pstrName = strFileA;}
\DoxyCodeLine{02337                 \}}
\DoxyCodeLine{02338                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{02339                 \{}
\DoxyCodeLine{02340                     pstrName++;}
\DoxyCodeLine{02341                 \}}
\DoxyCodeLine{02342 }
\DoxyCodeLine{02343                 \textcolor{keywordflow}{if} (texture != 0 \&\& *texture != 0)}
\DoxyCodeLine{02344                 \{}
\DoxyCodeLine{02345                     (*texture)-\/>SetPrivateData( WKPDID\_D3DDebugObjectName,}
\DoxyCodeLine{02346                                                 \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( strnlen\_s(pstrName, MAX\_PATH) ),}
\DoxyCodeLine{02347                                                 pstrName}
\DoxyCodeLine{02348                                               );}
\DoxyCodeLine{02349                 \}}
\DoxyCodeLine{02350 }
\DoxyCodeLine{02351                 \textcolor{keywordflow}{if} (textureView != 0 \&\& *textureView != 0 )}
\DoxyCodeLine{02352                 \{}
\DoxyCodeLine{02353                     (*textureView)-\/>SetPrivateData( WKPDID\_D3DDebugObjectName,}
\DoxyCodeLine{02354                                                     \textcolor{keyword}{static\_cast<}UINT\textcolor{keyword}{>}( strnlen\_s(pstrName, MAX\_PATH) ),}
\DoxyCodeLine{02355                                                     pstrName}
\DoxyCodeLine{02356                                                   );}
\DoxyCodeLine{02357                 \}}
\DoxyCodeLine{02358             \}}
\DoxyCodeLine{02359         \}}
\DoxyCodeLine{02360 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02361 }
\DoxyCodeLine{02362         \textcolor{keywordflow}{if} ( alphaMode )}
\DoxyCodeLine{02363             *alphaMode = GetAlphaMode( header );}
\DoxyCodeLine{02364     \}}
\DoxyCodeLine{02365 }
\DoxyCodeLine{02366     \textcolor{keywordflow}{return} hr;}
\DoxyCodeLine{02367 \}}

\end{DoxyCode}
