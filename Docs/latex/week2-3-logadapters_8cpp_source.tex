\doxysection{week2-\/3-\/logadapters.cpp}
\label{week2-3-logadapters_8cpp_source}\index{Week2/Week2-\/2-\/InitializeDirect3D/week2-\/3-\/logadapters.cpp@{Week2/Week2-\/2-\/InitializeDirect3D/week2-\/3-\/logadapters.cpp}}
\textbf{ Go to the documentation of this file.}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001 }
\DoxyCodeLine{00002 \textcolor{preprocessor}{\#include "{}../../Common/d3dApp.h"{}}}
\DoxyCodeLine{00003 \textcolor{preprocessor}{\#include <DirectXColors.h>}}
\DoxyCodeLine{00004 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{00005 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{00006 \textcolor{preprocessor}{\#include <comdef.h>}}
\DoxyCodeLine{00007 }
\DoxyCodeLine{00008 \textcolor{keyword}{using namespace }DirectX;}
\DoxyCodeLine{00009 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{00010 }
\DoxyCodeLine{00011 \textcolor{keyword}{class }InitDirect3DApp : \textcolor{keyword}{public} D3DApp}
\DoxyCodeLine{00012 \{}
\DoxyCodeLine{00013 \textcolor{keyword}{public}:}
\DoxyCodeLine{00014     InitDirect3DApp(HINSTANCE hInstance);}
\DoxyCodeLine{00015     \string~InitDirect3DApp();}
\DoxyCodeLine{00016 }
\DoxyCodeLine{00017     \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} Initialize()\textcolor{keyword}{override};}
\DoxyCodeLine{00018 }
\DoxyCodeLine{00019 \textcolor{keyword}{private}:}
\DoxyCodeLine{00020     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} OnResize()\textcolor{keyword}{override};}
\DoxyCodeLine{00021     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Update(\textcolor{keyword}{const} GameTimer\& gt)\textcolor{keyword}{override};}
\DoxyCodeLine{00022     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Draw(\textcolor{keyword}{const} GameTimer\& gt)\textcolor{keyword}{override};}
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024 \};}
\DoxyCodeLine{00025 }
\DoxyCodeLine{00026 }
\DoxyCodeLine{00027 \textcolor{comment}{//WinMain -\/-\/> every win32 application needs a WinMain() function, like console application needs main()}}
\DoxyCodeLine{00028 \textcolor{comment}{//HINSTANCE, PSTR.. are part of <Windows.h>}}
\DoxyCodeLine{00029 \textcolor{comment}{//Windows is about Windows (window class that you register and instance of the class) and Messages}}
\DoxyCodeLine{00030 \textcolor{comment}{//cmdLine receives the parameter that somebody passes}}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032 }
\DoxyCodeLine{00033 \textcolor{keywordtype}{int} WINAPI WinMain(HINSTANCE hInstance, HINSTANCE prevInstance,}
\DoxyCodeLine{00034     PSTR cmdLine, \textcolor{keywordtype}{int} showCmd)}
\DoxyCodeLine{00035 \{}
\DoxyCodeLine{00036     \textcolor{comment}{// Enable run-\/time memory check for debug builds.}}
\DoxyCodeLine{00037 \textcolor{preprocessor}{\#if defined(DEBUG) | defined(\_DEBUG)}}
\DoxyCodeLine{00038     \_CrtSetDbgFlag(\_CRTDBG\_ALLOC\_MEM\_DF | \_CRTDBG\_LEAK\_CHECK\_DF);}
\DoxyCodeLine{00039 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00040 }
\DoxyCodeLine{00041     \textcolor{keywordflow}{try}}
\DoxyCodeLine{00042     \{}
\DoxyCodeLine{00043         InitDirect3DApp theApp(hInstance);}
\DoxyCodeLine{00044         \textcolor{keywordflow}{if} (!theApp.Initialize())}
\DoxyCodeLine{00045             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00046 }
\DoxyCodeLine{00047         \textcolor{keywordflow}{return} theApp.Run();}
\DoxyCodeLine{00048     \}}
\DoxyCodeLine{00049     \textcolor{keywordflow}{catch} (DxException\& e)}
\DoxyCodeLine{00050     \{}
\DoxyCodeLine{00051         MessageBox(\textcolor{keyword}{nullptr}, e.ToString().c\_str(), L\textcolor{stringliteral}{"{}HR Failed"{}}, MB\_OK);}
\DoxyCodeLine{00052         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00053     \}}
\DoxyCodeLine{00054 \}}
\DoxyCodeLine{00055 }
\DoxyCodeLine{00056 InitDirect3DApp::InitDirect3DApp(HINSTANCE hInstance)}
\DoxyCodeLine{00057     : D3DApp(hInstance)}
\DoxyCodeLine{00058 \{}
\DoxyCodeLine{00059 }
\DoxyCodeLine{00060 \}}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062 InitDirect3DApp::\string~InitDirect3DApp()}
\DoxyCodeLine{00063 \{}
\DoxyCodeLine{00064 \}}
\DoxyCodeLine{00065 }
\DoxyCodeLine{00066 \textcolor{keywordtype}{bool} InitDirect3DApp::Initialize()}
\DoxyCodeLine{00067 \{}
\DoxyCodeLine{00068     \textcolor{keywordflow}{if} (!D3DApp::Initialize())}
\DoxyCodeLine{00069         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00070 }
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072     \textcolor{comment}{//We can query the number of quality levels for a given texture format and sample count using the ID3D12Device::CheckFeatureSupport method like so :}}
\DoxyCodeLine{00073     D3D12\_FEATURE\_DATA\_MULTISAMPLE\_QUALITY\_LEVELS msQualityLevels;}
\DoxyCodeLine{00074     msQualityLevels.Format = mBackBufferFormat;}
\DoxyCodeLine{00075     msQualityLevels.SampleCount = 4;}
\DoxyCodeLine{00076     msQualityLevels.Flags = D3D12\_MULTISAMPLE\_QUALITY\_LEVELS\_FLAG\_NONE;}
\DoxyCodeLine{00077     msQualityLevels.NumQualityLevels = 0;}
\DoxyCodeLine{00078 }
\DoxyCodeLine{00079     \textcolor{comment}{//Note that the second parameter is both an input and output parameter. For the input,}}
\DoxyCodeLine{00080     \textcolor{comment}{//we must specify the texture format, sample count, and flag we want to query}}
\DoxyCodeLine{00081     \textcolor{comment}{//multisampling support for.The function will then fill out the quality level as the output.}}
\DoxyCodeLine{00082     \textcolor{comment}{//Valid quality levels for a texture format and sample count combination range from zero to NumQualityLevels–1.}}
\DoxyCodeLine{00083     \textcolor{comment}{//The maximum number of samples that can be taken per pixel is defined by : \#define D3D12\_MAX\_MULTISAMPLE\_SAMPLE\_COUNT ( 32 )}}
\DoxyCodeLine{00084 }
\DoxyCodeLine{00085     ThrowIfFailed(md3dDevice-\/>CheckFeatureSupport(D3D12\_FEATURE\_MULTISAMPLE\_QUALITY\_LEVELS, \&msQualityLevels, \textcolor{keyword}{sizeof}(msQualityLevels)));}
\DoxyCodeLine{00086 }
\DoxyCodeLine{00087     \textcolor{comment}{//Note that the second parameter is both an input and output parameter. For the input,}}
\DoxyCodeLine{00088     \textcolor{comment}{//we specify the number of elements(NumFeatureLevels) in a feature level array, and}}
\DoxyCodeLine{00089     \textcolor{comment}{//  a pointer to a feature level array(pFeatureLevelsRequested) which contains a list}}
\DoxyCodeLine{00090     \textcolor{comment}{//  of feature levels we want to check hardware support for.The function outputs the}}
\DoxyCodeLine{00091     \textcolor{comment}{//  maximum supported feature level through the MaxSupportedFeatureLevel field.}}
\DoxyCodeLine{00092 }
\DoxyCodeLine{00093     \textcolor{comment}{//step1 what is the maximum feature that hardware support}}
\DoxyCodeLine{00094     D3D\_FEATURE\_LEVEL featureLevels[5] =}
\DoxyCodeLine{00095     \{}
\DoxyCodeLine{00096     D3D\_FEATURE\_LEVEL\_12\_1, \textcolor{comment}{// First check D3D 12.1 support,}}
\DoxyCodeLine{00097     D3D\_FEATURE\_LEVEL\_12\_0, \textcolor{comment}{// Next check D3D 12 support}}
\DoxyCodeLine{00098     D3D\_FEATURE\_LEVEL\_11\_0, \textcolor{comment}{// Next check D3D 11 support}}
\DoxyCodeLine{00099     D3D\_FEATURE\_LEVEL\_10\_0, \textcolor{comment}{// Next, check D3D 10 support}}
\DoxyCodeLine{00100     D3D\_FEATURE\_LEVEL\_9\_3 \textcolor{comment}{// Finally, check D3D 9.3 support}}
\DoxyCodeLine{00101     \};}
\DoxyCodeLine{00102     D3D12\_FEATURE\_DATA\_FEATURE\_LEVELS featureLevelsInfo;}
\DoxyCodeLine{00103     featureLevelsInfo.NumFeatureLevels = 5;}
\DoxyCodeLine{00104     featureLevelsInfo.pFeatureLevelsRequested = featureLevels;}
\DoxyCodeLine{00105     md3dDevice-\/>CheckFeatureSupport( D3D12\_FEATURE\_FEATURE\_LEVELS, \&featureLevelsInfo, \textcolor{keyword}{sizeof}(featureLevelsInfo));}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107 }
\DoxyCodeLine{00108     std::wstring text = L\textcolor{stringliteral}{"{}***Maximum Supported Feature is: "{}};}
\DoxyCodeLine{00109     std::wstring maxSupport = L\textcolor{stringliteral}{"{}9.3"{}};}
\DoxyCodeLine{00110     \textcolor{keywordflow}{if} (featureLevelsInfo.MaxSupportedFeatureLevel == D3D\_FEATURE\_LEVEL\_12\_1) maxSupport = L\textcolor{stringliteral}{"{}12.1"{}};}
\DoxyCodeLine{00111     \textcolor{keywordflow}{if} (featureLevelsInfo.MaxSupportedFeatureLevel == D3D\_FEATURE\_LEVEL\_11\_0) maxSupport = L\textcolor{stringliteral}{"{}11.0"{}};}
\DoxyCodeLine{00112     text += maxSupport;}
\DoxyCodeLine{00113     text += L\textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00114     OutputDebugString(text.c\_str());}
\DoxyCodeLine{00115 }
\DoxyCodeLine{00116     \textcolor{comment}{//https://docs.microsoft.com/en-\/us/windows/win32/api/d3d12/ne-\/d3d12-\/d3d12\_feature?redirectedfrom=MSDN}}
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118        \textcolor{comment}{//Indicates a query for the level of support for basic Direct3D 12 feature options.}}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120     D3D12\_FEATURE\_DATA\_D3D12\_OPTIONS tiers;}
\DoxyCodeLine{00121 }
\DoxyCodeLine{00122     \textcolor{keywordflow}{if} (md3dDevice-\/>CheckFeatureSupport(D3D12\_FEATURE\_D3D12\_OPTIONS, \&tiers, \textcolor{keyword}{sizeof}(tiers))) \{}
\DoxyCodeLine{00123         OutputDebugString(L\textcolor{stringliteral}{"{}Failed to query the options for adapter "{}});}
\DoxyCodeLine{00124     \}}
\DoxyCodeLine{00125 }
\DoxyCodeLine{00126     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00127         OutputDebugString(L\textcolor{stringliteral}{"{}Options query for adapter succeeded"{}});}
\DoxyCodeLine{00128     \}}
\DoxyCodeLine{00129 }
\DoxyCodeLine{00130 }
\DoxyCodeLine{00131 }
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133 }
\DoxyCodeLine{00134     \textcolor{comment}{//Indicates a query for the adapter's architectural details, so that your application can better optimize for certain adapter properties.}}
\DoxyCodeLine{00135     \textcolor{comment}{//For example UMA: Unified Memory Architecture: a technology that allows a Graphics Processing Unit to share system memory}}
\DoxyCodeLine{00136 }
\DoxyCodeLine{00137     D3D12\_FEATURE\_DATA\_ARCHITECTURE1 arch;}
\DoxyCodeLine{00138 }
\DoxyCodeLine{00139     md3dDevice-\/>CheckFeatureSupport(D3D12\_FEATURE\_ARCHITECTURE1, \&arch, \textcolor{keyword}{sizeof}(arch));}
\DoxyCodeLine{00140 }
\DoxyCodeLine{00141     wstring gpuNode = L\textcolor{stringliteral}{"{}Number of GPU node: "{}};}
\DoxyCodeLine{00142 }
\DoxyCodeLine{00143     gpuNode += to\_wstring(md3dDevice-\/>GetNodeCount());}
\DoxyCodeLine{00144 }
\DoxyCodeLine{00145     OutputDebugString(gpuNode.c\_str());}
\DoxyCodeLine{00146 }
\DoxyCodeLine{00147     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00148 \}}
\DoxyCodeLine{00149 }
\DoxyCodeLine{00150 \textcolor{keywordtype}{void} InitDirect3DApp::OnResize()}
\DoxyCodeLine{00151 \{}
\DoxyCodeLine{00152     D3DApp::OnResize();}
\DoxyCodeLine{00153 \}}
\DoxyCodeLine{00154 }
\DoxyCodeLine{00155 \textcolor{keywordtype}{void} InitDirect3DApp::Update(\textcolor{keyword}{const} GameTimer\& gt)}
\DoxyCodeLine{00156 \{}
\DoxyCodeLine{00157 }
\DoxyCodeLine{00158 \}}
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160 }
\DoxyCodeLine{00161 }
\DoxyCodeLine{00162 \textcolor{keywordtype}{void} InitDirect3DApp::Draw(\textcolor{keyword}{const} GameTimer\& gt)}
\DoxyCodeLine{00163 \{}
\DoxyCodeLine{00164     \textcolor{comment}{// Reuse the memory associated with command recording.}}
\DoxyCodeLine{00165     \textcolor{comment}{// We can only reset when the associated command lists have finished execution on the GPU.}}
\DoxyCodeLine{00166     ThrowIfFailed(mDirectCmdListAlloc-\/>Reset());}
\DoxyCodeLine{00167 }
\DoxyCodeLine{00168     \textcolor{comment}{// A command list can be reset after it has been added to the command queue via ExecuteCommandList.}}
\DoxyCodeLine{00169     \textcolor{comment}{// Reusing the command list reuses memory.}}
\DoxyCodeLine{00170     ThrowIfFailed(mCommandList-\/>Reset(mDirectCmdListAlloc.Get(), \textcolor{keyword}{nullptr}));}
\DoxyCodeLine{00171 }
\DoxyCodeLine{00172     \textcolor{comment}{// Indicate a state transition on the resource usage.}}
\DoxyCodeLine{00173     mCommandList-\/>ResourceBarrier(1, \&CD3DX12\_RESOURCE\_BARRIER::Transition(CurrentBackBuffer(),}
\DoxyCodeLine{00174         D3D12\_RESOURCE\_STATE\_PRESENT, D3D12\_RESOURCE\_STATE\_RENDER\_TARGET));}
\DoxyCodeLine{00175 }
\DoxyCodeLine{00176     \textcolor{comment}{// Set the viewport and scissor rect.  This needs to be reset whenever the command list is reset.}}
\DoxyCodeLine{00177     mCommandList-\/>RSSetViewports(1, \&mScreenViewport);}
\DoxyCodeLine{00178     mCommandList-\/>RSSetScissorRects(1, \&mScissorRect);}
\DoxyCodeLine{00179 }
\DoxyCodeLine{00180     \textcolor{comment}{// Clear the back buffer and depth buffer.}}
\DoxyCodeLine{00181     \textcolor{comment}{//mCommandList-\/>ClearRenderTargetView(CurrentBackBufferView(), Colors::LightSteelBlue, 0, nullptr);}}
\DoxyCodeLine{00182     \textcolor{comment}{//Hooman Step1:}}
\DoxyCodeLine{00183     \textcolor{keyword}{const} \textcolor{keywordtype}{float} color[] = \{ 1.0,1.0,0.0,1.0 \};}
\DoxyCodeLine{00184     \textcolor{keyword}{const} \textcolor{keywordtype}{float} c = sin(mTimer.TotalTime());}
\DoxyCodeLine{00185     \textcolor{keyword}{const} \textcolor{keywordtype}{float} color2[] = \{ c,c,1.0,1.0 \};}
\DoxyCodeLine{00186     mCommandList-\/>ClearRenderTargetView(CurrentBackBufferView(), color2, 0, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00187 }
\DoxyCodeLine{00188     mCommandList-\/>ClearDepthStencilView(DepthStencilView(), D3D12\_CLEAR\_FLAG\_DEPTH | D3D12\_CLEAR\_FLAG\_STENCIL, 1.0f, 0, 0, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190     \textcolor{comment}{// Specify the buffers we are going to render to.}}
\DoxyCodeLine{00191     mCommandList-\/>OMSetRenderTargets(1, \&CurrentBackBufferView(), \textcolor{keyword}{true}, \&DepthStencilView());}
\DoxyCodeLine{00192 }
\DoxyCodeLine{00193     \textcolor{comment}{// Indicate a state transition on the resource usage.}}
\DoxyCodeLine{00194     mCommandList-\/>ResourceBarrier(1, \&CD3DX12\_RESOURCE\_BARRIER::Transition(CurrentBackBuffer(),}
\DoxyCodeLine{00195         D3D12\_RESOURCE\_STATE\_RENDER\_TARGET, D3D12\_RESOURCE\_STATE\_PRESENT));}
\DoxyCodeLine{00196 }
\DoxyCodeLine{00197     \textcolor{comment}{// Done recording commands.}}
\DoxyCodeLine{00198     ThrowIfFailed(mCommandList-\/>Close());}
\DoxyCodeLine{00199 }
\DoxyCodeLine{00200     \textcolor{comment}{// Add the command list to the queue for execution.}}
\DoxyCodeLine{00201     ID3D12CommandList* cmdsLists[] = \{ mCommandList.Get() \};}
\DoxyCodeLine{00202     mCommandQueue-\/>ExecuteCommandLists(\_countof(cmdsLists), cmdsLists);}
\DoxyCodeLine{00203 }
\DoxyCodeLine{00204     \textcolor{comment}{// swap the back and front buffers}}
\DoxyCodeLine{00205     ThrowIfFailed(mSwapChain-\/>Present(0, 0));}
\DoxyCodeLine{00206     mCurrBackBuffer = (mCurrBackBuffer + 1) \% SwapChainBufferCount;}
\DoxyCodeLine{00207 }
\DoxyCodeLine{00208     \textcolor{comment}{// Wait until frame commands are complete.  This waiting is inefficient and is}}
\DoxyCodeLine{00209     \textcolor{comment}{// done for simplicity.  Later we will show how to organize our rendering code}}
\DoxyCodeLine{00210     \textcolor{comment}{// so we do not have to wait per frame.}}
\DoxyCodeLine{00211     FlushCommandQueue();}
\DoxyCodeLine{00212 \}}

\end{DoxyCode}
